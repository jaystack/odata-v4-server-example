{"version":3,"sources":["oDataProvider.js","src/Types/StorageProviders/oData/SaveStrategies/batch.js","src/Types/StorageProviders/oData/SaveStrategies/empty.js","src/Types/StorageProviders/oData/SaveStrategies/single.js","src/Types/StorageProviders/oData/index.js","src/Types/StorageProviders/oData/oDataCompiler.js","src/Types/StorageProviders/oData/src/Types/StorageProviders/oData/oDataConverter.js","src/Types/StorageProviders/oData/oDataIncludeCompiler.js","src/Types/StorageProviders/oData/oDataOrderCompiler.js","src/Types/StorageProviders/oData/oDataPagingCompiler.js","src/Types/StorageProviders/oData/oDataProjectionCompiler.js","src/Types/StorageProviders/oData/src/Types/StorageProviders/oData/oDataProvider.js","src/Types/StorageProviders/oData/oDataRequestActivities.js","src/Types/StorageProviders/oData/oDataWhereCompiler.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","$data","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"_dereq_","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","strategy","undefined","_core","_core2","name","condition","provider","convertedItems","disabled","providerConfiguration","disableBatch","defaults","OData","requests","getItems","save","callBack","that","items","map","it","request","build","get","requestData","requestUri","oDataServiceHost","method","data","__batchRequests","__changeRequests","headers","response","statusCode","result","__batchResponses","__changeResponses","errors","item","getByResponse","Entity","reload_fromResponse","setProcessed","push","parseError","error","Exception","success","oData","batch","batchHandler","useJsonLight","appendBasicAuth","user","password","withCredentials","context","prepareRequest","apply","jaydata/core",2,3,"doSave","index","done","err",4,"_oDataConverter","_oDataProvider","_oDataCompiler","_oDataWhereCompiler","_oDataIncludeCompiler","_oDataOrderCompiler","_oDataPagingCompiler","_oDataProjectionCompiler","./oDataCompiler.js","./oDataConverter.js","./oDataIncludeCompiler.js","./oDataOrderCompiler.js","./oDataPagingCompiler.js","./oDataProjectionCompiler.js","./oDataProvider.js","./oDataWhereCompiler.js",5,"$C","Expressions","EntityExpressionVisitor","constructor","includes","mainEntitySet","compile","query","storageProvider","defaultType","getEntitySetFromElementType","queryFragments","urlText","Visit","expression","$expand","toString","modelBinderConfig","modelBinder","Container","createModelBinderConfigCompiler","queryText","addAmp","$funcParams","postData","withInlineCount","isBatchExecuteQuery","_isBatchExecuteQuery","subQueries","_subQueries","params","_getComplitedData","VisitOrderExpression","source","orderCompiler","createoDataOrderCompiler","VisitPagingExpression","pagingCompiler","createoDataPagingCompiler","VisitIncludeExpression","includeCompiler","createoDataIncludeCompiler","includeContext","selector","VisitFindExpression","subMember","memberName","param","typeName","resolveName","type","converter","fieldConverter","toDb","escape","VisitProjectionExpression","projectionCompiler","createoDataProjectionCompiler","VisitFilterExpression","filterCompiler","createoDataWhereCompiler","VisitInlineCountExpression","maxDataServiceVersion","VisitEntitySetExpression","instance","tableName","VisitServiceOperationExpression","boundItem","entitySet","getEntityKeysValue","cfg","namespace","serviceName","serviceConfig","VisitBatchDeleteExpression","VisitConstantExpression","fullName","paramConfig","filter","p","useAlias","useParameterAlias","paramValue","paramName","VisitCountExpression","VisitBatchExecuteQueryExpression","members","queryable","compiler","storageProviders","oDataCompiler","compiled",6,"_atob","_atob2","oDataWebApi","oDataConverter","fromDb","$data.Enum","v","enumType","convertTo","$data.Byte","proxyConverter","$data.SByte","$data.Decimal","Decimal","$data.Float","$data.Int16","$data.Int64","Int64","$data.ObjectID","$data.Integer","$data.Int32","$data.Number","$data.Date","dbData","Date","substring","parseInt","substr","indexOf","match","$data.DateTimeOffset","$data.Time","Time","$data.Day","$data.Duration","$data.String","$data.Boolean","$data.Blob","$data.Object","JSON","parse","$data.Array","Array","$data.GeographyPoint","GeographyPoint","$data.GeographyLineString","GeographyLineString","$data.GeographyPolygon","GeographyPolygon","$data.GeographyMultiPoint","GeographyMultiPoint","$data.GeographyMultiLineString","GeographyMultiLineString","$data.GeographyMultiPolygon","GeographyMultiPolygon","$data.GeographyCollection","GeographyCollection","$data.GeometryPoint","GeometryPoint","$data.GeometryLineString","GeometryLineString","$data.GeometryPolygon","GeometryPolygon","$data.GeometryMultiPoint","GeometryMultiPoint","$data.GeometryMultiLineString","GeometryMultiLineString","$data.GeometryMultiPolygon","GeometryMultiPolygon","$data.GeometryCollection","GeometryCollection","$data.Guid","guid","$data.Entity","toISOString","replace","Blob","toBase64","def","elementType","values","arguments","stringify","d","encodeURIComponent","date","text","bool","b","join","GeographyBase","stringifyToUrl","GeometryBase","unescape","c","config","resolveType","converters","toLowerCase","lastIndexOf","test","slice","parseGuid","isAssignableTo","isArray","DateTimeOffset","Day","Duration","createFromHexString","parseFromString","xmlEscape","simple",7,"_classCallCheck","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","ODataIncludeFragment","$operators","operator","j","path","_createIncludePath","includedFragment","_setImplicitMap","inc","split","current","included","__implicit","includeFragment","$select","VisitParametricQueryExpression","AssociationInfoExpression","VisitAssociationInfoExpression","propName","associationInfo","FromPropertyName","includePath","currentPath","some","include","ToType","VisitFrameOperationExpression","opDef","operation","memberDefinition","includeFrameName","opName","paramCounter","parameters","args","arg","compilerType","frameContext","Queryable","preparator","createQueryExpressionCreator","entityContext","prep_expression","implementation",8,"oDataWhereCompiler","orderContext","nodeType","ExpressionType","OrderByDescending","VisitEntityFieldExpression","VisitComplexTypeExpression","VisitEntityExpression","VisitMemberInfoExpression","VisitEntityFieldOperationExpression","Guard","requireType","MemberInfoExpression","mapTo","forEach","VisitEntityFunctionOperationExpression","ConstantExpression","VisitContextFunctionOperationExpression",9,"pagingContext","amount","Skip","Take","raise",10,"hasObjectLiteral","modelBinderMapping","mapping","m","EntityExpression","EntitySetExpression","pop","addInclude","VisitObjectLiteralExpression","member","VisitObjectFieldExpression","propertyName","EntityFieldExpression","storageModel","_storageModel","getStorageModel","definedBy","isComplexProperty","ComplexTypes","complexProperty","addImplicitMap","ComplexTypeExpression","isComplexField","checkODataMode",11,"_interopRequireWildcard","newObj","hasOwnProperty","_datajsPatch","_typeof","Symbol","iterator","_jaydataOdatajs","odatajs","_oDataRequestActivities","activities","_empty","_single","_batch","__global","datajs","jsonHandler","version","Trace","log","oldread","defaultHandler","read","contentType","dataServiceVersion","oldwrite","write","withReferenceMethods","eTagAny","enableDeepSave","disableCompltexTypeMapping","_checkODataMode","functionName","Base","_items","_entities","add","changedItem","countable","entity","itemIndex","maxItemIndex","references","SetHeaderProperty","addItemReference","reference","getItem","getItemIndex","idx","removed","onlyAvailable","remove","_indexCalculated","_dataForResult","isProcessed","StorageProviderBase","ctx","SqlCommands","typeSystem","extend","dbCreation","DbCreationType","DropTableIfChanged","serviceUrl","UpdateMethod","_buildDbType_generateConvertToFunction","buildDbType_generateConvertToFunction","_buildDbType_modifyInstanceDefinition","buildDbType_modifyInstanceDefinition","fixkDataServiceVersions","setDataServiceVersionToMax","initializeStore","PromiseHandlerBase","createCallbackSettings","DropAllExistingTables","logicalEntity","dbInstance","PhysicalType","entityState","memberDefinitions","getPublicMappedProperties","property","initData","Associations","association","FromMultiplicity","ToMultiplicity","refValue","rv","contentId","EntityState","Modified","sMod","getType","tblName","TableName","pk","__metadata","uri","__convertedRefence","cmpType","executeQuery","sql","_compile","countProperty","textStatus","jqXHR","body","processSuccess","rawDataList","cnt","Integer","__count","Number","valueOf","resp","enableJSONP","enableJsonpCallback","saveChanges","changedItems","saveInternal","independentBlocks","buildIndependentBlocks","_checkDeepSave","_buildSaveData","actionMode","saveStrategySelector","saveStrategies","saveAction","_discoverSaveOrder","entityItems","entityInfo","visited","entityQueue","discoveredEntities","process","currentEntity","info","visiting","referredBy","concat","dependentOn","ref","refIndex","deepParent","parent","currentItem","shift","discover","innerChangeItem","Added","additionalDependentOn","RequestManager","independentItem","RequestBuilder","SetUrl","_buildRequestObject","EntityState_20","convertedItem","SetMethod","AppendUrl","save_getInitData","EntityState_30","addETagHeader","EntityState_40","ClearRequestData","memDef","propType","computed","inverseProperty","concurrencyMode","ConcurrencyMode","Fixed","aeType","arrayProperty","ap","aitem","isNullOrUndefined","etypeName","econverter","isComplex","isDeep","physicalData","hasSavedProperty","asArray","memdef","propertyConversationSelector","kind","MemberTypes","_complexPropertySelector","_propertySelector","navProperty","_navigationPropertySelector","propertyConversationStrategies","notMapped","_propertyIsChanged","_this","navigationValue","navItem","_processDeepSaveItems","_simpleNavigationPropertySelector","navigationEntity","referencedItems","deepItem","referencedRequest","changedProperties","SetProperty","reqItem","additionalRequest","req","targetItem","getEntityUrlReference","refItem","deepSave","deepSaveArray","navigation","complex","innerRequest","headerValue","getTraceString","supportedDataTypes","String","Boolean","Guid","Byte","SByte","Float","Int16","Int32","supportedBinaryOperators","equal","dataType","allowedIn","FilterExpression","OrderExpression","notEqual","equalTyped","notEqualTyped","greaterThan","greaterThanOrEqual","lessThan","lessThenOrEqual","or","and","divide","multiply","subtract","modulo","in","supportedUnaryOperators","not","supportedFieldOperations","contains","startsWith","endsWith","allowedType","ProjectionExpression","fixedDataType","strLength","baseIndex","optional","toUpperCase","trim","day","hour","minute","month","second","year","round","floor","ceiling","distance","intersects","supportedSetOperations","IncludeExpression","frameType","toArray","single","invokable","SomeExpression","every","EveryExpression","take","PagingExpression","skip","orderBy","orderByDescending","frameTypeFactory","first","batchDelete","InlineCountExpression","find","supportedContextOperation","batchExecuteQuery","resolveTypeOperations","entityType","getMemberDefinition","IsSideEffecting","returnType","resolveSetOperations","esDef","ContextType","ItemName","actions","MemberDefinition","translateDefinition","resolveContextOperations","keyValue","memDefs","getKeyProperties","field","getFieldUrl","fieldName","keyPart","servicehost","message","errorObj","Authorization","__encodeBase64","val","chr1","chr2","enc1","enc2","enc3","b64array","input","base64","chr3","enc4","charCodeAt","isNaN","charAt","registerProvider","oDataProvider","./SaveStrategies/batch","./SaveStrategies/empty","./SaveStrategies/single","./oDataRequestActivities.js",12,"_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","create","setPrototypeOf","__proto__","RequestActivity","_context","_request","_activities","SetRequestActivity","_RequestActivity","_this2","getPrototypeOf","SetRequestProperty","_SetRequestActivity","SetDataProperty","_SetRequestActivity2","_SetRequestActivity3","_SetRequestProperty","url","_SetUrl","_SetRequestProperty2","_SetDataProperty","SetNavigationProperty","_SetDataProperty2","_RequestActivity2",13,"lambdaPrefix","VisitUnaryExpression","resolution","operand","VisitSimpleBinaryExpression","right","orResolution","eqResolution","idValue","idCheck","createSimpleBinaryExpression","left","Equal","Or","temp","VisitQueryParameterExpression","lambda","frameExpression"],"mappings":"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","file":"oDataProvider.min.js","sourcesContent":["// JayData 1.5.1 CTP\r\n// Dual licensed under MIT and GPL v2\r\n// Copyright JayStack Technologies (http://jaydata.org/licensing)\r\n//\r\n// JayData is a standards-based, cross-platform Javascript library and a set of\r\n// practices to access and manipulate data from various online and offline sources.\r\n//\r\n// Credits:\r\n//     Hajnalka Battancs, Dniel Jzsef, Jnos Roden, Lszl Horvth, Pter Nochta\r\n//     Pter Zentai, Rbert Bnay, Szabolcs Czinege, Viktor Borza, Viktor Lzr,\r\n//     Zoltn Gyebrovszki, Gbor Dolla\r\n//\r\n// More info: http://jaydata.org\r\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.$data = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.strategy = undefined;\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar strategy = {\n    name: 'batch',\n    condition: function condition(provider, convertedItems) {\n        var disabled = false;\n        if (typeof provider.providerConfiguration.disableBatch !== 'undefined') {\n            disabled = !!provider.providerConfiguration.disableBatch;\n        } else {\n            disabled = !!_core2.default.defaults.OData.disableBatch;\n        }\n\n        if (!disabled) {\n            var requests = convertedItems.getItems();\n            return requests.length > 1;\n        }\n\n        return false;\n    },\n    save: function save(provider, convertedItems, callBack) {\n        var that = provider;\n        var items = convertedItems.getItems();\n        var requests = items.map(function (it) {\n            return it.request.build().get();\n        });\n\n        var requestData = [{\n            requestUri: that.providerConfiguration.oDataServiceHost + \"/$batch\",\n            method: \"POST\",\n            data: {\n                __batchRequests: [{ __changeRequests: requests }]\n            },\n            headers: {}\n        }, function (data, response) {\n            if (response.statusCode == 200 || response.statusCode == 202) {\n                var result = data.__batchResponses[0].__changeResponses;\n                var errors = [];\n\n                for (var i = 0; i < result.length; i++) {\n                    if (result[i].statusCode >= 200 && result[i].statusCode < 300) {\n                        var item = convertedItems.getByResponse(result[i], i);\n                        if (item instanceof _core2.default.Entity && result[i].statusCode != 204) {\n                            that.reload_fromResponse(item, result[i].data, result[i]);\n                            convertedItems.setProcessed(item);\n                        }\n                    } else {\n                        errors.push(that.parseError(result[i]));\n                    }\n                }\n                if (errors.length > 0) {\n                    if (errors.length === 1) {\n                        callBack.error(errors[0]);\n                    } else {\n                        callBack.error(new _core.Exception('See inner exceptions', 'Batch failed', errors));\n                    }\n                } else if (callBack.success) {\n                    callBack.success(convertedItems.length);\n                }\n            } else {\n                callBack.error(that.parseError(response));\n            }\n        }, function (e) {\n            callBack.error(that.parseError(e));\n        }, that.oData.batch.batchHandler];\n\n        if (typeof that.providerConfiguration.useJsonLight !== 'undefined') {\n            requestData[0].useJsonLight = that.providerConfiguration.useJsonLight;\n        }\n\n        that.appendBasicAuth(requestData[0], that.providerConfiguration.user, that.providerConfiguration.password, that.providerConfiguration.withCredentials);\n\n        that.context.prepareRequest.call(that, requestData);\n        that.oData.request.apply(that, requestData);\n    }\n};\n\nexports.strategy = strategy;\n\n},{\"jaydata/core\":\"jaydata/core\"}],2:[function(_dereq_,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar strategy = {\n    name: 'empty',\n    condition: function condition(provider, convertedItems) {\n        return true;\n    },\n    save: function save(provider, convertedItems, callBack) {\n        callBack.success(0);\n    }\n};\n\nexports.strategy = strategy;\n\n},{}],3:[function(_dereq_,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.strategy = undefined;\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar strategy = {\n    name: 'single',\n    condition: function condition(provider, convertedItems) {\n        var requests = convertedItems.getItems();\n        return requests.length > 0;\n    },\n    save: function save(provider, convertedItems, callBack) {\n        var that = provider;\n        var items = convertedItems.getItems();\n\n        var doSave = function doSave(items, index, done) {\n            var item = items[index];\n            if (!item) return done();\n\n            var request = item.request.build().get();\n            var requestData = [request, function (data, response) {\n                if (response.statusCode >= 200 && response.statusCode < 300) {\n                    var item = convertedItems.getByResponse(response, index);\n                    if (item instanceof _core2.default.Entity && response.statusCode != 204) {\n                        that.reload_fromResponse(item, data, response);\n                        convertedItems.setProcessed(item);\n                    }\n\n                    doSave(items, ++index, done);\n                } else {\n                    done(response);\n                }\n            }, done];\n\n            that.appendBasicAuth(requestData[0], that.providerConfiguration.user, that.providerConfiguration.password, that.providerConfiguration.withCredentials);\n            that.context.prepareRequest.call(that, requestData);\n            that.oData.request.apply(that, requestData);\n        };\n\n        doSave(items, 0, function (err, result) {\n            if (err) return callBack.error(that.parseError(err));\n            callBack.success(result);\n        });\n    }\n};\n\nexports.strategy = strategy;\n\n},{\"jaydata/core\":\"jaydata/core\"}],4:[function(_dereq_,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nvar _oDataConverter = _dereq_('./oDataConverter.js');\n\nvar _oDataConverter2 = _interopRequireDefault(_oDataConverter);\n\nvar _oDataProvider = _dereq_('./oDataProvider.js');\n\nvar _oDataProvider2 = _interopRequireDefault(_oDataProvider);\n\nvar _oDataCompiler = _dereq_('./oDataCompiler.js');\n\nvar _oDataCompiler2 = _interopRequireDefault(_oDataCompiler);\n\nvar _oDataWhereCompiler = _dereq_('./oDataWhereCompiler.js');\n\nvar _oDataWhereCompiler2 = _interopRequireDefault(_oDataWhereCompiler);\n\nvar _oDataIncludeCompiler = _dereq_('./oDataIncludeCompiler.js');\n\nvar _oDataIncludeCompiler2 = _interopRequireDefault(_oDataIncludeCompiler);\n\nvar _oDataOrderCompiler = _dereq_('./oDataOrderCompiler.js');\n\nvar _oDataOrderCompiler2 = _interopRequireDefault(_oDataOrderCompiler);\n\nvar _oDataPagingCompiler = _dereq_('./oDataPagingCompiler.js');\n\nvar _oDataPagingCompiler2 = _interopRequireDefault(_oDataPagingCompiler);\n\nvar _oDataProjectionCompiler = _dereq_('./oDataProjectionCompiler.js');\n\nvar _oDataProjectionCompiler2 = _interopRequireDefault(_oDataProjectionCompiler);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = _core2.default;\nmodule.exports = exports['default'];\n\n},{\"./oDataCompiler.js\":5,\"./oDataConverter.js\":6,\"./oDataIncludeCompiler.js\":7,\"./oDataOrderCompiler.js\":8,\"./oDataPagingCompiler.js\":9,\"./oDataProjectionCompiler.js\":10,\"./oDataProvider.js\":11,\"./oDataWhereCompiler.js\":13,\"jaydata/core\":\"jaydata/core\"}],5:[function(_dereq_,module,exports){\n'use strict';\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n(0, _core.$C)('$data.storageProviders.oData.oDataCompiler', _core2.default.Expressions.EntityExpressionVisitor, null, {\n    constructor: function constructor() {\n        this.context = {};\n        this.provider = {};\n        //this.logicalType = null;\n        this.includes = null;\n        this.mainEntitySet = null;\n    },\n    compile: function compile(query) {\n\n        this.provider = query.context.storageProvider;\n        this.context = query.context;\n\n        if (query.defaultType) {\n            this.mainEntitySet = query.context.getEntitySetFromElementType(query.defaultType);\n        }\n\n        var queryFragments = { urlText: \"\" };\n\n        this.Visit(query.expression, queryFragments);\n        if (queryFragments.$expand) {\n            queryFragments.$expand = queryFragments.$expand.toString();\n        }\n\n        query.modelBinderConfig = {};\n        var modelBinder = _core.Container.createModelBinderConfigCompiler(query, this.includes, true);\n        modelBinder.Visit(query.expression);\n\n        var queryText = queryFragments.urlText;\n        var addAmp = false;\n\n        if (queryFragments.$funcParams) {\n            queryText += \"(\" + queryFragments.$funcParams + \")\";\n        }\n\n        for (var name in queryFragments) {\n            if (name != \"urlText\" && name != \"actionPack\" && name != \"data\" && name != \"lambda\" && name != \"method\" && name != \"postData\" && name != \"_isBatchExecuteQuery\" && name != \"_subQueries\" && name != \"$funcParams\" && queryFragments[name] != \"\") {\n\n                if (addAmp) {\n                    queryText += \"&\";\n                } else {\n                    queryText += \"?\";\n                }\n                addAmp = true;\n                if (name != \"$urlParams\") {\n                    queryText += name + '=' + queryFragments[name];\n                } else {\n                    queryText += queryFragments[name];\n                }\n            }\n        }\n        query.queryText = queryText;\n        query.postData = queryFragments.postData;\n        var result = {\n            queryText: queryText,\n            withInlineCount: '$inlinecount' in queryFragments || '$count' in queryFragments,\n            method: queryFragments.method || 'GET',\n            postData: queryFragments.postData,\n            isBatchExecuteQuery: queryFragments._isBatchExecuteQuery,\n            subQueries: queryFragments._subQueries,\n            params: []\n        };\n\n        query._getComplitedData = function () {\n            return result;\n        };\n\n        return result;\n    },\n    VisitOrderExpression: function VisitOrderExpression(expression, context) {\n        this.Visit(expression.source, context);\n\n        var orderCompiler = _core.Container.createoDataOrderCompiler(this.provider);\n        orderCompiler.compile(expression, context);\n    },\n    VisitPagingExpression: function VisitPagingExpression(expression, context) {\n        this.Visit(expression.source, context);\n\n        var pagingCompiler = _core.Container.createoDataPagingCompiler(this.provider);\n        pagingCompiler.compile(expression, context);\n    },\n    VisitIncludeExpression: function VisitIncludeExpression(expression, context) {\n        this.Visit(expression.source, context);\n\n        var includeCompiler = _core.Container.createoDataIncludeCompiler(this.provider);\n        this.includes = this.includes || [];\n        var includeContext = { data: context[\"$expand\"], includes: this.includes };\n        includeCompiler.compile(expression.selector, includeContext);\n        context[\"$expand\"] = includeContext.data;\n    },\n    VisitFindExpression: function VisitFindExpression(expression, context) {\n        this.Visit(expression.source, context);\n\n        if (expression.subMember) {\n            context.urlText += \"/\" + expression.subMember.memberName;\n        }\n\n        context.urlText += '(';\n        if (expression.params.length === 1) {\n            var param = expression.params[0];\n            var typeName = _core.Container.resolveName(param.type);\n\n            var converter = this.provider.fieldConverter.toDb[typeName];\n            var value = converter ? converter(param.value) : param.value;\n\n            converter = this.provider.fieldConverter.escape[typeName];\n            value = converter ? converter(param.value) : param.value;\n            context.urlText += value;\n        } else {\n            for (var i = 0; i < expression.params.length; i++) {\n                var param = expression.params[i];\n                var typeName = _core.Container.resolveName(param.type);\n\n                var converter = this.provider.fieldConverter.toDb[typeName];\n                var value = converter ? converter(param.value) : param.value;\n\n                converter = this.provider.fieldConverter.escape[typeName];\n                value = converter ? converter(param.value) : param.value;\n\n                if (i > 0) context.urlText += ',';\n                context.urlText += param.name + '=' + value;\n            }\n        }\n        context.urlText += ')';\n    },\n    VisitProjectionExpression: function VisitProjectionExpression(expression, context) {\n        this.Visit(expression.source, context);\n\n        var projectionCompiler = _core.Container.createoDataProjectionCompiler(this.provider);\n        projectionCompiler.compile(expression, context);\n    },\n    VisitFilterExpression: function VisitFilterExpression(expression, context) {\n        ///<param name=\"expression\" type=\"$data.Expressions.FilterExpression\" />\n\n        this.Visit(expression.source, context);\n\n        var filterCompiler = _core.Container.createoDataWhereCompiler(this.provider);\n        context.data = \"\";\n        filterCompiler.compile(expression.selector, context);\n        context[\"$filter\"] = context.data;\n        context.data = \"\";\n    },\n    VisitInlineCountExpression: function VisitInlineCountExpression(expression, context) {\n        this.Visit(expression.source, context);\n        if (this.provider.providerConfiguration.maxDataServiceVersion === \"4.0\") {\n            context[\"$count\"] = expression.selector.value === 'allpages';\n        } else {\n            context[\"$inlinecount\"] = expression.selector.value;\n        }\n    },\n    VisitEntitySetExpression: function VisitEntitySetExpression(expression, context) {\n        context.urlText += \"/\" + expression.instance.tableName;\n        //this.logicalType = expression.instance.elementType;\n        if (expression.params) {\n            for (var i = 0; i < expression.params.length; i++) {\n                this.Visit(expression.params[i], context);\n            }\n        }\n    },\n    VisitServiceOperationExpression: function VisitServiceOperationExpression(expression, context) {\n        if (expression.boundItem) {\n            context.urlText += \"/\" + expression.boundItem.entitySet.tableName;\n            if (expression.boundItem.data instanceof _core2.default.Entity) {\n                context.urlText += '(' + this.provider.getEntityKeysValue(expression.boundItem) + ')';\n            }\n        }\n        context.urlText += \"/\" + (expression.cfg.namespace ? expression.cfg.namespace + \".\" + expression.cfg.serviceName : expression.cfg.serviceName);\n        context.method = context.method || expression.cfg.method;\n\n        //this.logicalType = expression.returnType;\n        if (expression.params) {\n            context.serviceConfig = expression.cfg;\n            for (var i = 0; i < expression.params.length; i++) {\n                this.Visit(expression.params[i], context);\n            }\n            delete context.serviceConfig;\n        }\n    },\n    VisitBatchDeleteExpression: function VisitBatchDeleteExpression(expression, context) {\n        this.Visit(expression.source, context);\n        context.urlText += '/$batchDelete';\n        context.method = 'DELETE';\n    },\n\n    VisitConstantExpression: function VisitConstantExpression(expression, context) {\n        var typeName = _core.Container.resolveName(expression.type);\n        if (expression.value instanceof _core2.default.Entity) typeName = _core2.default.Entity.fullName;\n\n        var converter = this.provider.fieldConverter.toDb[typeName];\n        var value = converter ? converter(expression.value, expression) : expression.value;\n\n        if (context.method === 'GET' || !context.method) {\n            converter = this.provider.fieldConverter.escape[typeName];\n            value = converter ? converter(value, expression) : value;\n            if (value !== undefined) {\n                var serviceConfig = context.serviceConfig || {};\n                var paramConfig = serviceConfig && serviceConfig.params.filter(function (p) {\n                    return p.name == expression.name;\n                })[0] || {};\n\n                var useAlias = serviceConfig.namespace && (paramConfig.useAlias || serviceConfig.useAlias || this.provider.providerConfiguration.useParameterAlias || _core2.default.defaults.OData.useParameterAlias);\n\n                var paramValue = useAlias ? \"@\" + expression.name : value;\n                var paramName = (useAlias ? \"@\" : \"\") + expression.name;\n\n                if (serviceConfig.namespace) {\n                    if (context['$funcParams']) {\n                        context['$funcParams'] += ',';\n                    } else {\n                        context['$funcParams'] = '';\n                    }\n                    context['$funcParams'] += expression.name + '=' + paramValue;\n                }\n\n                if (!serviceConfig.namespace || useAlias) {\n                    if (context['$urlParams']) {\n                        context['$urlParams'] += '&';\n                    } else {\n                        context['$urlParams'] = '';\n                    }\n                    context['$urlParams'] += paramName + '=' + value;\n                }\n            }\n        } else {\n            context.postData = context.postData || {};\n            context.postData[expression.name] = value;\n        }\n    },\n    //    VisitConstantExpression: function (expression, context) {\n    //        if (context['$urlParams']) { context['$urlParams'] += '&'; } else { context['$urlParams'] = ''; }\n    //\n    //\n    //        var valueType = Container.getTypeName(expression.value);\n    //\n    //\n    //\n    //        context['$urlParams'] += expression.name + '=' + this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(valueType))](expression.value);\n    //    },\n\n    VisitCountExpression: function VisitCountExpression(expression, context) {\n        this.Visit(expression.source, context);\n        context.urlText += '/$count';\n    },\n\n    VisitBatchExecuteQueryExpression: function VisitBatchExecuteQueryExpression(expression, context) {\n        context.urlText += '/$batch';\n        context.method = 'POST';\n        context.postData = { __batchRequests: [] };\n        context._isBatchExecuteQuery = true;\n        context._subQueries = expression.members;\n\n        for (var i = 0; i < expression.members.length; i++) {\n            var queryable = expression.members[i];\n            var compiler = new _core2.default.storageProviders.oData.oDataCompiler();\n            var compiled = compiler.compile(queryable);\n            context.postData.__batchRequests.push({\n                requestUri: this.provider.providerConfiguration.oDataServiceHost + compiled.queryText,\n                method: compiled.method,\n                data: compiled.data,\n                headers: compiled.headers\n            });\n        }\n    }\n}, {});\n\n},{\"jaydata/core\":\"jaydata/core\"}],6:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nvar _atob = (typeof window !== \"undefined\" ? window['atob'] : typeof global !== \"undefined\" ? global['atob'] : null);\n\nvar _atob2 = _interopRequireDefault(_atob);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_core2.default.defaults = _core2.default.defaults || {};\n_core2.default.defaults.oDataWebApi = false;\n\n_core2.default.oDataConverter = {\n    fromDb: {\n        '$data.Enum': function $dataEnum(v, enumType) {\n            return _core2.default.Container.convertTo(v, enumType);\n        },\n        '$data.Byte': _core2.default.Container.proxyConverter,\n        '$data.SByte': _core2.default.Container.proxyConverter,\n        '$data.Decimal': function $dataDecimal(v) {\n            return _core2.default.Container.convertTo(v, _core2.default.Decimal);\n        },\n        '$data.Float': _core2.default.Container.proxyConverter,\n        '$data.Int16': _core2.default.Container.proxyConverter,\n        '$data.Int64': function $dataInt64(v) {\n            return _core2.default.Container.convertTo(v, _core2.default.Int64);\n        },\n        '$data.ObjectID': _core2.default.Container.proxyConverter,\n        '$data.Integer': _core2.default.Container.proxyConverter, //function (number) { return (typeof number === 'string' && /^\\d+$/.test(number)) ? parseInt(number) : number; },\n        '$data.Int32': _core2.default.Container.proxyConverter,\n        '$data.Number': _core2.default.Container.proxyConverter,\n        '$data.Date': function $dataDate(dbData) {\n            if (dbData) {\n                if (dbData instanceof Date) {\n                    return dbData;\n                } else if (dbData.substring(0, 6) === '/Date(') {\n                    return new Date(parseInt(dbData.substr(6)));\n                } else {\n                    //ISODate without Z? Safari compatible with Z\n                    if (dbData.indexOf('Z') === -1 && !dbData.match('T.*[+-]')) dbData += 'Z';\n                    return new Date(dbData);\n                }\n            } else {\n                return dbData;\n            }\n        },\n        '$data.DateTimeOffset': function $dataDateTimeOffset(dbData) {\n            if (dbData) {\n                if (dbData instanceof Date) {\n                    return dbData;\n                } else if (dbData.substring(0, 6) === '/Date(') {\n                    return new Date(parseInt(dbData.substr(6)));\n                } else {\n                    //ISODate without Z? Safari compatible with Z\n                    if (dbData.indexOf('Z') === -1 && !dbData.match('T.*[+-]')) dbData += 'Z';\n                    return new Date(dbData);\n                }\n            } else {\n                return dbData;\n            }\n        },\n        '$data.Time': function $dataTime(v) {\n            return _core2.default.Container.convertTo(v, _core2.default.Time);\n        },\n        '$data.Day': _core2.default.Container.proxyConverter,\n        '$data.Duration': _core2.default.Container.proxyConverter,\n        '$data.String': _core2.default.Container.proxyConverter,\n        '$data.Boolean': _core2.default.Container.proxyConverter,\n        '$data.Blob': function $dataBlob(v) {\n            if (typeof v == 'string') {\n                try {\n                    return _core2.default.Container.convertTo((0, _atob2.default)(v), '$data.Blob');\n                } catch (e) {\n                    return v;\n                }\n            } else return v;\n        },\n        '$data.Object': function $dataObject(o) {\n            if (o === undefined) {\n                return new _core2.default.Object();\n            } else if (typeof o === 'string') {\n                return JSON.parse(o);\n            }return o;\n        },\n        '$data.Array': function $dataArray(o) {\n            if (o === undefined) {\n                return new _core2.default.Array();\n            } else if (o instanceof _core2.default.Array) {\n                return o;\n            }return JSON.parse(o);\n        },\n        '$data.GeographyPoint': function $dataGeographyPoint(g) {\n            if (g) {\n                return new _core2.default.GeographyPoint(g);\n            }return g;\n        },\n        '$data.GeographyLineString': function $dataGeographyLineString(g) {\n            if (g) {\n                return new _core2.default.GeographyLineString(g);\n            }return g;\n        },\n        '$data.GeographyPolygon': function $dataGeographyPolygon(g) {\n            if (g) {\n                return new _core2.default.GeographyPolygon(g);\n            }return g;\n        },\n        '$data.GeographyMultiPoint': function $dataGeographyMultiPoint(g) {\n            if (g) {\n                return new _core2.default.GeographyMultiPoint(g);\n            }return g;\n        },\n        '$data.GeographyMultiLineString': function $dataGeographyMultiLineString(g) {\n            if (g) {\n                return new _core2.default.GeographyMultiLineString(g);\n            }return g;\n        },\n        '$data.GeographyMultiPolygon': function $dataGeographyMultiPolygon(g) {\n            if (g) {\n                return new _core2.default.GeographyMultiPolygon(g);\n            }return g;\n        },\n        '$data.GeographyCollection': function $dataGeographyCollection(g) {\n            if (g) {\n                return new _core2.default.GeographyCollection(g);\n            }return g;\n        },\n        '$data.GeometryPoint': function $dataGeometryPoint(g) {\n            if (g) {\n                return new _core2.default.GeometryPoint(g);\n            }return g;\n        },\n        '$data.GeometryLineString': function $dataGeometryLineString(g) {\n            if (g) {\n                return new _core2.default.GeometryLineString(g);\n            }return g;\n        },\n        '$data.GeometryPolygon': function $dataGeometryPolygon(g) {\n            if (g) {\n                return new _core2.default.GeometryPolygon(g);\n            }return g;\n        },\n        '$data.GeometryMultiPoint': function $dataGeometryMultiPoint(g) {\n            if (g) {\n                return new _core2.default.GeometryMultiPoint(g);\n            }return g;\n        },\n        '$data.GeometryMultiLineString': function $dataGeometryMultiLineString(g) {\n            if (g) {\n                return new _core2.default.GeometryMultiLineString(g);\n            }return g;\n        },\n        '$data.GeometryMultiPolygon': function $dataGeometryMultiPolygon(g) {\n            if (g) {\n                return new _core2.default.GeometryMultiPolygon(g);\n            }return g;\n        },\n        '$data.GeometryCollection': function $dataGeometryCollection(g) {\n            if (g) {\n                return new _core2.default.GeometryCollection(g);\n            }return g;\n        },\n        '$data.Guid': function $dataGuid(guid) {\n            return guid ? guid.toString() : guid;\n        }\n    },\n    toDb: {\n        '$data.Enum': _core2.default.Container.proxyConverter,\n        '$data.Entity': _core2.default.Container.proxyConverter,\n        '$data.Byte': _core2.default.Container.proxyConverter,\n        '$data.SByte': _core2.default.Container.proxyConverter,\n        '$data.Decimal': _core2.default.Container.proxyConverter, //function (v) { return v ? parseFloat(v) : v },\n        '$data.Float': _core2.default.Container.proxyConverter,\n        '$data.Int16': _core2.default.Container.proxyConverter,\n        '$data.Int64': _core2.default.Container.proxyConverter, //function (v) { return v ? parseInt(v) : v },\n        '$data.ObjectID': _core2.default.Container.proxyConverter,\n        '$data.Integer': _core2.default.Container.proxyConverter,\n        '$data.Int32': _core2.default.Container.proxyConverter,\n        '$data.Number': _core2.default.Container.proxyConverter,\n        '$data.Date': function $dataDate(e) {\n            return e ? e.toISOString().replace('Z', '') : e;\n        },\n        '$data.Time': _core2.default.Container.proxyConverter,\n        '$data.Day': _core2.default.Container.proxyConverter,\n        '$data.Duration': _core2.default.Container.proxyConverter,\n        '$data.DateTimeOffset': function $dataDateTimeOffset(v) {\n            return v ? v.toISOString() : v;\n        },\n        '$data.String': _core2.default.Container.proxyConverter,\n        '$data.Boolean': _core2.default.Container.proxyConverter,\n        '$data.Blob': function $dataBlob(v) {\n            return v ? _core2.default.Blob.toBase64(v) : v;\n        },\n        '$data.Object': _core2.default.Container.proxyConverter,\n        '$data.Array': function $dataArray(o, def) {\n            if (o && def && def.elementType) {\n                var typeName = _core.Container.resolveName(def.elementType);\n                var values = [];\n                for (var i = 0; i < o.length; i++) {\n                    values.push(_core2.default.oDataConverter['toDb'][typeName](o[i]));\n                }\n\n                return values;\n            }\n            return _core2.default.Container.proxyConverter.apply(this, arguments);\n        },\n        '$data.GeographyPoint': _core2.default.Container.proxyConverter,\n        '$data.GeographyLineString': _core2.default.Container.proxyConverter,\n        '$data.GeographyPolygon': _core2.default.Container.proxyConverter,\n        '$data.GeographyMultiPoint': _core2.default.Container.proxyConverter,\n        '$data.GeographyMultiLineString': _core2.default.Container.proxyConverter,\n        '$data.GeographyMultiPolygon': _core2.default.Container.proxyConverter,\n        '$data.GeographyCollection': _core2.default.Container.proxyConverter,\n        '$data.GeometryPoint': _core2.default.Container.proxyConverter,\n        '$data.GeometryLineString': _core2.default.Container.proxyConverter,\n        '$data.GeometryPolygon': _core2.default.Container.proxyConverter,\n        '$data.GeometryMultiPoint': _core2.default.Container.proxyConverter,\n        '$data.GeometryMultiLineString': _core2.default.Container.proxyConverter,\n        '$data.GeometryMultiPolygon': _core2.default.Container.proxyConverter,\n        '$data.GeometryCollection': _core2.default.Container.proxyConverter,\n        '$data.Guid': _core2.default.Container.proxyConverter\n    },\n    escape: {\n        '$data.Enum': function $dataEnum(e, enumType) {\n            return e !== null && e !== undefined ? (enumType ? enumType.fullName : \"\") + \"'\" + e + \"'\" : e;\n        },\n        '$data.Entity': function $dataEntity(e) {\n            return JSON.stringify(e);\n        },\n        '$data.Integer': _core2.default.Container.proxyConverter,\n        '$data.Int32': _core2.default.Container.proxyConverter,\n        '$data.Number': function $dataNumber(v) {\n            return v && _core2.default.defaults.oDataWebApi ? v + 'd' : v;\n        },\n        '$data.Int16': _core2.default.Container.proxyConverter,\n        '$data.Byte': _core2.default.Container.proxyConverter,\n        '$data.SByte': _core2.default.Container.proxyConverter,\n        '$data.Decimal': function $dataDecimal(v) {\n            return v && _core2.default.defaults.oDataWebApi ? v + 'm' : v;\n        },\n        '$data.Float': function $dataFloat(v) {\n            return v && _core2.default.defaults.oDataWebApi ? v + 'f' : v;\n        },\n        '$data.Int64': _core2.default.Container.proxyConverter,\n        '$data.Time': _core2.default.Container.proxyConverter,\n        '$data.Day': _core2.default.Container.proxyConverter,\n        '$data.Duration': function $dataDuration(v) {\n            return v ? \"duration'\" + v + \"'\" : v;\n        },\n        '$data.DateTimeOffset': function $dataDateTimeOffset(d) {\n            return d ? encodeURIComponent(d) : d;\n        },\n        '$data.Date': function $dataDate(date) {\n            return date ? \"datetime'\" + date + \"'\" : date;\n        },\n        '$data.String': function $dataString(text) {\n            return typeof text === 'string' ? \"'\" + text.replace(/'/g, \"''\") + \"'\" : text;\n        },\n        '$data.ObjectID': function $dataObjectID(text) {\n            return typeof text === 'string' ? \"'\" + text.replace(/'/g, \"''\") + \"'\" : text;\n        },\n        '$data.Boolean': function $dataBoolean(bool) {\n            return typeof bool === 'boolean' ? bool.toString() : bool;\n        },\n        '$data.Blob': function $dataBlob(b) {\n            return b ? \"binary'\" + b + \"'\" : b;\n        },\n        '$data.Object': function $dataObject(o) {\n            return JSON.stringify(o);\n        },\n        '$data.Array': function $dataArray(o, def) {\n            if (o && def && def.elementType) {\n                var typeName = _core.Container.resolveName(def.elementType);\n                var values = [];\n                for (var i = 0; i < o.length; i++) {\n                    values.push(_core2.default.oDataConverter['escape'][typeName](o[i]));\n                }\n\n                return \"[\" + values.join(',') + \"]\";\n            }\n            return JSON.stringify(o);\n        },\n        '$data.GeographyPoint': function $dataGeographyPoint(g) {\n            if (g) {\n                return _core2.default.GeographyBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeographyLineString': function $dataGeographyLineString(g) {\n            if (g) {\n                return _core2.default.GeographyBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeographyPolygon': function $dataGeographyPolygon(g) {\n            if (g) {\n                return _core2.default.GeographyBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeographyMultiPoint': function $dataGeographyMultiPoint(g) {\n            if (g) {\n                return _core2.default.GeographyBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeographyMultiLineString': function $dataGeographyMultiLineString(g) {\n            if (g) {\n                return _core2.default.GeographyBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeographyMultiPolygon': function $dataGeographyMultiPolygon(g) {\n            if (g) {\n                return _core2.default.GeographyBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeographyCollection': function $dataGeographyCollection(g) {\n            if (g) {\n                return _core2.default.GeographyBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeometryPoint': function $dataGeometryPoint(g) {\n            if (g) {\n                return _core2.default.GeometryBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeometryLineString': function $dataGeometryLineString(g) {\n            if (g) {\n                return _core2.default.GeometryBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeometryPolygon': function $dataGeometryPolygon(g) {\n            if (g) {\n                return _core2.default.GeometryBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeometryMultiPoint': function $dataGeometryMultiPoint(g) {\n            if (g) {\n                return _core2.default.GeometryBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeometryMultiLineString': function $dataGeometryMultiLineString(g) {\n            if (g) {\n                return _core2.default.GeometryBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeometryMultiPolygon': function $dataGeometryMultiPolygon(g) {\n            if (g) {\n                return _core2.default.GeometryBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.GeometryCollection': function $dataGeometryCollection(g) {\n            if (g) {\n                return _core2.default.GeometryBase.stringifyToUrl(g);\n            }return g;\n        },\n        '$data.Guid': function $dataGuid(guid) {\n            return guid ? \"\" + guid.toString() + \"\" : guid;\n        }\n    },\n    unescape: {\n        '$data.Entity': function $dataEntity(v, c) {\n            var config = c || {};\n            var value = JSON.parse(v);\n            if (value && config.type) {\n                var type = _core.Container.resolveType(config.type);\n                /*Todo converter*/\n                return new type(value, { converters: undefined });\n            }\n            return value;\n        },\n        '$data.Number': function $dataNumber(v) {\n            return JSON.parse(v);\n        },\n        '$data.Integer': function $dataInteger(v) {\n            return JSON.parse(v);\n        },\n        '$data.Int32': function $dataInt32(v) {\n            return JSON.parse(v);\n        },\n        '$data.Byte': function $dataByte(v) {\n            return JSON.parse(v);\n        },\n        '$data.SByte': function $dataSByte(v) {\n            return JSON.parse(v);\n        },\n        '$data.Decimal': function $dataDecimal(v) {\n            if (typeof v === 'string' && v.toLowerCase().lastIndexOf('m') === v.length - 1) {\n                return v.substr(0, v.length - 1);\n            } else {\n                return v;\n            }\n        },\n        '$data.Float': function $dataFloat(v) {\n            if (typeof v === 'string' && v.toLowerCase().lastIndexOf('f') === v.length - 1) {\n                return v.substr(0, v.length - 1);\n            } else {\n                return v;\n            }\n        },\n        '$data.Int16': function $dataInt16(v) {\n            return JSON.parse(v);\n        },\n        '$data.Int64': function $dataInt64(v) {\n            return v;\n        },\n        '$data.Boolean': function $dataBoolean(v) {\n            return JSON.parse(v);\n        },\n        '$data.Date': function $dataDate(v) {\n            if (typeof v === 'string' && /^datetime'/.test(v)) {\n                return v.slice(9, v.length - 1);\n            }\n            return v;\n        },\n        '$data.String': function $dataString(v) {\n            if (typeof v === 'string' && v.indexOf(\"'\") === 0 && v.lastIndexOf(\"'\") === v.length - 1) {\n                return v.slice(1, v.length - 1);\n            } else {\n                return v;\n            }\n        },\n        '$data.ObjectID': function $dataObjectID(v) {\n            if (typeof v === 'string' && v.indexOf(\"'\") === 0 && v.lastIndexOf(\"'\") === v.length - 1) {\n                return v.slice(1, v.length - 1);\n            } else {\n                return v;\n            }\n        },\n        '$data.Guid': function $dataGuid(v) {\n            if (/^\\w{8}-\\w{4}-\\w{4}-\\w{4}-\\w{12}$/.test(v)) {\n                var data = v.slice(5, v.length - 1);\n                return _core2.default.parseGuid(data).toString();\n            }\n            return v;\n        },\n        '$data.Array': function $dataArray(v, c) {\n            var config = c || {};\n\n            var value = JSON.parse(v) || [];\n            if (value && config.elementType) {\n                var type = _core.Container.resolveType(config.elementType);\n                var typeName = _core.Container.resolveName(type);\n                if (type && type.isAssignableTo && type.isAssignableTo(_core2.default.Entity)) {\n                    typeName = _core2.default.Entity.fullName;\n                }\n\n                if (Array.isArray(value)) {\n                    var converter = _core2.default.oDataConverter.unescape[typeName];\n                    for (var i = 0; i < value.length; i++) {\n                        value[i] = converter ? converter(value[i]) : value[i];\n                    }\n                }\n                return value;\n            }\n            return value;\n        },\n        '$data.DateTimeOffset': function $dataDateTimeOffset(v) {\n            if (typeof v === 'string') {\n                return _core2.default.Container.convertTo(v, _core2.default.DateTimeOffset);\n            }\n            return v;\n        },\n        '$data.Time': function $dataTime(v) {\n            if (typeof v === 'string' && /^time'/.test(v)) {\n                return _core2.default.Container.convertTo(v.slice(5, v.length - 1), _core2.default.Time);\n            }\n            return v;\n        },\n        '$data.Day': function $dataDay(v) {\n            if (typeof v === 'string' && /^date'/.test(v)) {\n                return _core2.default.Container.convertTo(v.slice(5, v.length - 1), _core2.default.Day);\n            }\n            return v;\n        },\n        '$data.Duration': function $dataDuration(v) {\n            if (typeof v === 'string' && /^duration'/.test(v)) {\n                return _core2.default.Container.convertTo(v.slice(9, v.length - 1), _core2.default.Duration);\n            }\n            return v;\n        },\n        '$data.Blob': function $dataBlob(v) {\n            if (typeof v === 'string') {\n                if (/^X'/.test(v)) {\n                    return _core2.default.Blob.createFromHexString(v.slice(2, v.length - 1));\n                } else if (/^binary'/.test(v)) {\n                    return _core2.default.Blob.createFromHexString(v.slice(7, v.length - 1));\n                }\n            }\n            return v;\n        },\n        '$data.Object': function $dataObject(v) {\n            return JSON.parse(v);\n        },\n        '$data.GeographyPoint': function $dataGeographyPoint(v) {\n            if (/^geography'POINT\\(/i.test(v)) {\n                var data = v.slice(10, v.length - 1);\n                return _core2.default.GeographyBase.parseFromString(data);\n            }\n            return v;\n        },\n        '$data.GeographyPolygon': function $dataGeographyPolygon(v) {\n            if (/^geography'POLYGON\\(/i.test(v)) {\n                var data = v.slice(10, v.length - 1);\n                return _core2.default.GeographyBase.parseFromString(data);\n            }\n            return v;\n        },\n        '$data.GeometryPoint': function $dataGeometryPoint(v) {\n            if (/^geometry'POINT\\(/i.test(v)) {\n                var data = v.slice(9, v.length - 1);\n                return _core2.default.GeometryBase.parseFromString(data);\n            }\n            return v;\n        },\n        '$data.GeometryPolygon': function $dataGeometryPolygon(v) {\n            if (/^geometry'POLYGON\\(/i.test(v)) {\n                var data = v.slice(9, v.length - 1);\n                return _core2.default.GeometryBase.parseFromString(data);\n            }\n            return v;\n        }\n    },\n    xmlEscape: {\n        '$data.Byte': function $dataByte(v) {\n            return v.toString();\n        },\n        '$data.SByte': function $dataSByte(v) {\n            return v.toString();\n        },\n        '$data.Decimal': function $dataDecimal(v) {\n            return v.toString();\n        },\n        '$data.Float': function $dataFloat(v) {\n            return v.toString();\n        },\n        '$data.Int16': function $dataInt16(v) {\n            return v.toString();\n        },\n        '$data.Int64': function $dataInt64(v) {\n            return v.toString();\n        },\n        '$data.Integer': function $dataInteger(v) {\n            return v.toString();\n        },\n        '$data.Int32': function $dataInt32(v) {\n            return v.toString();\n        },\n        '$data.Boolean': function $dataBoolean(v) {\n            return v.toString();\n        },\n        '$data.Blob': function $dataBlob(v) {\n            return _core2.default.Blob.toBase64(v);\n        },\n        '$data.Date': function $dataDate(v) {\n            return v.toISOString().replace('Z', '');\n        },\n        '$data.DateTimeOffset': function $dataDateTimeOffset(v) {\n            return v.toISOString();\n        },\n        '$data.Time': function $dataTime(v) {\n            return v.toString();\n        },\n        '$data.Day': function $dataDay(v) {\n            return v.toString();\n        },\n        '$data.Duration': function $dataDuration(v) {\n            return v.toString();\n        },\n        '$data.Number': function $dataNumber(v) {\n            return v.toString();\n        },\n        '$data.String': function $dataString(v) {\n            return v.toString();\n        },\n        '$data.ObjectID': function $dataObjectID(v) {\n            return v.toString();\n        },\n        '$data.Object': function $dataObject(v) {\n            return JSON.stringify(v);\n        },\n        '$data.Guid': function $dataGuid(v) {\n            return v.toString();\n        } /*,\r\n          '$data.GeographyPoint': function (v) { return this._buildSpatialPoint(v, 'http://www.opengis.net/def/crs/EPSG/0/4326'); },\r\n          '$data.GeometryPoint': function (v) { return this._buildSpatialPoint(v, 'http://www.opengis.net/def/crs/EPSG/0/0'); },\r\n          '$data.GeographyLineString': function (v) { return this._buildSpatialLineString(v, 'http://www.opengis.net/def/crs/EPSG/0/4326'); },\r\n          '$data.GeometryLineString': function (v) { return this._buildSpatialLineString(v, 'http://www.opengis.net/def/crs/EPSG/0/0'); }*/\n    },\n    simple: { //$value, $count\n        '$data.Byte': function $dataByte(v) {\n            return v.toString();\n        },\n        '$data.SByte': function $dataSByte(v) {\n            return v.toString();\n        },\n        '$data.Decimal': function $dataDecimal(v) {\n            return v.toString();\n        },\n        '$data.Float': function $dataFloat(v) {\n            return v.toString();\n        },\n        '$data.Int16': function $dataInt16(v) {\n            return v.toString();\n        },\n        '$data.Int64': function $dataInt64(v) {\n            return v.toString();\n        },\n        '$data.ObjectID': function $dataObjectID(o) {\n            return o.toString();\n        },\n        '$data.Integer': function $dataInteger(o) {\n            return o.toString();\n        },\n        '$data.Int32': function $dataInt32(o) {\n            return o.toString();\n        },\n        '$data.Number': function $dataNumber(o) {\n            return o.toString();\n        },\n        '$data.Date': function $dataDate(o) {\n            return o instanceof _core2.default.Date ? o.toISOString().replace('Z', '') : o.toString();\n        },\n        '$data.DateTimeOffset': function $dataDateTimeOffset(v) {\n            return v ? v.toISOString() : v;\n        },\n        '$data.Time': function $dataTime(o) {\n            return o.toString();\n        },\n        '$data.Day': function $dataDay(o) {\n            return o.toString();\n        },\n        '$data.Duration': function $dataDuration(o) {\n            return o.toString();\n        },\n        '$data.String': function $dataString(o) {\n            return o.toString();\n        },\n        '$data.Boolean': function $dataBoolean(o) {\n            return o.toString();\n        },\n        '$data.Blob': function $dataBlob(o) {\n            return o;\n        },\n        '$data.Object': function $dataObject(o) {\n            return JSON.stringify(o);\n        },\n        '$data.Array': function $dataArray(o) {\n            return JSON.stringify(o);\n        },\n        '$data.Guid': function $dataGuid(o) {\n            return o.toString();\n        },\n        '$data.GeographyPoint': function $dataGeographyPoint(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeometryPoint': function $dataGeometryPoint(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeographyLineString': function $dataGeographyLineString(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeographyPolygon': function $dataGeographyPolygon(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeographyMultiPoint': function $dataGeographyMultiPoint(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeographyMultiLineString': function $dataGeographyMultiLineString(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeographyMultiPolygon': function $dataGeographyMultiPolygon(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeographyCollection': function $dataGeographyCollection(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeometryLineString': function $dataGeometryLineString(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeometryPolygon': function $dataGeometryPolygon(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeometryMultiPoint': function $dataGeometryMultiPoint(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeometryMultiLineString': function $dataGeometryMultiLineString(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeometryMultiPolygon': function $dataGeometryMultiPolygon(o) {\n            return JSON.stringify(o);\n        },\n        '$data.GeometryCollection': function $dataGeometryCollection(o) {\n            return JSON.stringify(o);\n        }\n    }\n};\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"jaydata/core\":\"jaydata/core\"}],7:[function(_dereq_,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.ODataIncludeFragment = undefined;\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ODataIncludeFragment = exports.ODataIncludeFragment = function () {\n    function ODataIncludeFragment(name) {\n        _classCallCheck(this, ODataIncludeFragment);\n\n        this.name = name;\n        this.$expand = [];\n        this.$operators = [];\n    }\n\n    _createClass(ODataIncludeFragment, [{\n        key: 'toString',\n        value: function toString() {\n            var data = '';\n            if (this.$expand.length) {\n                if (this.name) {\n                    data += this.name + '($expand=';\n                }\n                for (var i = 0; i < this.$expand.length; i++) {\n                    if (i !== 0) data += ',';\n                    data += this[this.$expand[i]].toString();\n                }\n                if (this.name) {\n                    data += ')';\n                }\n            }\n\n            if (this.name) {\n                for (var i = 0; i < this.$operators.length; i++) {\n                    var operator = this.$operators[i];\n                    var values = this[operator];\n                    for (var j = 0; j < values.length; j++) {\n                        if (data) data += ',';\n                        data += this.name + '(' + operator + '=';\n                        data += values[j];\n                        data += ')';\n                    }\n                }\n            }\n\n            if (this.name && !data) {\n                data = this.name;\n            }\n\n            return data;\n        }\n    }, {\n        key: 'addInclude',\n        value: function addInclude(path, map) {\n            this._createIncludePath(path);\n        }\n    }, {\n        key: 'addImplicitMap',\n        value: function addImplicitMap(path, map) {\n            var includedFragment = this._createIncludePath(path);\n            this._setImplicitMap(includedFragment, map);\n        }\n    }, {\n        key: '_createIncludePath',\n        value: function _createIncludePath(path) {\n            if (!path) return this;\n            var inc = path.split('.');\n\n            var current = this;\n            for (var i = 0; i < inc.length; i++) {\n                var it = inc[i];\n                var included = true;\n                if (current.$expand.indexOf(it) < 0) {\n                    included = false;\n                    current.$expand.push(it);\n                    current[it] = new ODataIncludeFragment(it);\n                    current[it].__implicit = true;\n                }\n\n                current = current[it];\n                if (i < inc.length - 1 && current.__implicit) {\n                    this._setImplicitMap(current, inc[i + 1]);\n                }\n            }\n\n            return current;\n        }\n    }, {\n        key: '_setImplicitMap',\n        value: function _setImplicitMap(includeFragment, map) {\n            if (map) {\n                if (includeFragment.$operators.indexOf('$select') < 0) {\n                    if (includeFragment.__implicit) {\n                        includeFragment.$operators.push('$select');\n                        includeFragment.$select = [map];\n                    }\n                } else if (includeFragment.$expand.indexOf(map) < 0) {\n                    includeFragment.$select[0] += ',' + map;\n                }\n            }\n        }\n    }]);\n\n    return ODataIncludeFragment;\n}();\n\n_core2.default.storageProviders.oData.ODataIncludeFragment = ODataIncludeFragment;\n\n(0, _core.$C)('$data.storageProviders.oData.oDataIncludeCompiler', _core2.default.Expressions.EntityExpressionVisitor, null, {\n    constructor: function constructor(provider) {\n        this.provider = provider;\n    },\n\n    compile: function compile(expression, context) {\n        context.data = context.data || new ODataIncludeFragment();\n        context.current = context.data;\n        this.Visit(expression, context);\n    },\n    VisitParametricQueryExpression: function VisitParametricQueryExpression(expression, context) {\n        this.Visit(expression.expression, context);\n    },\n\n    VisitEntitySetExpression: function VisitEntitySetExpression(expression, context) {\n        this.Visit(expression.source, context);\n        if (expression.selector instanceof _core2.default.Expressions.AssociationInfoExpression) {\n            this.Visit(expression.selector, context);\n        }\n    },\n\n    VisitAssociationInfoExpression: function VisitAssociationInfoExpression(expression, context) {\n        var propName = expression.associationInfo.FromPropertyName;\n\n        this.includePath = this.includePath ? this.includePath + '.' : \"\";\n        this.includePath += propName;\n\n        var currentPath = this.includePath;\n        if (!context.includes.some(function (include) {\n            return include.name == currentPath;\n        }, this)) {\n            context.includes.push({ name: currentPath, type: expression.associationInfo.ToType });\n        }\n\n        if (context.current.$expand.indexOf(propName) < 0) {\n            context.current.$expand.push(propName);\n            context.current[propName] = new ODataIncludeFragment(propName);\n        }\n        context.current = context.current[propName];\n    },\n\n    VisitFrameOperationExpression: function VisitFrameOperationExpression(expression, context) {\n        this.Visit(expression.source, context);\n\n        var opDef = expression.operation.memberDefinition;\n        if (opDef && opDef.includeFrameName) {\n            var opName = opDef.includeFrameName;\n            var paramCounter = 0;\n            var params = opDef.parameters || [{ name: \"@expression\" }];\n\n            var args = params.map(function (item, index) {\n                if (item.name === \"@expression\") {\n                    return expression.source;\n                } else {\n                    return expression.parameters[paramCounter++];\n                };\n            });\n\n            if (opDef.includeCompiler) {\n                for (var i = 0; i < args.length; i++) {\n                    var arg = args[i];\n                    var compilerType = _core.Container.resolveType(opDef.includeCompiler);\n                    var compiler = new compilerType(this.provider);\n                    var frameContext = { data: \"\", $expand: context.current };\n\n                    if (arg && arg.value instanceof _core2.default.Queryable) {\n                        var preparator = _core.Container.createQueryExpressionCreator(arg.value.entityContext);\n                        var prep_expression = preparator.Visit(arg.value.expression);\n                        arg = prep_expression;\n                    }\n\n                    var compiled = compiler.compile(arg, frameContext);\n\n                    if (context.current['$operators'].indexOf(opName) < 0) {\n                        context.current[opName] = [];\n                        context.current['$operators'].push(opName);\n                    }\n                    context.current[opName].push(frameContext[opName] || frameContext.data);\n                }\n            } else if (opDef.implementation) {\n                if (context.current['$operators'].indexOf(opName) < 0) {\n                    context.current[opName] = [];\n                    context.current['$operators'].push(opName);\n                }\n                context.current[opName].push(opDef.implementation());\n            }\n        }\n    }\n});\n\n},{\"jaydata/core\":\"jaydata/core\"}],8:[function(_dereq_,module,exports){\n'use strict';\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n(0, _core.$C)('$data.storageProviders.oData.oDataOrderCompiler', _core2.default.storageProviders.oData.oDataWhereCompiler, null, {\n    constructor: function constructor(provider) {\n        this.provider = provider;\n    },\n\n    compile: function compile(expression, context) {\n        this.Visit(expression, context);\n    },\n    VisitOrderExpression: function VisitOrderExpression(expression, context) {\n        var orderContext = { data: \"\" };\n        this.Visit(expression.selector, orderContext);\n        if (context['$orderby']) {\n            context['$orderby'] += ',';\n        } else {\n            context['$orderby'] = '';\n        }\n        context['$orderby'] += orderContext.data + (expression.nodeType == _core2.default.Expressions.ExpressionType.OrderByDescending ? \" desc\" : \"\");\n    },\n    VisitParametricQueryExpression: function VisitParametricQueryExpression(expression, context) {\n        this.Visit(expression.expression, context);\n    },\n    VisitEntityFieldExpression: function VisitEntityFieldExpression(expression, context) {\n        this.Visit(expression.source, context);\n        this.Visit(expression.selector, context);\n    },\n    VisitComplexTypeExpression: function VisitComplexTypeExpression(expression, context) {\n        this.Visit(expression.source, context);\n        this.Visit(expression.selector, context);\n        context.data += \"/\";\n    },\n    VisitEntitySetExpression: function VisitEntitySetExpression(expression, context) {\n        if (expression.selector instanceof _core2.default.Expressions.AssociationInfoExpression) {\n            this.Visit(expression.source, context);\n            this.Visit(expression.selector, context);\n        }\n    },\n    VisitAssociationInfoExpression: function VisitAssociationInfoExpression(expression, context) {\n        context.data += expression.associationInfo.FromPropertyName + '/';\n    },\n    VisitEntityExpression: function VisitEntityExpression(expression, context) {\n        this.Visit(expression.source, context);\n        this.Visit(expression.selector, context);\n    },\n    VisitMemberInfoExpression: function VisitMemberInfoExpression(expression, context) {\n        context.data += expression.memberName;\n    },\n    VisitEntityFieldOperationExpression: function VisitEntityFieldOperationExpression(expression, context) {\n        _core.Guard.requireType(\"expression.operation\", expression.operation, _core2.default.Expressions.MemberInfoExpression);\n\n        //TODO refactor!\n        var opDef = expression.operation.memberDefinition;\n        var opName = opDef.mapTo || opDef.name;\n        context.data += opName;\n        context.data += \"(\";\n        var paramCounter = 0;\n        var params = opDef.parameters || [{ name: \"@expression\" }];\n\n        var args = params.map(function (item, index) {\n            if (item.name === \"@expression\") {\n                return expression.source;\n            } else {\n                return expression.parameters[paramCounter++];\n            };\n        });\n\n        args.forEach(function (arg, index) {\n            if (index > 0) {\n                context.data += \",\";\n            };\n            this.Visit(arg, context);\n        }, this);\n        context.data += \")\";\n    },\n    VisitEntityFunctionOperationExpression: function VisitEntityFunctionOperationExpression(expression, context) {\n        _core.Guard.requireType(\"expression.operation\", expression.operation, _core2.default.Expressions.MemberInfoExpression);\n        this.Visit(expression.source, context);\n\n        //TODO refactor!\n        var opDef = expression.operation.memberDefinition;\n        var opName = opDef.mapTo || opDef.name;\n        context.data += opName;\n        context.data += \"(\";\n        var paramCounter = 0;\n        var params = opDef.method.params || [{ name: \"@expression\" }];\n\n        var args = params.map(function (item, index) {\n            if (item.name === \"@expression\") {\n                return expression.source;\n            } else {\n                return expression.parameters[paramCounter++];\n            };\n        });\n\n        var i = 0;\n        args.forEach(function (arg, index) {\n            if (arg === undefined || arg instanceof _core2.default.Expressions.ConstantExpression && typeof arg.value === 'undefined') return;\n\n            if (i > 0) {\n                context.data += \",\";\n            };\n            i++;\n            context.data += params[index].name + '=';\n            this.Visit(arg, context);\n        }, this);\n        context.data += \")\";\n    },\n    VisitContextFunctionOperationExpression: function VisitContextFunctionOperationExpression(expression, context) {\n        return this.VisitEntityFunctionOperationExpression(expression, context);\n    }\n});\n\n},{\"jaydata/core\":\"jaydata/core\"}],9:[function(_dereq_,module,exports){\n'use strict';\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n(0, _core.$C)('$data.storageProviders.oData.oDataPagingCompiler', _core2.default.Expressions.EntityExpressionVisitor, null, {\n    constructor: function constructor(provider) {\n        this.provider = provider;\n    },\n\n    compile: function compile(expression, context) {\n        this.Visit(expression, context);\n    },\n    VisitPagingExpression: function VisitPagingExpression(expression, context) {\n        var pagingContext = { data: \"\" };\n        this.Visit(expression.amount, pagingContext);\n        switch (expression.nodeType) {\n            case _core2.default.Expressions.ExpressionType.Skip:\n                context['$skip'] = pagingContext.data;break;\n            case _core2.default.Expressions.ExpressionType.Take:\n                context['$top'] = pagingContext.data;break;\n            default:\n                _core.Guard.raise(\"Not supported nodeType\");break;\n        }\n    },\n    VisitConstantExpression: function VisitConstantExpression(expression, context) {\n        var typeName = _core.Container.resolveName(expression.type);\n        var converter = this.provider.fieldConverter.escape[typeName];\n        context.data += converter ? converter(expression.value) : expression.value;\n    }\n});\n\n},{\"jaydata/core\":\"jaydata/core\"}],10:[function(_dereq_,module,exports){\n'use strict';\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n(0, _core.$C)('$data.storageProviders.oData.oDataProjectionCompiler', _core2.default.Expressions.EntityExpressionVisitor, null, {\n    constructor: function constructor(provider) {\n        this.provider = provider;\n        this.entityContext = provider.context;\n        this.hasObjectLiteral = false;\n        this.modelBinderMapping = [];\n    },\n\n    compile: function compile(expression, context) {\n        this.Visit(expression, context);\n    },\n    VisitProjectionExpression: function VisitProjectionExpression(expression, context) {\n        ///<summary></summary>\n        ///<param name=\"expression\" type=\"$data.Expressions.ProjectionExpression\" mayBeNull=\"false\"></param>\n        ///<param name=\"context\" mayBeNull=\"false\"></param>\n        context.data = \"\";\n        this.mapping = \"\";\n\n        this.Visit(expression.selector, context);\n        if (context['$select']) {\n            context['$select'] += ',';\n        } else {\n            context['$select'] = '';\n        }\n        context[\"$select\"] += context.data;\n        context.data = \"\";\n    },\n    VisitParametricQueryExpression: function VisitParametricQueryExpression(expression, context) {\n        this.Visit(expression.expression, context);\n        var m = this.mapping.split('.');\n\n        if (!(expression.expression instanceof _core2.default.Expressions.EntityExpression) && !(expression.expression instanceof _core2.default.Expressions.EntitySetExpression)) {\n            m.pop();\n        }\n\n        if (m.length > 0) {\n            if (!context['$expand'] || !(context['$expand'] instanceof _core2.default.storageProviders.oData.ODataIncludeFragment)) {\n                context['$expand'] = new _core2.default.storageProviders.oData.ODataIncludeFragment();\n            }\n            context['$expand'].addInclude(m.join('.'));\n        }\n    },\n    VisitObjectLiteralExpression: function VisitObjectLiteralExpression(expression, context) {\n        ///<summary></summary>\n        ///<param name=\"expression\" type=\"$data.Expressions.ObjectLiteralExpression\" mayBeNull=\"false\"></param>\n        ///<param name=\"context\" mayBeNull=\"false\"></param>\n\n        this.hasObjectLiteral = true;\n        expression.members.forEach(function (member, index) {\n            this.Visit(member, context);\n            if (index < expression.members.length - 1) {\n                context.data += ',';\n            }\n            this.mapping = '';\n        }, this);\n    },\n    VisitObjectFieldExpression: function VisitObjectFieldExpression(expression, context) {\n        this.Visit(expression.expression, context);\n\n        var m = this.mapping.split('.');\n        var propertyName = \"\";\n        if (!(expression.expression instanceof _core2.default.Expressions.EntityExpression) && !(expression.expression instanceof _core2.default.Expressions.EntitySetExpression)) {\n            propertyName = m.pop();\n        }\n\n        if (m.length > 0) {\n            if (!context['$expand'] || !(context['$expand'] instanceof _core2.default.storageProviders.oData.ODataIncludeFragment)) {\n                context['$expand'] = new _core2.default.storageProviders.oData.ODataIncludeFragment();\n            }\n\n            if (expression.expression instanceof _core2.default.Expressions.EntityFieldExpression && expression.expression.selector instanceof _core2.default.Expressions.MemberInfoExpression) {\n                var storageModel = this.entityContext._storageModel.getStorageModel(expression.expression.selector.memberDefinition.definedBy);\n                if (!storageModel) return;\n\n                var isComplexProperty = storageModel && !!storageModel.ComplexTypes[expression.memberName];\n                if (isComplexProperty) {\n                    var complexProperty = m.pop();\n                    context['$expand'].addImplicitMap(m.join('.'), complexProperty);\n                    return;\n                }\n            }\n\n            if (expression.expression instanceof _core2.default.Expressions.ComplexTypeExpression) {\n                context['$expand'].addImplicitMap(m.join('.'), propertyName);\n            } else {\n                context['$expand'].addInclude(m.join('.'));\n            }\n        }\n    },\n\n    VisitComplexTypeExpression: function VisitComplexTypeExpression(expression, context) {\n        this.Visit(expression.source, context);\n        this.Visit(expression.selector, context);\n    },\n\n    VisitEntityFieldExpression: function VisitEntityFieldExpression(expression, context) {\n        this.Visit(expression.source, context);\n        this.Visit(expression.selector, context);\n    },\n    VisitEntityExpression: function VisitEntityExpression(expression, context) {\n        ///<summary></summary>\n        ///<param name=\"expression\" type=\"$data.Expressions.EntityExpression\" mayBeNull=\"false\"></param>\n        ///<param name=\"context\" mayBeNull=\"false\"></param>\n        this.Visit(expression.source, context);\n    },\n    VisitEntitySetExpression: function VisitEntitySetExpression(expression, context) {\n        ///<summary></summary>\n        ///<param name=\"expression\" type=\"$data.Expressions.EntitySetExpression\" mayBeNull=\"false\"></param>\n        ///<param name=\"context\" mayBeNull=\"false\"></param>\n        if (expression.source instanceof _core2.default.Expressions.EntityExpression) {\n            this.Visit(expression.source, context);\n        }\n        if (expression.selector instanceof _core2.default.Expressions.AssociationInfoExpression) {\n            this.Visit(expression.selector, context);\n        }\n    },\n    VisitAssociationInfoExpression: function VisitAssociationInfoExpression(expression, context) {\n        if (this.mapping && this.mapping.length > 0) {\n            this.mapping += '.';\n        }\n        this.mapping += expression.associationInfo.FromPropertyName;\n\n        if (context.data && context.data.length > 0 && context.data[context.data.length - 1] != ',') {\n            if (!context['$expand'] || !(context['$expand'] instanceof _core2.default.storageProviders.oData.ODataIncludeFragment)) {\n                context['$expand'] = new _core2.default.storageProviders.oData.ODataIncludeFragment();\n            }\n            context['$expand'].addInclude(this.mapping);\n        } else {\n            context.data += expression.associationInfo.FromPropertyName;\n        }\n    },\n    VisitMemberInfoExpression: function VisitMemberInfoExpression(expression, context) {\n        var storageModel = this.entityContext._storageModel.getStorageModel(expression.memberDefinition.definedBy);\n        var isComplexProperty = storageModel && !!storageModel.ComplexTypes[expression.memberName];\n        var isComplexField = !storageModel;\n\n        if (context.data && context.data.length > 0 && context.data[context.data.length - 1] != ',') {\n            if (this.mapping) {\n                if (!context['$expand'] || !(context['$expand'] instanceof _core2.default.storageProviders.oData.ODataIncludeFragment)) {\n                    context['$expand'] = new _core2.default.storageProviders.oData.ODataIncludeFragment();\n                }\n                if (isComplexField) {\n                    var m = this.mapping.split('.');\n                    var complexProperty = m.pop();\n                    if (this.provider.checkODataMode(\"disableCompltexTypeMapping\")) {\n                        context['$expand'].addImplicitMap(m.join('.'), complexProperty);\n                    } else {\n                        context['$expand'].addImplicitMap(m.join('.'), complexProperty + \"/\" + expression.memberName);\n                    }\n                } else if (!isComplexProperty) {\n                    context['$expand'].addImplicitMap(this.mapping, expression.memberName);\n                }\n            }\n        } else {\n            //if(context.data[context.data.length - 1] != ',') context.data += '/';\n            context.data += expression.memberName;\n        }\n\n        if (this.mapping && this.mapping.length > 0) {\n            this.mapping += '.';\n        }\n        this.mapping += expression.memberName;\n    },\n    VisitConstantExpression: function VisitConstantExpression(expression, context) {\n        //Guard.raise(new Exception('Constant value is not supported in Projection.', 'Not supported!'));\n        //context.data += expression.value;\n        context.data = context.data.slice(0, context.data.length - 1);\n    }\n});\n\n},{\"jaydata/core\":\"jaydata/core\"}],11:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nvar _jaydataOdatajs = (typeof window !== \"undefined\" ? window['odatajs'] : typeof global !== \"undefined\" ? global['odatajs'] : null);\n\nvar odatajs = _interopRequireWildcard(_jaydataOdatajs);\n\nvar _oDataRequestActivities = _dereq_('./oDataRequestActivities.js');\n\nvar activities = _interopRequireWildcard(_oDataRequestActivities);\n\nvar _empty = _dereq_('./SaveStrategies/empty');\n\nvar _single = _dereq_('./SaveStrategies/single');\n\nvar _batch = _dereq_('./SaveStrategies/batch');\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar OData = _core2.default.__global['OData'];\nvar datajs = _core2.default.__global['datajs'];\n\nvar _datajsPatch;\n_datajsPatch = function datajsPatch(OData) {\n    // just datajs-1.1.0\n    if (OData && OData.jsonHandler && 'useJsonLight' in OData.jsonHandler && (typeof datajs === 'undefined' ? 'undefined' : _typeof(datajs)) === 'object' && !datajs.version) {\n        _core2.default.Trace.log('!!!!!!! - patch datajs 1.1.0');\n        var oldread = OData.defaultHandler.read;\n        OData.defaultHandler.read = function (p, context) {\n            delete context.contentType;\n            delete context.dataServiceVersion;\n\n            oldread.apply(this, arguments);\n        };\n        var oldwrite = OData.defaultHandler.write;\n        OData.defaultHandler.write = function (p, context) {\n            delete context.contentType;\n            delete context.dataServiceVersion;\n\n            oldwrite.apply(this, arguments);\n        };\n    }\n    _datajsPatch = function datajsPatch() {};\n};\n\n_core2.default.defaults = _core2.default.defaults || {};\n_core2.default.defaults.OData = _core2.default.defaults.OData || {};\nif (!(\"withReferenceMethods\" in _core2.default.defaults.OData)) {\n    _core2.default.defaults.OData.withReferenceMethods = false;\n}\nif (!(\"disableBatch\" in _core2.default.defaults.OData)) {\n    _core2.default.defaults.OData.disableBatch = false;\n}\nif (!(\"eTagAny\" in _core2.default.defaults.OData)) {\n    _core2.default.defaults.OData.eTagAny = '*';\n}\nif (!(\"enableDeepSave\" in _core2.default.defaults.OData)) {\n    _core2.default.defaults.OData.enableDeepSave = false;\n}\nif (!(\"disableCompltexTypeMapping\" in _core2.default.defaults.OData)) {\n    _core2.default.defaults.OData.disableCompltexTypeMapping = false;\n}\n\nvar _checkODataMode = function _checkODataMode(context, functionName) {\n    if (typeof context.providerConfiguration[functionName] !== 'undefined') {\n        return !!context.providerConfiguration[functionName];\n    }\n    return !!_core2.default.defaults.OData[functionName];\n};\n\n(0, _core.$C)('$data.storageProviders.oData.RequestManager', _core2.default.Base, null, {\n    constructor: function constructor() {\n        this._items = [];\n        this._entities = [];\n    },\n    _items: { type: _core2.default.Array },\n    _entities: { type: _core2.default.Array },\n    add: function add(changedItem, request, countable) {\n        var item = {\n            data: changedItem,\n            entity: changedItem.data,\n            request: request,\n            itemIndex: ++this.maxItemIndex,\n            references: []\n        };\n\n        // request.headers = request.headers || {};\n        // request.headers[\"content-Id\"] = item.itemIndex;\n        request.add(new activities.SetHeaderProperty(\"content-Id\", item.itemIndex));\n\n        if (countable !== false) {\n            this.length++;\n        }\n\n        this._entities.push(item.entity);\n        this._items.push(item);\n\n        return item;\n    },\n    addItemReference: function addItemReference(entity, reference) {\n        var item = this.getItem(entity);\n        if (item) {\n            item.references.push(reference);\n        }\n    },\n    getItemIndex: function getItemIndex(entity) {\n        if (!entity) return -1;\n        var idx = this._entities.indexOf(entity);\n        if (idx >= 0 && !this._items[idx].removed) {\n            return this._items[idx].itemIndex;\n        }\n        return -1;\n    },\n    getItem: function getItem(entity, onlyAvailable) {\n        if (!entity) return null;\n        var idx = this._entities.indexOf(entity);\n        if (idx >= 0 && (!onlyAvailable || !this._items[idx].removed)) {\n            return this._items[idx];\n        }\n        return null;\n    },\n    remove: function remove(entity) {\n        var idx = this._entities.indexOf(entity);\n        if (idx >= 0) {\n            var item = this._items[idx];\n            if (!item.removed) {\n                this._items[idx].removed = true;\n                this.length--;\n                return true;\n            }\n        }\n        return false;\n    },\n    getItems: function getItems() {\n        return this._items.filter(function (it) {\n            return !it.removed;\n        });\n    },\n    getByResponse: function getByResponse(response, i) {\n        //use response.headers['content-id']\n\n        var idx = i;\n\n        if (!this._indexCalculated) {\n            this._indexCalculated = true;\n            this._dataForResult = this._items.filter(function (it) {\n                return !it.removed;\n            });\n        }\n\n        var item = this._dataForResult[idx++];\n        return item ? item.entity : null;\n    },\n    setProcessed: function setProcessed(entity) {\n        var idx = this._entities.indexOf(entity);\n        if (idx >= 0) {\n            var item = this._items[idx];\n            if (!item.isProcessed) {\n                this._items[idx].isProcessed = true;\n                return true;\n            }\n        }\n        return false;\n    },\n\n    maxItemIndex: { value: 0 },\n    length: { value: 0 }\n});\n\n(0, _core.$C)('$data.storageProviders.oData.oDataProvider', _core2.default.StorageProviderBase, null, {\n    constructor: function constructor(cfg, ctx) {\n        this.SqlCommands = [];\n        this.context = ctx;\n        this.providerConfiguration = _core2.default.typeSystem.extend({\n            dbCreation: _core2.default.storageProviders.DbCreationType.DropTableIfChanged,\n            oDataServiceHost: \"/odata.svc\",\n            serviceUrl: \"\",\n            maxDataServiceVersion: '4.0',\n            dataServiceVersion: undefined,\n            user: null,\n            password: null,\n            withCredentials: false,\n            //enableJSONP: undefined,\n            //useJsonLight: undefined\n            //disableBatch: undefined\n            //withReferenceMethods: undefined\n            //enableDeepSave: undefined\n            UpdateMethod: 'PATCH'\n        }, cfg);\n\n        if (this.providerConfiguration.maxDataServiceVersion === \"4.0\") {\n            if (typeof odatajs === 'undefined' || typeof odatajs.oData === 'undefined') {\n                _core.Guard.raise(new _core.Exception('odatajs is required', 'Not Found!'));\n            } else {\n                this.oData = odatajs.oData;\n            }\n        } else {\n            if (typeof OData === 'undefined') {\n                _core.Guard.raise(new _core.Exception('datajs is required', 'Not Found!'));\n            } else {\n                this.oData = OData;\n                _datajsPatch(this.oData);\n            }\n        }\n\n        //this.fixkDataServiceVersions(cfg);\n\n        if (this.context && this.context._buildDbType_generateConvertToFunction && this.buildDbType_generateConvertToFunction) {\n            this.context._buildDbType_generateConvertToFunction = this.buildDbType_generateConvertToFunction;\n        }\n        if (this.context && this.context._buildDbType_modifyInstanceDefinition && this.buildDbType_modifyInstanceDefinition) {\n            this.context._buildDbType_modifyInstanceDefinition = this.buildDbType_modifyInstanceDefinition;\n        }\n    },\n    fixkDataServiceVersions: function fixkDataServiceVersions(cfg) {\n        if (this.providerConfiguration.dataServiceVersion > this.providerConfiguration.maxDataServiceVersion) {\n            this.providerConfiguration.dataServiceVersion = this.providerConfiguration.maxDataServiceVersion;\n        }\n\n        if (this.providerConfiguration.setDataServiceVersionToMax === true) {\n            this.providerConfiguration.dataServiceVersion = this.providerConfiguration.maxDataServiceVersion;\n        }\n\n        if (cfg && !cfg.UpdateMethod && this.providerConfiguration.dataServiceVersion < '3.0' || !this.providerConfiguration.dataServiceVersion) {\n            this.providerConfiguration.UpdateMethod = 'MERGE';\n        }\n    },\n    initializeStore: function initializeStore(callBack) {\n        callBack = _core2.default.PromiseHandlerBase.createCallbackSettings(callBack);\n        switch (this.providerConfiguration.dbCreation) {\n            case _core2.default.storageProviders.DbCreationType.DropAllExistingTables:\n                var that = this;\n                if (this.providerConfiguration.serviceUrl) {\n\n                    var requestData = [{\n                        requestUri: that.providerConfiguration.serviceUrl + \"/Delete\",\n                        method: 'POST'\n                    }, function (d) {\n                        //console.log(\"RESET oData database\");\n                        callBack.success(that.context);\n                    }, function (error) {\n                        callBack.success(that.context);\n                    }];\n\n                    this.appendBasicAuth(requestData[0], this.providerConfiguration.user, this.providerConfiguration.password, this.providerConfiguration.withCredentials);\n                    //if (this.providerConfiguration.user) {\n                    //    requestData[0].user = this.providerConfiguration.user;\n                    //    requestData[0].password = this.providerConfiguration.password || \"\";\n                    //}\n\n                    this.context.prepareRequest.call(this, requestData);\n                    this.oData.request.apply(this, requestData);\n                } else {\n                    callBack.success(that.context);\n                }\n                break;\n            default:\n                callBack.success(this.context);\n                break;\n        }\n    },\n    buildDbType_generateConvertToFunction: function buildDbType_generateConvertToFunction(storageModel, context) {\n        return function (logicalEntity, convertedItems) {\n            var dbInstance = new storageModel.PhysicalType();\n            dbInstance.entityState = logicalEntity.entityState;\n\n            storageModel.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function (property) {\n                dbInstance.initData[property.name] = logicalEntity[property.name];\n            }, this);\n\n            if (storageModel.Associations) {\n                storageModel.Associations.forEach(function (association) {\n                    if (association.FromMultiplicity == \"*\" && association.ToMultiplicity == \"0..1\" || association.FromMultiplicity == \"0..1\" && association.ToMultiplicity == \"1\" || association.FromMultiplicity == '$$unbound') {\n                        var refValue = logicalEntity[association.FromPropertyName];\n                        if ( /*refValue !== null &&*/refValue !== undefined) {\n                            if (refValue instanceof _core2.default.Array) {\n                                dbInstance.initData[association.FromPropertyName] = dbInstance[association.FromPropertyName] || [];\n                                refValue.forEach(function (rv) {\n                                    var item = convertedItems.getItem(rv, true);\n                                    var contentId = item ? item.itemIndex : -1;\n                                    if (rv.entityState == _core2.default.EntityState.Modified || contentId < 0) {\n                                        var sMod = context._storageModel.getStorageModel(rv.getType());\n                                        var tblName = sMod.TableName;\n                                        var pk = '(' + context.storageProvider.getEntityKeysValue({ data: rv, entitySet: context.getEntitySetFromElementType(rv.getType()) }) + ')';\n                                        dbInstance.initData[association.FromPropertyName].push({ __metadata: { uri: tblName + pk } });\n                                    } else {\n                                        if (contentId < 0) {\n                                            _core.Guard.raise(\"Dependency graph error\");\n                                        }\n                                        //dbInstance.initData[association.FromPropertyName].push({ __metadata: { uri: \"$\" + (contentId) } });\n                                        dbInstance.initData[association.FromPropertyName].push({ __convertedRefence: item });\n                                    }\n                                }, this);\n                            } else if (refValue === null) {\n                                dbInstance.initData[association.FromPropertyName] = null;\n                            } else {\n                                var item = convertedItems.getItem(refValue, true);\n                                var contentId = item ? item.itemIndex : -1;\n                                if (refValue.entityState == _core2.default.EntityState.Modified || contentId < 0) {\n                                    var sMod = context._storageModel.getStorageModel(refValue.getType());\n                                    var tblName = sMod.TableName;\n                                    var pk = '(' + context.storageProvider.getEntityKeysValue({ data: refValue, entitySet: context.getEntitySetFromElementType(refValue.getType()) }) + ')';\n                                    dbInstance.initData[association.FromPropertyName] = { __metadata: { uri: tblName + pk } };\n                                } else {\n                                    if (contentId < 0) {\n                                        _core.Guard.raise(\"Dependency graph error\");\n                                    }\n                                    //dbInstance.initData[association.FromPropertyName] = { __metadata: { uri: \"$\" + (contentId) } };\n                                    dbInstance.initData[association.FromPropertyName] = { __convertedRefence: item };\n                                }\n                            }\n                        }\n                    }\n                }, this);\n            }\n            if (storageModel.ComplexTypes) {\n                storageModel.ComplexTypes.forEach(function (cmpType) {\n                    dbInstance.initData[cmpType.FromPropertyName] = logicalEntity[cmpType.FromPropertyName];\n                }, this);\n            }\n            return dbInstance;\n        };\n    },\n    buildDbType_modifyInstanceDefinition: function buildDbType_modifyInstanceDefinition() {\n        return;\n    },\n    executeQuery: function executeQuery(query, callBack) {\n        callBack = _core2.default.PromiseHandlerBase.createCallbackSettings(callBack);\n\n        var sql = {};\n        try {\n            sql = this._compile(query);\n        } catch (e) {\n            callBack.error(e);\n            return;\n        }\n        var schema = this.context;\n\n        var that = this;\n        var countProperty = \"@odata.count\";\n\n        var requestData = [{\n            requestUri: this.providerConfiguration.oDataServiceHost + sql.queryText,\n            method: sql.method,\n            data: sql.postData,\n            headers: {}\n        }, function (data, textStatus, jqXHR) {\n\n            if (!data && textStatus.body && !sql.isBatchExecuteQuery) data = JSON.parse(textStatus.body);\n            if (callBack.success) {\n                var processSuccess = function processSuccess(query, data, sql) {\n                    query.rawDataList = typeof data === 'string' ? [{ cnt: _core.Container.convertTo(data, _core2.default.Integer) }] : data;\n                    if (sql.withInlineCount && (typeof data === 'undefined' ? 'undefined' : _typeof(data)) === 'object' && (typeof data[countProperty] !== 'undefined' || 'd' in data && typeof data.d[countProperty] !== 'undefined')) {\n                        query.__count = new Number(typeof data[countProperty] !== 'undefined' ? data[countProperty] : data.d[countProperty]).valueOf();\n                    }\n                };\n\n                if (sql.isBatchExecuteQuery) {\n                    query.rawDataList = sql.subQueries;\n                    for (var i = 0; i < data.__batchResponses.length; i++) {\n                        var resp = data.__batchResponses[i];\n\n                        if (!resp.data) {\n                            if (resp.body) {\n                                resp.data = JSON.parse(resp.body);\n                            } else {\n                                callBack.error(that.parseError(resp, arguments));\n                                return;\n                            }\n                        }\n\n                        processSuccess(sql.subQueries[i], resp.data, sql.subQueries[i]._getComplitedData());\n                    }\n                } else {\n                    processSuccess(query, data, sql);\n                }\n\n                callBack.success(query);\n            }\n        }, function (error) {\n            callBack.error(that.parseError(error, arguments));\n        }, sql.isBatchExecuteQuery ? this.oData.batch.batchHandler : undefined];\n\n        if (typeof this.providerConfiguration.enableJSONP !== 'undefined') {\n            requestData[0].enableJsonpCallback = this.providerConfiguration.enableJSONP;\n        }\n        if (typeof this.providerConfiguration.useJsonLight !== 'undefined') {\n            requestData[0].useJsonLight = this.providerConfiguration.useJsonLight;\n        }\n\n        this.appendBasicAuth(requestData[0], this.providerConfiguration.user, this.providerConfiguration.password, this.providerConfiguration.withCredentials);\n        //if (this.providerConfiguration.user) {\n        //    requestData[0].user = this.providerConfiguration.user;\n        //    requestData[0].password = this.providerConfiguration.password || \"\";\n        //}\n\n        this.context.prepareRequest.call(this, requestData);\n        //$data.ajax(requestData);\n        //OData.request(requestData, requestData.success, requestData.error);\n        this.oData.request.apply(this, requestData);\n    },\n    _compile: function _compile(queryable, params) {\n        var compiler = new _core2.default.storageProviders.oData.oDataCompiler();\n        var compiled = compiler.compile(queryable);\n        return compiled;\n    },\n    saveChanges: function saveChanges(callBack, changedItems) {\n        if (changedItems.length > 0) {\n            this.saveInternal(changedItems, callBack);\n        } else {\n            callBack.success(0);\n        }\n    },\n    saveInternal: function saveInternal(changedItems, callBack) {\n        var independentBlocks = this.buildIndependentBlocks(changedItems);\n        if (_checkODataMode(this, \"enableDeepSave\")) {\n            this._checkDeepSave(changedItems);\n        }\n        var convertedItems = this._buildSaveData(independentBlocks, changedItems);\n        var actionMode = this.saveStrategySelector(convertedItems);\n        if (actionMode) {\n            actionMode.save(this, convertedItems, callBack);\n        } else {\n            callBack.error(new _core.Exception('Not Found', 'Save action not found'));\n        }\n    },\n    saveStrategySelector: function saveStrategySelector(convertedItems) {\n        for (var i = 0; i < this.saveStrategies.length; i++) {\n            var saveAction = this.saveStrategies[i];\n            if (saveAction.condition(this, convertedItems)) {\n                return saveAction;\n            }\n        }\n\n        return null;\n    },\n    saveStrategies: {\n        value: [_batch.strategy, _single.strategy, _empty.strategy]\n    },\n\n    _discoverSaveOrder: function _discoverSaveOrder(changedItems) {\n        var entityItems = changedItems.map(function (it) {\n            return it.data;\n        });\n        var entityInfo = changedItems.map(function (it) {\n            return { path: [], visited: false, result: true };\n        });\n        var entityQueue = [];\n        var discoveredEntities = [];\n\n        var process = function process(currentEntity) {\n            var index = entityItems.indexOf(currentEntity);\n            var changedItem = changedItems[index];\n            var info = entityInfo[index];\n\n            if (info.visited) return info.result;\n            if (info.visiting) return false;\n\n            var references = [];\n            if (changedItem.referredBy) {\n                references = references.concat(changedItem.referredBy);\n            }\n            if (changedItem.dependentOn) {\n                references = references.concat(changedItem.dependentOn);\n            }\n\n            for (var i = 0; i < references.length; i++) {\n                var ref = references[i];\n                if (discoveredEntities.indexOf(ref) < 0) {\n                    entityQueue.push(ref);\n                    discoveredEntities.push(ref);\n                    var refIndex = entityItems.indexOf(ref);\n                    changedItems[refIndex].deepParent = currentEntity;\n                }\n            }\n        };\n\n        for (var i = 0; i < changedItems.length; i++) {\n            var changedItem = changedItems[i];\n            if (entityQueue.indexOf(changedItem.data) < 0) {\n                entityQueue.push(changedItem.data);\n                discoveredEntities.push(changedItem.data);\n                entityInfo[i].parent = null;\n            }\n\n            while (entityQueue.length) {\n                var currentItem = entityQueue.shift();\n                process(currentItem);\n            }\n        }\n    },\n\n    _checkDeepSave: function _checkDeepSave(changedItems) {\n        var entityItems = changedItems.map(function (it) {\n            return it.data;\n        });\n        var entityInfo = changedItems.map(function (it) {\n            return { path: [], visited: false, result: true };\n        });\n\n        var discover = function discover(changedItem, parent, index) {\n            var info = entityInfo[index];\n            if (info.visited) return info.result;\n            if (info.visiting) return false;\n\n            var references = [];\n            if (changedItem.referredBy) {\n                references = references.concat(changedItem.referredBy);\n            }\n            if (changedItem.dependentOn) {\n                references = references.concat(changedItem.dependentOn);\n            }\n\n            if (references.length === 0) {\n                info.visited = true;\n                info.result = true;\n            } else {\n                info.visiting = true;\n\n                for (var i = 0; i < references.length; i++) {\n                    var entity = references[i];\n                    var idx = entityItems.indexOf(entity);\n                    var innerChangeItem = changedItems[idx];\n                    if (!innerChangeItem) return false;\n                    if (innerChangeItem === parent) continue;\n\n                    var result = discover(innerChangeItem, changedItem, idx);\n                    info.result = info.result && changedItem.data.entityState === _core2.default.EntityState.Added && (!changedItem.additionalDependentOn || changedItem.additionalDependentOn.length === 0) && result;\n                }\n                delete info.visiting;\n                info.visited = true;\n            }\n\n            changedItem.enableDeepSave = info.result;\n            return info.result;\n        };\n\n        for (var i = 0; i < changedItems.length; i++) {\n            var changedItem = changedItems[i];\n            discover(changedItem, null, i);\n        }\n\n        this._discoverSaveOrder(changedItems);\n    },\n\n    _buildSaveData: function _buildSaveData(independentBlocks, changedItems) {\n        var convertedItems = new _core2.default.storageProviders.oData.RequestManager();\n        for (var index = 0; index < independentBlocks.length; index++) {\n            for (var i = 0; i < independentBlocks[index].length; i++) {\n                var independentItem = independentBlocks[index][i];\n\n                var request = null;\n                var item = convertedItems.getItem(independentItem.data);\n                if (!item) {\n                    request = new activities.RequestBuilder(this);\n                    request.add(new activities.SetUrl(this.providerConfiguration.oDataServiceHost + '/'));\n                    item = convertedItems.add(independentItem, request);\n                }\n                request = item.request;\n\n                var entityState = independentItem.data.entityState;\n                if (typeof this._buildRequestObject['EntityState_' + entityState] === 'function') {\n                    this._buildRequestObject['EntityState_' + entityState](this, independentItem, convertedItems, request, changedItems);\n                } else {\n                    _core.Guard.raise(new _core.Exception(\"Not supported Entity state\"));\n                }\n            }\n        }\n\n        return convertedItems;\n    },\n    _buildRequestObject: {\n        value: {\n            'EntityState_20': function EntityState_20(provider, item, convertedItem, request, changedItems) {\n                request.add(new activities.SetMethod(\"POST\"), new activities.AppendUrl(item.entitySet.tableName));\n\n                provider.save_getInitData(item, convertedItem, undefined, undefined, request, changedItems);\n            },\n            'EntityState_30': function EntityState_30(provider, item, convertedItem, request, changedItems) {\n                request.add(new activities.SetMethod(provider.providerConfiguration.UpdateMethod), new activities.AppendUrl(item.entitySet.tableName), new activities.AppendUrl(\"(\" + provider.getEntityKeysValue(item) + \")\"));\n\n                provider.addETagHeader(item, request);\n\n                provider.save_getInitData(item, convertedItem, undefined, undefined, request, changedItems);\n            },\n            'EntityState_40': function EntityState_40(provider, item, convertedItem, request, changedItems) {\n                request.add(new activities.SetMethod(\"DELETE\"), new activities.ClearRequestData(), new activities.AppendUrl(item.entitySet.tableName), new activities.AppendUrl(\"(\" + provider.getEntityKeysValue(item) + \")\"));\n\n                provider.addETagHeader(item, request);\n            }\n        }\n    },\n    reload_fromResponse: function reload_fromResponse(item, data, response) {\n        var that = this;\n        item.getType().memberDefinitions.getPublicMappedProperties().forEach(function (memDef) {\n            var propType = _core.Container.resolveType(memDef.type);\n            if (memDef.computed || memDef.key || !memDef.inverseProperty) {\n                if (memDef.concurrencyMode === _core2.default.ConcurrencyMode.Fixed) {\n                    //unescape?\n                    //item[memDef.name] = response.headers.ETag || response.headers.Etag || response.headers.etag;\n                    item[memDef.name] = data['@odata.etag'];\n                } else if (memDef.isAssignableTo) {\n                    if (data[memDef.name]) {\n                        item[memDef.name] = new propType(data[memDef.name], { converters: that.fieldConverter.fromDb });\n                    } else {\n                        item[memDef.name] = data[memDef.name];\n                    }\n                } else if (propType === _core2.default.Array && memDef.elementType) {\n                    var aeType = _core.Container.resolveType(memDef.elementType);\n                    if (data[memDef.name] && Array.isArray(data[memDef.name])) {\n                        var arrayProperty = [];\n                        for (var ap = 0; ap < data[memDef.name].length; ap++) {\n                            var aitem = data[memDef.name][ap];\n                            if (aeType.isAssignableTo && !_core.Guard.isNullOrUndefined(aitem)) {\n                                arrayProperty.push(new aeType(aitem, { converters: that.fieldConverter.fromDb }));\n                            } else {\n                                var etypeName = _core.Container.resolveName(aeType);\n                                var econverter = that.fieldConverter.fromDb[etypeName];\n\n                                arrayProperty.push(econverter ? econverter(aitem) : aitem);\n                            }\n                        }\n                        item[memDef.name] = arrayProperty;\n                    } else if (!data[memDef.name]) {\n                        item[memDef.name] = data[memDef.name];\n                    }\n                } else {\n                    var typeName = _core.Container.resolveName(memDef.type);\n                    var converter = that.fieldConverter.fromDb[typeName];\n\n                    item[memDef.name] = converter ? converter(data[memDef.name]) : data[memDef.name];\n                }\n            }\n        }, this);\n    },\n\n    save_getInitData: function save_getInitData(item, convertedItems, isComplex, isDeep, request, changedItems) {\n        var self = this;\n        if (!isComplex) {\n            item.physicalData = this.context._storageModel.getStorageModel(item.data.getType()).PhysicalType.convertTo(item.data, convertedItems);\n        } else {\n            item.physicalData = item.data;\n        }\n        var hasSavedProperty = item.data.entityState === _core2.default.EntityState.Added;\n        item.physicalData.getType().memberDefinitions.asArray().forEach(function (memdef) {\n            hasSavedProperty = self.propertyConversationSelector(item, memdef, convertedItems, request, changedItems, isDeep) || hasSavedProperty;\n        }, this);\n\n        if (!hasSavedProperty && !isDeep) {\n            convertedItems.remove(item.data);\n        }\n    },\n    propertyConversationSelector: function propertyConversationSelector(item, memdef, convertedItems, request, changedItems, isDeep) {\n        if (memdef.kind == _core2.default.MemberTypes.complexProperty) {\n            return this._complexPropertySelector.apply(this, arguments);\n        }\n\n        if (memdef.kind == _core2.default.MemberTypes.property) {\n            return this._propertySelector.apply(this, arguments);\n        }\n\n        if (memdef.kind == _core2.default.MemberTypes.navProperty) {\n            return this._navigationPropertySelector.apply(this, arguments);\n        }\n\n        return false;\n    },\n    _complexPropertySelector: function _complexPropertySelector(item, memdef, convertedItems, request, changedItems, isDeep) {\n        return this.propertyConversationStrategies[\"complex\"].apply(this, arguments);\n    },\n    _propertySelector: function _propertySelector(item, memdef, convertedItems, request, changedItems, isDeep) {\n        if (typeof memdef.concurrencyMode === 'undefined') {\n            switch (true) {\n                case memdef.notMapped:\n                    return false;\n                case memdef.key === true:\n                    this.propertyConversationStrategies[\"default\"].apply(this, arguments);\n                    return false;\n                case isDeep:\n                case item.data.entityState === _core2.default.EntityState.Added:\n                case this._propertyIsChanged(item.data, memdef):\n                    return this.propertyConversationStrategies[\"default\"].apply(this, arguments);\n                default:\n                    return false;\n            }\n        }\n\n        return false;\n    },\n    _navigationPropertySelector: function _navigationPropertySelector(item, memdef, convertedItems, request, changedItems, isDeep) {\n        var _this = this;\n\n        if (isDeep || item.data.entityState === _core2.default.EntityState.Added || this._propertyIsChanged(item.data, memdef)) {\n\n            var navigationValue = item.data[memdef.name];\n            if (_checkODataMode(this, 'enableDeepSave') && navigationValue && item.data.entityState === _core2.default.EntityState.Added) {\n                var result = null;\n                if (Array.isArray(navigationValue)) {\n                    navigationValue.forEach(function (navItem, index) {\n                        _this._processDeepSaveItems(item, memdef, convertedItems, request, changedItems, navItem, \"deepSaveArray\", index);\n                        //update not supported here\n                    });\n                    return true; //item.data is new\n                } else {\n                        result = this._processDeepSaveItems(item, memdef, convertedItems, request, changedItems, navigationValue, \"deepSave\");\n                    }\n\n                if (result !== null) {\n                    return result;\n                }\n            }\n\n            return this._simpleNavigationPropertySelector.apply(this, arguments);\n        }\n        return false;\n    },\n    _simpleNavigationPropertySelector: function _simpleNavigationPropertySelector(item, memdef, convertedItems, request, changedItems, isDeep) {\n        if (_checkODataMode(this, 'withReferenceMethods')) {\n            return this.propertyConversationStrategies[\"withReferenceMethods\"].apply(this, arguments);\n        }\n\n        return this.propertyConversationStrategies[\"navigation\"].apply(this, arguments);\n    },\n\n    _processDeepSaveItems: function _processDeepSaveItems(item, memdef, convertedItems, request, changedItems, navigationEntity, strategy, index) {\n        var referencedItems = changedItems.filter(function (it) {\n            return it.data == navigationEntity;\n        });\n\n        if (referencedItems.length === 1 && referencedItems[0].enableDeepSave && navigationEntity.entityState === _core2.default.EntityState.Added && referencedItems[0].deepParent === item.data) {\n            var deepItem = convertedItems.getItem(referencedItems[0].data);\n            if (!deepItem) {\n                var referencedRequest = new activities.RequestBuilder(this);\n                referencedRequest.add(new activities.SetUrl(this.providerConfiguration.oDataServiceHost + '/'));\n                deepItem = convertedItems.add(referencedItems[0], referencedRequest);\n            }\n\n            convertedItems.addItemReference(item.data, deepItem);\n            if (!deepItem.removed) {\n                convertedItems.remove(referencedItems[0].data);\n            }\n\n            return this.propertyConversationStrategies[strategy].call(this, item, memdef, convertedItems, request, changedItems, index);\n        }\n\n        return null;\n    },\n    _propertyIsChanged: function _propertyIsChanged(entity, memdef) {\n        return entity && entity.changedProperties && entity.changedProperties.some(function (def) {\n            return def.name === memdef.name;\n        });\n    },\n    propertyConversationStrategies: {\n        value: {\n            \"default\": function _default(item, memdef, convertedItems, request, changedItems) {\n                var typeName = _core.Container.resolveName(memdef.type);\n                var converter = this.fieldConverter.toDb[typeName];\n                request.add(new activities.SetProperty(memdef.name, converter ? converter(item.physicalData[memdef.name]) : item.physicalData[memdef.name]));\n                return true;\n            },\n            \"withReferenceMethods\": function withReferenceMethods(item, memdef, convertedItems, request, changedItems) {\n                var reqItem = convertedItems.getItem(item.data);\n                if (reqItem && reqItem.removed) return false; //deep saved\n\n                var additionalRequest = new activities.RequestBuilder(this);\n                var value = item.physicalData[memdef.name];\n                if (value) {\n                    additionalRequest.add(new activities.SetMethod('POST'));\n                    if (value.__metadata) {\n                        additionalRequest.add(new activities.SetProperty('@odata.id', this.providerConfiguration.oDataServiceHost + '/' + value.__metadata.uri));\n                    } else if (value.__convertedRefence) {\n                        additionalRequest.add(function (req, provider) {\n                            var targetItem = value.__convertedRefence;\n                            req.data = req.data || {};\n                            if (targetItem.isProcessed) {\n                                req.data[\"@odata.id\"] = provider.getEntityUrlReference(targetItem.entity);\n                            } else {\n                                req.data[\"@odata.id\"] = provider.providerConfiguration.oDataServiceHost + '/$' + targetItem.itemIndex;\n                            }\n                        });\n                    }\n                } else {\n                    if (item.data.entityState === _core2.default.EntityState.Added || value !== null) return;\n\n                    additionalRequest.add(new activities.SetUrl(this.providerConfiguration.oDataServiceHost + '/'), new activities.AppendUrl(item.entitySet.tableName), new activities.AppendUrl(\"(\" + this.getEntityKeysValue(item) + \")\"), new activities.SetMethod('DELETE'), new activities.ClearRequestData());\n                }\n\n                additionalRequest.add(function (req, provider) {\n                    if (reqItem.isProcessed || item.data.entityState !== _core2.default.EntityState.Added) {\n                        req.requestUri = provider.providerConfiguration.oDataServiceHost + '/';\n                        req.requestUri += item.entitySet.tableName;\n                        req.requestUri += \"(\" + provider.getEntityKeysValue(item) + \")\";\n                        provider.addETagHeader(item, req);\n                    } else {\n                        req.requestUri = '$' + reqItem.itemIndex;\n                        provider.addETagHeader(item, req, _core2.default.defaults.OData.eTagAny);\n                    }\n\n                    req.requestUri += '/' + memdef.name + '/$ref';\n                });\n\n                var refItem = convertedItems.add(item, additionalRequest, false);\n                convertedItems.addItemReference(item.data, refItem);\n                return false;\n            },\n            \"deepSave\": function deepSave(item, memdef, convertedItems, request, changedItems) {\n                var refItem = convertedItems.getItem(item.data[memdef.name]);\n                request.add(function (req, provider) {\n                    req.data[memdef.name] = refItem.request.build().get().data;\n                });\n                return true;\n            },\n            \"deepSaveArray\": function deepSaveArray(item, memdef, convertedItems, request, changedItems, index) {\n                var refItem = convertedItems.getItem(item.data[memdef.name][index]);\n                request.add(function (req, provider) {\n                    req.data[memdef.name] = req.data[memdef.name] || [];\n                    req.data[memdef.name].push(refItem.request.build().get().data);\n                });\n                return true;\n            },\n            \"navigation\": function navigation(item, memdef, convertedItems, request, changedItems) {\n\n                request.add(function (req, provider) {\n                    req.data = req.data || {};\n\n                    if (item.physicalData[memdef.name] && item.physicalData[memdef.name].__metadata) {\n                        req.data[memdef.name + \"@odata.bind\"] = item.physicalData[memdef.name].__metadata.uri;\n                    } else if (item.physicalData[memdef.name] && item.physicalData[memdef.name].__convertedRefence) {\n                        var targetItem = item.physicalData[memdef.name].__convertedRefence;\n                        if (targetItem.isProcessed) {\n                            req.data[memdef.name + \"@odata.bind\"] = provider.getEntityUrlReference(targetItem.entity);\n                        } else {\n                            req.data[memdef.name + \"@odata.bind\"] = \"$\" + targetItem.itemIndex;\n                        }\n                    } else if (item.physicalData[memdef.name] === null) {\n                        req.data[memdef.name + \"@odata.bind\"] = null;\n                    }\n                });\n                return true;\n            },\n            \"complex\": function complex(item, memdef, convertedItems, request, changedItems) {\n                if (item.physicalData[memdef.name]) {\n                    var innerRequest = new activities.RequestBuilder(this);\n                    this.save_getInitData({ data: item.physicalData[memdef.name] }, convertedItems, true, true, innerRequest);\n                    request.add(function (req) {\n                        req.data = req.data || {};\n                        req.data[memdef.name] = innerRequest.build().get().data;\n                    });\n                    return true;\n                }\n                return false;\n            }\n        }\n    },\n\n    addETagHeader: function addETagHeader(item, request, value) {\n        var property = item.data.getType().memberDefinitions.getPublicMappedProperties().filter(function (memDef) {\n            return memDef.concurrencyMode === _core2.default.ConcurrencyMode.Fixed;\n        });\n        if (property && property[0]) {\n            var headerValue = typeof value !== \"undefined\" ? value : item.data[property[0].name];\n            if (typeof headerValue !== \"undefined\") {\n                if (request instanceof activities.RequestBuilder) {\n                    request.add(new activities.SetHeaderProperty('If-Match', headerValue));\n                } else {\n                    request.headers['If-Match'] = headerValue;\n                }\n            }\n        }\n    },\n\n    getTraceString: function getTraceString(queryable) {\n        var sqlText = this._compile(queryable);\n        return queryable;\n    },\n    supportedDataTypes: {\n        value: [_core2.default.Array, _core2.default.Integer, _core2.default.String, _core2.default.Number, _core2.default.Blob, _core2.default.Boolean, _core2.default.Date, _core2.default.Object, _core2.default.GeographyPoint, _core2.default.Guid, _core2.default.GeographyLineString, _core2.default.GeographyPolygon, _core2.default.GeographyMultiPoint, _core2.default.GeographyMultiLineString, _core2.default.GeographyMultiPolygon, _core2.default.GeographyCollection, _core2.default.GeometryPoint, _core2.default.GeometryLineString, _core2.default.GeometryPolygon, _core2.default.GeometryMultiPoint, _core2.default.GeometryMultiLineString, _core2.default.GeometryMultiPolygon, _core2.default.GeometryCollection, _core2.default.Byte, _core2.default.SByte, _core2.default.Decimal, _core2.default.Float, _core2.default.Int16, _core2.default.Int32, _core2.default.Int64, _core2.default.Time, _core2.default.Day, _core2.default.DateTimeOffset, _core2.default.Duration],\n        writable: false\n    },\n\n    supportedBinaryOperators: {\n        value: {\n            equal: { mapTo: 'eq', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            notEqual: { mapTo: 'ne', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            equalTyped: { mapTo: 'eq', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            notEqualTyped: { mapTo: 'ne', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            greaterThan: { mapTo: 'gt', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            greaterThanOrEqual: { mapTo: 'ge', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n\n            lessThan: { mapTo: 'lt', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            lessThenOrEqual: { mapTo: 'le', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            or: { mapTo: 'or', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            and: { mapTo: 'and', dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n\n            add: { mapTo: 'add', dataType: \"number\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            divide: { mapTo: 'div', allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            multiply: { mapTo: 'mul', allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            subtract: { mapTo: 'sub', allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n            modulo: { mapTo: 'mod', allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] },\n\n            \"in\": { mapTo: \"in\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression] }\n        }\n    },\n\n    supportedUnaryOperators: {\n        value: {\n            not: { mapTo: 'not' }\n        }\n    },\n\n    supportedFieldOperations: {\n        value: {\n            /* string functions */\n\n            contains: {\n                mapTo: \"substringof\",\n                dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"substring\", dataType: \"string\" }, { name: \"@expression\" }]\n            },\n\n            startsWith: {\n                mapTo: \"startswith\",\n                dataType: \"string\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"string\" }, { name: \"strFragment\", dataType: \"string\" }]\n            },\n\n            endsWith: {\n                mapTo: \"endswith\",\n                dataType: \"string\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"string\" }, { name: \"strFragment\", dataType: \"string\" }]\n            },\n\n            length: [{\n                allowedType: 'string',\n                dataType: \"number\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.ProjectionExpression],\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\n            }, {\n                allowedType: 'GeographyLineString',\n                mapTo: \"geo.length\",\n                dataType: \"number\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: ['GeographyLineString'] }],\n                fixedDataType: 'decimal'\n            }, {\n                allowedType: 'GeometryLineString',\n                mapTo: \"geo.length\",\n                dataType: \"number\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: 'GeometryLineString' }],\n                fixedDataType: 'decimal'\n            }],\n\n            strLength: {\n                mapTo: \"length\",\n                dataType: \"number\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.ProjectionExpression],\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\n            },\n\n            indexOf: {\n                dataType: \"number\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                mapTo: \"indexof\",\n                baseIndex: 1,\n                parameters: [{ name: '@expression', dataType: \"string\" }, { name: 'strFragment', dataType: 'string' }]\n            },\n\n            replace: {\n                dataType: \"string\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: '@expression', dataType: \"string\" }, { name: 'strFrom', dataType: 'string' }, { name: 'strTo', dataType: 'string' }]\n            },\n\n            substr: {\n                mapTo: \"substring\",\n                dataType: \"string\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"string\" }, { name: \"startFrom\", dataType: \"number\" }, { name: \"length\", dataType: \"number\", optional: \"true\" }]\n            },\n\n            toLowerCase: {\n                mapTo: \"tolower\",\n                dataType: \"string\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\n            },\n\n            toUpperCase: {\n                mapTo: \"toupper\",\n                dataType: \"string\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\n\n            },\n\n            trim: {\n                dataType: \"string\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\n            },\n\n            concat: {\n                dataType: \"string\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"string\" }, { name: \"strFragment\", dataType: \"string\" }]\n            },\n\n            /* data functions */\n\n            day: {\n                allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\n            },\n            hour: {\n                allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\n            },\n            minute: {\n                allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\n            },\n            month: {\n                allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\n            },\n            second: {\n                allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\n            },\n            year: {\n                allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\n            },\n\n            /* number functions */\n            round: {\n                allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\n            },\n            floor: {\n                allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\n            },\n            ceiling: {\n                allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\n            },\n\n            /* geo functions */\n            distance: [{\n                allowedType: 'GeographyPoint',\n                mapTo: \"geo.distance\",\n                dataType: \"number\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: 'GeographyPoint' }, { name: \"to\", dataType: 'GeographyPoint' }],\n                fixedDataType: 'decimal'\n            }, {\n                allowedType: 'GeometryPoint',\n                mapTo: \"geo.distance\",\n                dataType: \"number\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: 'GeometryPoint' }, { name: \"to\", dataType: 'GeometryPoint' }],\n                fixedDataType: 'decimal'\n            }],\n\n            intersects: [{\n                allowedType: 'GeographyPoint',\n                mapTo: \"geo.intersects\",\n                dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: 'GeographyPoint' }, { name: \"in\", dataType: 'GeographyPolygon' }]\n\n            }, {\n                allowedType: 'GeometryPoint',\n                mapTo: \"geo.intersects\",\n                dataType: \"boolean\", allowedIn: [_core2.default.Expressions.FilterExpression, _core2.default.Expressions.OrderExpression],\n                parameters: [{ name: \"@expression\", dataType: 'GeometryPoint' }, { name: \"in\", dataType: 'GeometryPolygon' }]\n\n            }]\n        },\n        enumerable: true,\n        writable: true\n    },\n    supportedSetOperations: {\n        value: {\n            filter: {\n                allowedIn: [_core2.default.Expressions.IncludeExpression],\n                parameters: [{ name: \"filter\", dataType: \"$data.Queryable\" }],\n                frameType: _core2.default.Expressions.FilterExpression,\n                includeFrameName: '$filter',\n                includeCompiler: '$data.storageProviders.oData.oDataWhereCompiler'\n            },\n            map: {\n                allowedIn: [_core2.default.Expressions.IncludeExpression],\n                parameters: [{ name: \"map\", dataType: \"$data.Queryable\" }],\n                frameType: _core2.default.Expressions.ProjectionExpression,\n                includeFrameName: '$select',\n                includeCompiler: '$data.storageProviders.oData.oDataProjectionCompiler'\n            },\n            length: {},\n            forEach: {},\n            toArray: {},\n            single: {},\n            some: {\n                invokable: false,\n                allowedIn: [_core2.default.Expressions.FilterExpression],\n                parameters: [{ name: \"some\", dataType: \"$data.Queryable\" }],\n                mapTo: 'any',\n                frameType: _core2.default.Expressions.SomeExpression\n            },\n            every: {\n                invokable: false,\n                allowedIn: [_core2.default.Expressions.FilterExpression],\n                parameters: [{ name: \"every\", dataType: \"$data.Queryable\" }],\n                mapTo: 'all',\n                frameType: _core2.default.Expressions.EveryExpression\n            },\n            take: {\n                allowedIn: [_core2.default.Expressions.IncludeExpression],\n                parameters: [{ name: \"take\", dataType: \"$data.Integer\" }],\n                frameType: _core2.default.Expressions.PagingExpression,\n                includeFrameName: '$top',\n                includeCompiler: '$data.storageProviders.oData.oDataPagingCompiler'\n            },\n            skip: {\n                allowedIn: [_core2.default.Expressions.IncludeExpression],\n                parameters: [{ name: \"skip\", dataType: \"$data.Integer\" }],\n                frameType: _core2.default.Expressions.PagingExpression,\n                includeFrameName: '$skip',\n                includeCompiler: '$data.storageProviders.oData.oDataPagingCompiler'\n            },\n            orderBy: {\n                allowedIn: [_core2.default.Expressions.IncludeExpression],\n                parameters: [{ name: \"orderBy\", dataType: \"$data.Queryable\" }],\n                frameType: _core2.default.Expressions.OrderExpression,\n                includeFrameName: '$orderby',\n                includeCompiler: '$data.storageProviders.oData.oDataOrderCompiler'\n            },\n            orderByDescending: {\n                allowedIn: [_core2.default.Expressions.IncludeExpression],\n                parameters: [{ name: \"orderByDescending\", dataType: \"$data.Queryable\" }],\n                frameType: _core2.default.Expressions.OrderExpression,\n                frameTypeFactory: function frameTypeFactory(source, selector) {\n                    return new _core2.default.Expressions.OrderExpression(source, selector, _core2.default.Expressions.ExpressionType.OrderByDescending);\n                },\n                includeFrameName: '$orderby',\n                includeCompiler: '$data.storageProviders.oData.oDataOrderCompiler'\n            },\n            first: {},\n            include: {},\n            batchDelete: {},\n            withInlineCount: {\n                allowedIn: [_core2.default.Expressions.IncludeExpression],\n                parameters: [],\n                frameType: _core2.default.Expressions.InlineCountExpression,\n                includeFrameName: '$count',\n                implementation: function implementation() {\n                    return 'true';\n                }\n            },\n            find: {}\n        },\n        enumerable: true,\n        writable: true\n    },\n    supportedContextOperation: {\n        value: {\n            batchExecuteQuery: true\n        },\n        enumerable: true,\n        writable: true\n    },\n\n    fieldConverter: { value: _core2.default.oDataConverter },\n    resolveTypeOperations: function resolveTypeOperations(operation, expression, frameType) {\n        var memDef = expression.entityType.getMemberDefinition(operation);\n        if (!memDef || !memDef.method || memDef.method.IsSideEffecting !== false || !memDef.method.returnType || !(frameType === _core2.default.Expressions.FilterExpression || frameType === _core2.default.Expressions.OrderExpression)) {\n            _core.Guard.raise(new _core.Exception(\"Entity '\" + expression.entityType.name + \"' Operation '\" + operation + \"' is not supported by the provider\"));\n        }\n\n        return memDef;\n    },\n    resolveSetOperations: function resolveSetOperations(operation, expression, frameType) {\n        if (expression) {\n            var esDef = expression.storageModel.ContextType.getMemberDefinition(expression.storageModel.ItemName);\n            if (esDef && esDef.actions && esDef.actions[operation]) {\n                var memDef = _core2.default.MemberDefinition.translateDefinition(esDef.actions[operation], operation, this.getType());\n                if (!memDef || !memDef.method || memDef.method.IsSideEffecting !== false || !memDef.method.returnType || !(frameType === _core2.default.Expressions.FilterExpression || frameType === _core2.default.Expressions.OrderExpression)) {\n\n                    _core.Guard.raise(new _core.Exception(\"Collection '\" + expression.storageModel.ItemName + \"' Operation '\" + operation + \"' is not supported by the provider\"));\n                }\n\n                return memDef;\n            }\n        }\n        return _core2.default.StorageProviderBase.prototype.resolveSetOperations.apply(this, arguments);\n    },\n    resolveContextOperations: function resolveContextOperations(operation, expression, frameType) {\n        var memDef = this.context.getType().getMemberDefinition(operation);\n        if (!memDef || !memDef.method || memDef.method.IsSideEffecting !== false || !memDef.method.returnType || !(frameType === _core2.default.Expressions.FilterExpression || frameType === _core2.default.Expressions.OrderExpression)) {\n            _core.Guard.raise(new _core.Exception(\"Context '\" + expression.instance.getType().name + \"' Operation '\" + operation + \"' is not supported by the provider\"));\n        }\n        return memDef;\n    },\n\n    getEntityUrlReference: function getEntityUrlReference(entity) {\n        var sMod = this.context._storageModel.getStorageModel(entity.getType());\n        var tblName = sMod.TableName;\n        var pk = '(' + this.getEntityKeysValue({ data: entity, entitySet: this.context.getEntitySetFromElementType(entity.getType()) }) + ')';\n        return this.providerConfiguration.oDataServiceHost + '/' + tblName + pk;\n    },\n\n    getEntityKeysValue: function getEntityKeysValue(entity) {\n        var result = [];\n        var keyValue = undefined;\n        var memDefs = entity.data.getType().memberDefinitions.getKeyProperties();\n        for (var i = 0, l = memDefs.length; i < l; i++) {\n            var field = memDefs[i];\n            if (field.key) {\n                keyValue = entity.data[field.name];\n                var typeName = _core.Container.resolveName(field.type);\n\n                var converter = this.fieldConverter.toDb[typeName];\n                keyValue = converter ? converter(keyValue) : keyValue;\n\n                converter = this.fieldConverter.escape[typeName];\n                keyValue = converter ? converter(keyValue) : keyValue;\n\n                result.push(field.name + \"=\" + keyValue);\n            }\n        }\n        if (result.length > 1) {\n            return result.join(\",\");\n        }\n        return keyValue;\n    },\n    getFieldUrl: function getFieldUrl(entity, fieldName, entitySet) {\n        var keyPart = this.getEntityKeysValue({ data: entity });\n        var servicehost = this.providerConfiguration.oDataServiceHost;\n        if (servicehost.lastIndexOf('/') === servicehost.length) servicehost = servicehost.substring(0, servicehost.length - 1);\n\n        return servicehost + '/' + entitySet.tableName + '(' + keyPart + ')/' + fieldName + '/$value';\n    }, /*\r\n       getServiceMetadata: function () {\r\n         $data.ajax(this._setAjaxAuthHeader({\r\n             url: this.providerConfiguration.oDataServiceHost + \"/$metadata\",\r\n             dataType: \"xml\",\r\n             success: function (d) {\r\n                 console.log(\"OK\");\r\n                 console.dir(d);\r\n                 console.log(typeof d);\r\n                 window[\"s\"] = d;\r\n                 window[\"k\"] = this.nsResolver;\r\n                 //s.evaluate(\"edmx:Edmx/edmx:DataServices/Schema\", s, $data.storageProviders.oData.oDataProvider.prototype.nsResolver, XPathResult.ANY_TYPE, null).iterateNext()\r\n               },\r\n             error: function (error) {\r\n                 console.log(\"error:\");\r\n                 console.dir(error);\r\n             }\r\n         }));\r\n       },\r\n       nsResolver: function (sPrefix) {\r\n         switch (sPrefix) {\r\n             case \"edmx\":\r\n                 return \"http://schemas.microsoft.com/ado/2007/06/edmx\";\r\n                 break;\r\n             case \"m\":\r\n                 return \"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata\";\r\n                 break;\r\n             case \"d\":\r\n                 return \"http://schemas.microsoft.com/ado/2007/08/dataservices\";\r\n                 break;\r\n             default:\r\n                 return \"http://schemas.microsoft.com/ado/2008/09/edm\";\r\n                 break;\r\n         }\r\n       }\r\n       */\n    parseError: function parseError(error, data) {\n\n        var message = (error.response || error || {}).body || '';\n        try {\n            if (message.indexOf('{') === 0) {\n                var errorObj = JSON.parse(message);\n                errorObj = errorObj['odata.error'] || errorObj.error || errorObj;\n                if (errorObj.message) {\n                    message = errorObj.message.value || errorObj.message;\n                }\n            }\n        } catch (e) {}\n\n        return new _core.Exception(message, error.message, data || error);\n    },\n    appendBasicAuth: function appendBasicAuth(request, user, password, withCredentials) {\n        request.headers = request.headers || {};\n        if (!request.headers.Authorization && user && password) {\n            request.headers.Authorization = \"Basic \" + this.__encodeBase64(user + \":\" + password);\n        }\n        if (withCredentials) {\n            request.withCredentials = withCredentials;\n        }\n    },\n    __encodeBase64: function __encodeBase64(val) {\n        var b64array = \"ABCDEFGHIJKLMNOP\" + \"QRSTUVWXYZabcdef\" + \"ghijklmnopqrstuv\" + \"wxyz0123456789+/\" + \"=\";\n\n        var input = val;\n        var base64 = \"\";\n        var hex = \"\";\n        var chr1,\n            chr2,\n            chr3 = \"\";\n        var enc1,\n            enc2,\n            enc3,\n            enc4 = \"\";\n        var i = 0;\n\n        do {\n            chr1 = input.charCodeAt(i++);\n            chr2 = input.charCodeAt(i++);\n            chr3 = input.charCodeAt(i++);\n\n            enc1 = chr1 >> 2;\n            enc2 = (chr1 & 3) << 4 | chr2 >> 4;\n            enc3 = (chr2 & 15) << 2 | chr3 >> 6;\n            enc4 = chr3 & 63;\n\n            if (isNaN(chr2)) {\n                enc3 = enc4 = 64;\n            } else if (isNaN(chr3)) {\n                enc4 = 64;\n            }\n\n            base64 = base64 + b64array.charAt(enc1) + b64array.charAt(enc2) + b64array.charAt(enc3) + b64array.charAt(enc4);\n            chr1 = chr2 = chr3 = \"\";\n            enc1 = enc2 = enc3 = enc4 = \"\";\n        } while (i < input.length);\n\n        return base64;\n    },\n    checkODataMode: function checkODataMode(functionName) {\n        return _checkODataMode(this, functionName);\n    }\n}, null);\n\n_core2.default.StorageProviderBase.registerProvider(\"oData\", _core2.default.storageProviders.oData.oDataProvider);\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n\n},{\"./SaveStrategies/batch\":1,\"./SaveStrategies/empty\":2,\"./SaveStrategies/single\":3,\"./oDataRequestActivities.js\":12,\"jaydata/core\":\"jaydata/core\"}],12:[function(_dereq_,module,exports){\n'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar RequestBuilder = exports.RequestBuilder = function () {\n    function RequestBuilder(context, request) {\n        _classCallCheck(this, RequestBuilder);\n\n        this._context = context;\n        this._request = request || {};\n        this._activities = [];\n    }\n\n    _createClass(RequestBuilder, [{\n        key: 'get',\n        value: function get() {\n            return this._request;\n        }\n    }, {\n        key: 'add',\n        value: function add() {\n            var _activities;\n\n            (_activities = this._activities).push.apply(_activities, arguments);\n            return this;\n        }\n    }, {\n        key: 'build',\n        value: function build() {\n            var _this = this;\n\n            this._request.headers = this._request.headers || {};\n            this._request.data = this._request.data || {};\n\n            this._activities.forEach(function (a) {\n                return a instanceof RequestActivity ? a.implementation(_this._request, _this._context) : a(_this._request, _this._context);\n            });\n\n            this._activities = [];\n            return this;\n        }\n    }]);\n\n    return RequestBuilder;\n}();\n\nvar RequestActivity = exports.RequestActivity = function () {\n    function RequestActivity() {\n        _classCallCheck(this, RequestActivity);\n    }\n\n    _createClass(RequestActivity, [{\n        key: 'implementation',\n        value: function implementation(request, provider) {}\n    }]);\n\n    return RequestActivity;\n}();\n\nvar SetRequestActivity = exports.SetRequestActivity = function (_RequestActivity) {\n    _inherits(SetRequestActivity, _RequestActivity);\n\n    function SetRequestActivity(key, value) {\n        _classCallCheck(this, SetRequestActivity);\n\n        var _this2 = _possibleConstructorReturn(this, Object.getPrototypeOf(SetRequestActivity).call(this));\n\n        _this2.key = key;\n        _this2.value = value;\n        return _this2;\n    }\n\n    _createClass(SetRequestActivity, [{\n        key: 'implementation',\n        value: function implementation(request, provider) {}\n    }]);\n\n    return SetRequestActivity;\n}(RequestActivity);\n\nvar SetRequestProperty = exports.SetRequestProperty = function (_SetRequestActivity) {\n    _inherits(SetRequestProperty, _SetRequestActivity);\n\n    function SetRequestProperty() {\n        _classCallCheck(this, SetRequestProperty);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(SetRequestProperty).apply(this, arguments));\n    }\n\n    _createClass(SetRequestProperty, [{\n        key: 'implementation',\n        value: function implementation(request, provider) {\n            request[this.key] = this.value;\n        }\n    }]);\n\n    return SetRequestProperty;\n}(SetRequestActivity);\n\nvar SetDataProperty = exports.SetDataProperty = function (_SetRequestActivity2) {\n    _inherits(SetDataProperty, _SetRequestActivity2);\n\n    function SetDataProperty() {\n        _classCallCheck(this, SetDataProperty);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(SetDataProperty).apply(this, arguments));\n    }\n\n    _createClass(SetDataProperty, [{\n        key: 'implementation',\n        value: function implementation(request, provider) {\n            request.data[this.key] = this.value;\n        }\n    }]);\n\n    return SetDataProperty;\n}(SetRequestActivity);\n\nvar SetHeaderProperty = exports.SetHeaderProperty = function (_SetRequestActivity3) {\n    _inherits(SetHeaderProperty, _SetRequestActivity3);\n\n    function SetHeaderProperty() {\n        _classCallCheck(this, SetHeaderProperty);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(SetHeaderProperty).apply(this, arguments));\n    }\n\n    _createClass(SetHeaderProperty, [{\n        key: 'implementation',\n        value: function implementation(request, provider) {\n            request.headers[this.key] = this.value;\n        }\n    }]);\n\n    return SetHeaderProperty;\n}(SetRequestActivity);\n\nvar SetUrl = exports.SetUrl = function (_SetRequestProperty) {\n    _inherits(SetUrl, _SetRequestProperty);\n\n    function SetUrl(url) {\n        _classCallCheck(this, SetUrl);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(SetUrl).call(this, 'requestUri', url));\n    }\n\n    return SetUrl;\n}(SetRequestProperty);\n\nvar AppendUrl = exports.AppendUrl = function (_SetUrl) {\n    _inherits(AppendUrl, _SetUrl);\n\n    function AppendUrl() {\n        _classCallCheck(this, AppendUrl);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(AppendUrl).apply(this, arguments));\n    }\n\n    _createClass(AppendUrl, [{\n        key: 'implementation',\n        value: function implementation(request, provider) {\n            request[this.key] == request[this.key] || \"\";\n            request[this.key] += this.value;\n        }\n    }]);\n\n    return AppendUrl;\n}(SetUrl);\n\nvar SetMethod = exports.SetMethod = function (_SetRequestProperty2) {\n    _inherits(SetMethod, _SetRequestProperty2);\n\n    function SetMethod(method) {\n        _classCallCheck(this, SetMethod);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(SetMethod).call(this, 'method', method));\n    }\n\n    return SetMethod;\n}(SetRequestProperty);\n\nvar SetProperty = exports.SetProperty = function (_SetDataProperty) {\n    _inherits(SetProperty, _SetDataProperty);\n\n    function SetProperty() {\n        _classCallCheck(this, SetProperty);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(SetProperty).apply(this, arguments));\n    }\n\n    return SetProperty;\n}(SetDataProperty);\n\nvar SetNavigationProperty = exports.SetNavigationProperty = function (_SetDataProperty2) {\n    _inherits(SetNavigationProperty, _SetDataProperty2);\n\n    function SetNavigationProperty() {\n        _classCallCheck(this, SetNavigationProperty);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(SetNavigationProperty).apply(this, arguments));\n    }\n\n    _createClass(SetNavigationProperty, [{\n        key: 'implementation',\n        value: function implementation(request, provider) {\n            request.data[this.key] = this.value;\n        }\n    }]);\n\n    return SetNavigationProperty;\n}(SetDataProperty);\n\nvar ClearRequestData = exports.ClearRequestData = function (_RequestActivity2) {\n    _inherits(ClearRequestData, _RequestActivity2);\n\n    function ClearRequestData() {\n        _classCallCheck(this, ClearRequestData);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(ClearRequestData).apply(this, arguments));\n    }\n\n    _createClass(ClearRequestData, [{\n        key: 'implementation',\n        value: function implementation(request, provider) {\n            delete request.data;\n        }\n    }]);\n\n    return ClearRequestData;\n}(RequestActivity);\n\n},{}],13:[function(_dereq_,module,exports){\n'use strict';\n\nvar _core = _dereq_('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n(0, _core.$C)('$data.storageProviders.oData.oDataWhereCompiler', _core2.default.Expressions.EntityExpressionVisitor, null, {\n    constructor: function constructor(provider, lambdaPrefix) {\n        this.provider = provider;\n        this.lambdaPrefix = lambdaPrefix;\n    },\n\n    compile: function compile(expression, context) {\n        this.Visit(expression, context);\n    },\n\n    VisitParametricQueryExpression: function VisitParametricQueryExpression(expression, context) {\n        this.Visit(expression.expression, context);\n    },\n\n    VisitUnaryExpression: function VisitUnaryExpression(expression, context) {\n        context.data += expression.resolution.mapTo;\n        context.data += \"(\";\n        this.Visit(expression.operand, context);\n        context.data += \")\";\n    },\n\n    VisitSimpleBinaryExpression: function VisitSimpleBinaryExpression(expression, context) {\n        context.data += \"(\";\n        //TODO refactor!!!\n        if (expression.nodeType == \"in\") {\n            _core.Guard.requireType(\"expression.right\", expression.type, _core2.default.Expressions.ConstantExpression);\n            var paramValue = expression.right.value;\n            if (!(paramValue instanceof Array)) {\n                _core.Guard.raise(new _core.Exception(\"Right to the 'in' operator must be an array value\"));\n            }\n            var result = null;\n            var orResolution = { mapTo: \"or\", dataType: \"boolean\", name: \"or\" };\n            var eqResolution = { mapTo: \"eq\", dataType: \"boolean\", name: \"equal\" };\n\n            paramValue.forEach(function (item) {\n                var idValue = item;\n                var idCheck = _core.Container.createSimpleBinaryExpression(expression.left, idValue, _core2.default.Expressions.ExpressionType.Equal, \"==\", \"boolean\", eqResolution);\n                if (result) {\n                    result = _core.Container.createSimpleBinaryExpression(result, idCheck, _core2.default.Expressions.ExpressionType.Or, \"||\", \"boolean\", orResolution);\n                } else {\n                    result = idCheck;\n                };\n            });\n            var temp = context.data;\n            context.data = '';\n            this.Visit(result, context);\n            context.data = temp + context.data.replace(/\\(/g, '').replace(/\\)/g, '');\n        } else {\n            this.Visit(expression.left, context);\n            context.data += \" \";\n            context.data += expression.resolution.mapTo;\n            context.data += \" \";\n            this.Visit(expression.right, context);\n        };\n        context.data += \")\";\n    },\n\n    VisitEntityFieldExpression: function VisitEntityFieldExpression(expression, context) {\n        this.Visit(expression.source, context);\n        if (expression.source instanceof _core2.default.Expressions.ComplexTypeExpression) {\n            context.data += \"/\";\n        }\n        this.Visit(expression.selector, context);\n    },\n\n    VisitAssociationInfoExpression: function VisitAssociationInfoExpression(expression, context) {\n        context.data += expression.associationInfo.FromPropertyName;\n    },\n\n    VisitMemberInfoExpression: function VisitMemberInfoExpression(expression, context) {\n        context.data += expression.memberName;\n    },\n\n    VisitQueryParameterExpression: function VisitQueryParameterExpression(expression, context) {\n        var typeName = _core.Container.resolveName(expression.type);\n\n        var converter = this.provider.fieldConverter.toDb[typeName];\n        var value = converter ? converter(expression.value) : expression.value;\n\n        converter = this.provider.fieldConverter.escape[typeName];\n        context.data += converter ? converter(value) : value;\n    },\n\n    VisitEntityFieldOperationExpression: function VisitEntityFieldOperationExpression(expression, context) {\n        _core.Guard.requireType(\"expression.operation\", expression.operation, _core2.default.Expressions.MemberInfoExpression);\n\n        //TODO refactor!\n        var opDef = expression.operation.memberDefinition;\n        var opName = opDef.mapTo || opDef.name;\n        context.data += opName;\n        context.data += \"(\";\n        var paramCounter = 0;\n        var params = opDef.parameters || [{ name: \"@expression\" }];\n\n        var args = params.map(function (item, index) {\n            if (item.name === \"@expression\") {\n                return expression.source;\n            } else {\n                return expression.parameters[paramCounter++];\n            };\n        });\n\n        args.forEach(function (arg, index) {\n            if (index > 0) {\n                context.data += \",\";\n            };\n            this.Visit(arg, context);\n        }, this);\n        context.data += \")\";\n    },\n    VisitEntityFunctionOperationExpression: function VisitEntityFunctionOperationExpression(expression, context) {\n        _core.Guard.requireType(\"expression.operation\", expression.operation, _core2.default.Expressions.MemberInfoExpression);\n        this.Visit(expression.source, context);\n\n        //TODO refactor!\n        var opDef = expression.operation.memberDefinition;\n        var opName = opDef.mapTo || opDef.name;\n        context.data += opName;\n        context.data += \"(\";\n        var paramCounter = 0;\n        var params = opDef.method.params || [{ name: \"@expression\" }];\n\n        var args = params.map(function (item, index) {\n            if (item.name === \"@expression\") {\n                return expression.source;\n            } else {\n                return expression.parameters[paramCounter++];\n            };\n        });\n        var i = 0;\n        args.forEach(function (arg, index) {\n            if (arg === undefined || arg instanceof _core2.default.Expressions.ConstantExpression && typeof arg.value === 'undefined') return;\n\n            if (i > 0) {\n                context.data += \",\";\n            };\n            i++;\n            context.data += params[index].name + '=';\n            this.Visit(arg, context);\n        }, this);\n        context.data += \")\";\n    },\n    VisitContextFunctionOperationExpression: function VisitContextFunctionOperationExpression(expression, context) {\n        return this.VisitEntityFunctionOperationExpression(expression, context);\n    },\n\n    VisitConstantExpression: function VisitConstantExpression(expression, context) {\n        var typeName = _core.Container.resolveName(expression.type);\n\n        var converter = this.provider.fieldConverter.toDb[typeName];\n        var value = converter ? converter(expression.value) : expression.value;\n\n        converter = this.provider.fieldConverter.escape[typeName];\n        context.data += converter ? converter(value) : value;\n    },\n\n    VisitEntityExpression: function VisitEntityExpression(expression, context) {\n        this.Visit(expression.source, context);\n\n        if (this.lambdaPrefix && expression.selector.lambda) {\n            context.lambda = expression.selector.lambda;\n            context.data += expression.selector.lambda + '/';\n        }\n\n        //if (expression.selector instanceof $data.Expressions.EntityExpression) {\n        //    this.Visit(expression.selector, context);\n        //}\n    },\n\n    VisitEntitySetExpression: function VisitEntitySetExpression(expression, context) {\n        this.Visit(expression.source, context);\n        if (expression.selector instanceof _core2.default.Expressions.AssociationInfoExpression) {\n            this.Visit(expression.selector, context);\n            context.data += \"/\";\n        }\n    },\n\n    VisitFrameOperationExpression: function VisitFrameOperationExpression(expression, context) {\n        this.Visit(expression.source, context);\n\n        _core.Guard.requireType(\"expression.operation\", expression.operation, _core2.default.Expressions.MemberInfoExpression);\n\n        //TODO refactor!\n        var opDef = expression.operation.memberDefinition;\n        var opName = opDef.mapTo || opDef.name;\n        context.data += opName;\n        context.data += \"(\";\n        var paramCounter = 0;\n        var params = opDef.parameters || [{ name: \"@expression\" }];\n\n        var args = params.map(function (item, index) {\n            if (item.name === \"@expression\") {\n                return expression.source;\n            } else {\n                return expression.parameters[paramCounter++];\n            };\n        });\n\n        for (var i = 0; i < args.length; i++) {\n            var arg = args[i];\n            if (arg && arg.value instanceof _core2.default.Queryable) {\n                var frameExpression = new opDef.frameType(arg.value.expression);\n                var preparator = _core.Container.createQueryExpressionCreator(arg.value.entityContext);\n                var prep_expression = preparator.Visit(frameExpression);\n\n                var compiler = new _core2.default.storageProviders.oData.oDataWhereCompiler(this.provider, true);\n                var frameContext = { data: \"\" };\n                var compiled = compiler.compile(prep_expression, frameContext);\n\n                context.data += frameContext.lambda + ': ' + frameContext.data;\n            };\n        }\n        context.data += \")\";\n    }\n});\n\n},{\"jaydata/core\":\"jaydata/core\"}]},{},[4])(4)\n});\n\n","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\n\r\nvar strategy = {\r\n    name: 'batch',\r\n    condition: function (provider, convertedItems) {\r\n        var disabled = false;\r\n        if(typeof provider.providerConfiguration.disableBatch !== 'undefined'){\r\n            disabled = !!provider.providerConfiguration.disableBatch;\r\n        } else {\r\n            disabled = !!$data.defaults.OData.disableBatch;\r\n        }\r\n        \r\n        if (!disabled) {\r\n            var requests = convertedItems.getItems();\r\n            return requests.length > 1;\r\n        }\r\n        \r\n        return false;\r\n    },\r\n    save: function (provider, convertedItems, callBack) {\r\n        var that = provider;\r\n        var items = convertedItems.getItems();\r\n        var requests = items.map(function(it){ return it.request.build().get() })\r\n        \r\n        var requestData = [{\r\n            requestUri: that.providerConfiguration.oDataServiceHost + \"/$batch\",\r\n            method: \"POST\",\r\n            data: {\r\n                __batchRequests: [{ __changeRequests: requests }]\r\n            },\r\n            headers: {\r\n            }\r\n        }, function (data, response) {\r\n            if (response.statusCode == 200 || response.statusCode == 202) {\r\n                var result = data.__batchResponses[0].__changeResponses;\r\n                var errors = [];\r\n\r\n                for (var i = 0; i < result.length; i++) {\r\n                    if (result[i].statusCode >= 200 && result[i].statusCode < 300) {\r\n                        var item = convertedItems.getByResponse(result[i], i);\r\n                        if(item instanceof $data.Entity && result[i].statusCode != 204){\r\n                            that.reload_fromResponse(item, result[i].data, result[i]);\r\n                            convertedItems.setProcessed(item);\r\n                        }\r\n                    } else {\r\n                        errors.push(that.parseError(result[i]));\r\n                    }\r\n                }\r\n                if (errors.length > 0) {\r\n                    if (errors.length === 1) {\r\n                        callBack.error(errors[0]);\r\n                    } else {\r\n                        callBack.error(new Exception('See inner exceptions', 'Batch failed', errors));\r\n                    }\r\n                } else if (callBack.success) {\r\n                    callBack.success(convertedItems.length);\r\n                }\r\n            } else {\r\n                callBack.error(that.parseError(response));\r\n            }\r\n\r\n        }, function (e) {\r\n            callBack.error(that.parseError(e));\r\n        }, that.oData.batch.batchHandler];\r\n\r\n        if (typeof that.providerConfiguration.useJsonLight !== 'undefined') {\r\n            requestData[0].useJsonLight = that.providerConfiguration.useJsonLight;\r\n        }\r\n\r\n        that.appendBasicAuth(requestData[0], that.providerConfiguration.user, that.providerConfiguration.password, that.providerConfiguration.withCredentials);\r\n\r\n        that.context.prepareRequest.call(that, requestData);\r\n        that.oData.request.apply(that, requestData);\r\n    }\r\n}\r\n\r\n\r\nexport { strategy }","\r\nvar strategy = {\r\n    name: 'empty',\r\n    condition: function (provider, convertedItems) {\r\n        return true;\r\n    },\r\n    save: function (provider, convertedItems, callBack) {\r\n        callBack.success(0);\r\n    }\r\n}\r\n\r\n\r\nexport { strategy }","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\n\r\nvar strategy = {\r\n    name: 'single',\r\n    condition: function (provider, convertedItems) {\r\n        var requests = convertedItems.getItems();\r\n        return requests.length > 0;\r\n    },\r\n    save: function (provider, convertedItems, callBack) {\r\n        var that = provider;\r\n        var items = convertedItems.getItems();\r\n        \r\n        var doSave = function(items, index, done){\r\n            var item = items[index];\r\n            if(!item) return done()\r\n            \r\n            var request = item.request.build().get();\r\n            var requestData = [request, function (data, response) {\r\n                if (response.statusCode >= 200 && response.statusCode < 300) {\r\n                    var item = convertedItems.getByResponse(response, index);\r\n                    if(item instanceof $data.Entity && response.statusCode != 204){\r\n                        that.reload_fromResponse(item, data, response);\r\n                        convertedItems.setProcessed(item);\r\n                    }\r\n\r\n                    doSave(items, ++index, done);\r\n                } else {\r\n                    done(response);\r\n                }\r\n\r\n            }, done];\r\n\r\n            that.appendBasicAuth(requestData[0], that.providerConfiguration.user, that.providerConfiguration.password, that.providerConfiguration.withCredentials);\r\n            that.context.prepareRequest.call(that, requestData);\r\n            that.oData.request.apply(that, requestData);\r\n        }\r\n        \r\n        doSave(items, 0, function(err, result){\r\n            if(err) return callBack.error(that.parseError(err));\r\n            callBack.success(result);\r\n        })\r\n    }\r\n}\r\n\r\n\r\nexport { strategy }","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _core = require('jaydata/core');\n\nvar _core2 = _interopRequireDefault(_core);\n\nvar _oDataConverter = require('./oDataConverter.js');\n\nvar _oDataConverter2 = _interopRequireDefault(_oDataConverter);\n\nvar _oDataProvider = require('./oDataProvider.js');\n\nvar _oDataProvider2 = _interopRequireDefault(_oDataProvider);\n\nvar _oDataCompiler = require('./oDataCompiler.js');\n\nvar _oDataCompiler2 = _interopRequireDefault(_oDataCompiler);\n\nvar _oDataWhereCompiler = require('./oDataWhereCompiler.js');\n\nvar _oDataWhereCompiler2 = _interopRequireDefault(_oDataWhereCompiler);\n\nvar _oDataIncludeCompiler = require('./oDataIncludeCompiler.js');\n\nvar _oDataIncludeCompiler2 = _interopRequireDefault(_oDataIncludeCompiler);\n\nvar _oDataOrderCompiler = require('./oDataOrderCompiler.js');\n\nvar _oDataOrderCompiler2 = _interopRequireDefault(_oDataOrderCompiler);\n\nvar _oDataPagingCompiler = require('./oDataPagingCompiler.js');\n\nvar _oDataPagingCompiler2 = _interopRequireDefault(_oDataPagingCompiler);\n\nvar _oDataProjectionCompiler = require('./oDataProjectionCompiler.js');\n\nvar _oDataProjectionCompiler2 = _interopRequireDefault(_oDataProjectionCompiler);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = _core2.default;\nmodule.exports = exports['default'];\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbXX0=","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\n\r\n$C('$data.storageProviders.oData.oDataCompiler', $data.Expressions.EntityExpressionVisitor, null, {\r\n    constructor: function () {\r\n        this.context = {};\r\n        this.provider = {};\r\n        //this.logicalType = null;\r\n        this.includes = null;\r\n        this.mainEntitySet = null;\r\n    },\r\n    compile: function (query) {\r\n\r\n        this.provider = query.context.storageProvider;\r\n        this.context = query.context;\r\n\r\n        if (query.defaultType) {\r\n            this.mainEntitySet = query.context.getEntitySetFromElementType(query.defaultType);\r\n        }\r\n\r\n        var queryFragments = { urlText: \"\" };\r\n\r\n        this.Visit(query.expression, queryFragments);\r\n        if(queryFragments.$expand){\r\n            queryFragments.$expand = queryFragments.$expand.toString();\r\n        }\r\n        \r\n\r\n        query.modelBinderConfig = {};\r\n        var modelBinder = Container.createModelBinderConfigCompiler(query, this.includes, true);\r\n        modelBinder.Visit(query.expression);\r\n\r\n\r\n        var queryText = queryFragments.urlText;\r\n        var addAmp = false;\r\n        \r\n        if(queryFragments.$funcParams){\r\n            queryText += \"(\" + queryFragments.$funcParams + \")\"\r\n        }\r\n        \r\n        for (var name in queryFragments) {\r\n            if (name != \"urlText\" && name != \"actionPack\" && name != \"data\" && name != \"lambda\" && name != \"method\" && name != \"postData\" &&\r\n                name != \"_isBatchExecuteQuery\" && name != \"_subQueries\" && name != \"$funcParams\" && queryFragments[name] != \"\") {\r\n\r\n                if (addAmp) { queryText += \"&\"; } else { queryText += \"?\"; }\r\n                addAmp = true;\r\n                if(name != \"$urlParams\"){\r\n                    queryText += name + '=' + queryFragments[name];\r\n                }else{\r\n                    queryText += queryFragments[name];\r\n                }\r\n            }\r\n        }\r\n        query.queryText = queryText;\r\n        query.postData = queryFragments.postData;\r\n        var result =  {\r\n            queryText: queryText,\r\n            withInlineCount: '$inlinecount' in queryFragments || '$count' in queryFragments,\r\n            method: queryFragments.method || 'GET',\r\n            postData: queryFragments.postData,\r\n            isBatchExecuteQuery: queryFragments._isBatchExecuteQuery,\r\n            subQueries: queryFragments._subQueries,\r\n            params: []\r\n        };\r\n\r\n        query._getComplitedData = function () {\r\n            return result;\r\n        }\r\n\r\n        return result;\r\n    },\r\n    VisitOrderExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n\r\n        var orderCompiler = Container.createoDataOrderCompiler(this.provider);\r\n        orderCompiler.compile(expression, context);\r\n    },\r\n    VisitPagingExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n\r\n        var pagingCompiler = Container.createoDataPagingCompiler(this.provider);\r\n        pagingCompiler.compile(expression, context);\r\n    },\r\n    VisitIncludeExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n\r\n        var includeCompiler = Container.createoDataIncludeCompiler(this.provider);\r\n        this.includes = this.includes || []\r\n        var includeContext = { data: context[\"$expand\"], includes: this.includes }\r\n        includeCompiler.compile(expression.selector, includeContext);\r\n        context[\"$expand\"] = includeContext.data;\r\n    },\r\n    VisitFindExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n\r\n        if (expression.subMember) {\r\n            context.urlText += \"/\" + expression.subMember.memberName;\r\n        }\r\n\r\n        context.urlText += '(';\r\n        if (expression.params.length === 1) {\r\n            var param = expression.params[0];\r\n            var typeName = Container.resolveName(param.type);\r\n\r\n            var converter = this.provider.fieldConverter.toDb[typeName];\r\n            var value = converter ? converter(param.value) : param.value;\r\n\r\n            converter = this.provider.fieldConverter.escape[typeName];\r\n            value = converter ? converter(param.value) : param.value;\r\n            context.urlText += value;\r\n        } else {\r\n            for (var i = 0; i < expression.params.length; i++) {\r\n                var param = expression.params[i];\r\n                var typeName = Container.resolveName(param.type);\r\n\r\n                var converter = this.provider.fieldConverter.toDb[typeName];\r\n                var value = converter ? converter(param.value) : param.value;\r\n\r\n                converter = this.provider.fieldConverter.escape[typeName];\r\n                value = converter ? converter(param.value) : param.value;\r\n\r\n                if (i > 0) context.urlText += ',';\r\n                context.urlText += param.name + '=' + value;\r\n            }\r\n        }\r\n        context.urlText += ')';\r\n    },\r\n    VisitProjectionExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n\r\n        var projectionCompiler = Container.createoDataProjectionCompiler(this.provider);\r\n        projectionCompiler.compile(expression, context);\r\n    },\r\n    VisitFilterExpression: function (expression, context) {\r\n        ///<param name=\"expression\" type=\"$data.Expressions.FilterExpression\" />\r\n\r\n        this.Visit(expression.source, context);\r\n\r\n        var filterCompiler = Container.createoDataWhereCompiler(this.provider);\r\n        context.data = \"\";\r\n        filterCompiler.compile(expression.selector, context);\r\n        context[\"$filter\"] = context.data;\r\n        context.data = \"\";\r\n\r\n    },\r\n    VisitInlineCountExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        if (this.provider.providerConfiguration.maxDataServiceVersion === \"4.0\") {\r\n            context[\"$count\"] = expression.selector.value === 'allpages';\r\n        } else {\r\n            context[\"$inlinecount\"] = expression.selector.value;\r\n        }\r\n    },\r\n    VisitEntitySetExpression: function (expression, context) {\r\n        context.urlText += \"/\" + expression.instance.tableName;\r\n        //this.logicalType = expression.instance.elementType;\r\n        if (expression.params) {\r\n            for (var i = 0; i < expression.params.length; i++) {\r\n                this.Visit(expression.params[i], context);\r\n            }\r\n        }\r\n    },\r\n    VisitServiceOperationExpression: function (expression, context) {\r\n        if (expression.boundItem) {\r\n            context.urlText += \"/\" + expression.boundItem.entitySet.tableName;\r\n            if (expression.boundItem.data instanceof $data.Entity) {\r\n                context.urlText += '(' + this.provider.getEntityKeysValue(expression.boundItem) + ')';\r\n            }\r\n        }\r\n        context.urlText += \"/\" + (expression.cfg.namespace ? (expression.cfg.namespace + \".\" + expression.cfg.serviceName) : expression.cfg.serviceName);\r\n        context.method = context.method || expression.cfg.method;\r\n\r\n        //this.logicalType = expression.returnType;\r\n        if (expression.params) {\r\n            context.serviceConfig = expression.cfg\r\n            for (var i = 0; i < expression.params.length; i++) {\r\n                this.Visit(expression.params[i], context);\r\n            }\r\n            delete context.serviceConfig;\r\n        }\r\n    },\r\n    VisitBatchDeleteExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        context.urlText += '/$batchDelete';\r\n        context.method = 'DELETE';\r\n    },\r\n\r\n    VisitConstantExpression: function (expression, context) {\r\n        var typeName = Container.resolveName(expression.type);\r\n        if (expression.value instanceof $data.Entity)\r\n            typeName = $data.Entity.fullName;\r\n\r\n        var converter = this.provider.fieldConverter.toDb[typeName];\r\n        var value = converter ? converter(expression.value, expression) : expression.value;\r\n\r\n\r\n        if (context.method === 'GET' || !context.method) {\r\n            converter = this.provider.fieldConverter.escape[typeName];\r\n            value = converter ? converter(value, expression) : value;\r\n            if (value !== undefined) {\r\n                var serviceConfig = context.serviceConfig || {};\r\n                var paramConfig = (serviceConfig && serviceConfig.params.filter(p => p.name == expression.name)[0]) || {}\r\n                \r\n                var useAlias = serviceConfig.namespace && \r\n                    (paramConfig.useAlias || \r\n                     serviceConfig.useAlias || \r\n                     this.provider.providerConfiguration.useParameterAlias || \r\n                     $data.defaults.OData.useParameterAlias);\r\n                     \r\n                var paramValue = useAlias ? \"@\" + expression.name : value;\r\n                var paramName = (useAlias ? \"@\" : \"\") + expression.name; \r\n                \r\n                if (serviceConfig.namespace) {\r\n                    if (context['$funcParams']) { context['$funcParams'] += ','; } else { context['$funcParams'] = ''; }\r\n                        context['$funcParams'] += expression.name + '=' + paramValue;\r\n                }\r\n                \r\n                if (!serviceConfig.namespace || useAlias) {\r\n                    if (context['$urlParams']) { context['$urlParams'] += '&'; } else { context['$urlParams'] = ''; }\r\n                        context['$urlParams'] += paramName + '=' + value;\r\n                }\r\n            }\r\n        } else {\r\n            context.postData = context.postData || {};\r\n            context.postData[expression.name] = value;\r\n        }\r\n    },\r\n//    VisitConstantExpression: function (expression, context) {\r\n//        if (context['$urlParams']) { context['$urlParams'] += '&'; } else { context['$urlParams'] = ''; }\r\n//\r\n//\r\n//        var valueType = Container.getTypeName(expression.value);\r\n//\r\n//\r\n//\r\n//        context['$urlParams'] += expression.name + '=' + this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(valueType))](expression.value);\r\n//    },\r\n\r\n\r\n    VisitCountExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        context.urlText += '/$count';\r\n    },\r\n\r\n    VisitBatchExecuteQueryExpression: function (expression, context) {\r\n        context.urlText += '/$batch'\r\n        context.method = 'POST';\r\n        context.postData = { __batchRequests: [] };\r\n        context._isBatchExecuteQuery = true;\r\n        context._subQueries = expression.members;\r\n\r\n        for (var i = 0; i < expression.members.length; i++) {\r\n            var queryable = expression.members[i];\r\n            var compiler = new $data.storageProviders.oData.oDataCompiler();\r\n            var compiled = compiler.compile(queryable);\r\n            context.postData.__batchRequests.push({\r\n                requestUri: this.provider.providerConfiguration.oDataServiceHost + compiled.queryText,\r\n                method: compiled.method,\r\n                data: compiled.data,\r\n                headers: compiled.headers\r\n            });\r\n        }\r\n    }\r\n}, {});\r\n","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\nimport atob from 'atob'\r\n\r\n$data.defaults = $data.defaults || {};\r\n$data.defaults.oDataWebApi = false;\r\n\r\n$data.oDataConverter = {\r\n    fromDb: {\r\n        '$data.Enum': function(v, enumType) { return $data.Container.convertTo(v, enumType); },\r\n        '$data.Byte': $data.Container.proxyConverter,\r\n        '$data.SByte': $data.Container.proxyConverter,\r\n        '$data.Decimal': function(v) { return $data.Container.convertTo(v, $data.Decimal); },\r\n        '$data.Float': $data.Container.proxyConverter,\r\n        '$data.Int16': $data.Container.proxyConverter,\r\n        '$data.Int64': function(v) { return $data.Container.convertTo(v, $data.Int64); },\r\n        '$data.ObjectID': $data.Container.proxyConverter,\r\n        '$data.Integer': $data.Container.proxyConverter,//function (number) { return (typeof number === 'string' && /^\\d+$/.test(number)) ? parseInt(number) : number; },\r\n        '$data.Int32': $data.Container.proxyConverter,\r\n        '$data.Number': $data.Container.proxyConverter,\r\n        '$data.Date': function (dbData) {\r\n            if (dbData) {\r\n                if (dbData instanceof Date) {\r\n                    return dbData;\r\n                } else if (dbData.substring(0, 6) === '/Date(') {\r\n                    return new Date(parseInt(dbData.substr(6)));\r\n                } else {\r\n                    //ISODate without Z? Safari compatible with Z\r\n                    if (dbData.indexOf('Z') === -1 && !dbData.match('T.*[+-]'))\r\n                        dbData += 'Z';\r\n                    return new Date(dbData);\r\n                }\r\n            } else {\r\n                return dbData;\r\n            }\r\n        },\r\n        '$data.DateTimeOffset': function (dbData) {\r\n            if (dbData) {\r\n                if (dbData instanceof Date) {\r\n                    return dbData;\r\n                } else if (dbData.substring(0, 6) === '/Date(') {\r\n                    return new Date(parseInt(dbData.substr(6)));\r\n                } else {\r\n                    //ISODate without Z? Safari compatible with Z\r\n                    if (dbData.indexOf('Z') === -1 && !dbData.match('T.*[+-]'))\r\n                        dbData += 'Z';\r\n                    return new Date(dbData);\r\n                }\r\n            } else {\r\n                return dbData;\r\n            }\r\n        },\r\n        '$data.Time': function(v) { return $data.Container.convertTo(v, $data.Time); },\r\n        '$data.Day': $data.Container.proxyConverter,\r\n        '$data.Duration': $data.Container.proxyConverter,\r\n        '$data.String': $data.Container.proxyConverter,\r\n        '$data.Boolean': $data.Container.proxyConverter,\r\n        '$data.Blob': function (v) {\r\n            if (typeof v == 'string'){\r\n                try { return $data.Container.convertTo(atob(v), '$data.Blob'); }\r\n                catch (e) { return v; }\r\n            }else return v;\r\n        },\r\n        '$data.Object': function (o) { if (o === undefined) { return new $data.Object(); } else if (typeof o === 'string') { return JSON.parse(o); } return o; },\r\n        '$data.Array': function (o) { if (o === undefined) { return new $data.Array(); } else if (o instanceof $data.Array) { return o; } return JSON.parse(o); },\r\n        '$data.GeographyPoint': function (g) { if (g) { return new $data.GeographyPoint(g); } return g; },\r\n        '$data.GeographyLineString': function (g) { if (g) { return new $data.GeographyLineString(g); } return g; },\r\n        '$data.GeographyPolygon': function (g) { if (g) { return new $data.GeographyPolygon(g); } return g; },\r\n        '$data.GeographyMultiPoint': function (g) { if (g) { return new $data.GeographyMultiPoint(g); } return g; },\r\n        '$data.GeographyMultiLineString': function (g) { if (g) { return new $data.GeographyMultiLineString(g); } return g; },\r\n        '$data.GeographyMultiPolygon': function (g) { if (g) { return new $data.GeographyMultiPolygon(g); } return g; },\r\n        '$data.GeographyCollection': function (g) { if (g) { return new $data.GeographyCollection(g); } return g; },\r\n        '$data.GeometryPoint': function (g) { if (g) { return new $data.GeometryPoint(g); } return g; },\r\n        '$data.GeometryLineString': function (g) { if (g) { return new $data.GeometryLineString(g); } return g; },\r\n        '$data.GeometryPolygon': function (g) { if (g) { return new $data.GeometryPolygon(g); } return g; },\r\n        '$data.GeometryMultiPoint': function (g) { if (g) { return new $data.GeometryMultiPoint(g); } return g; },\r\n        '$data.GeometryMultiLineString': function (g) { if (g) { return new $data.GeometryMultiLineString(g); } return g; },\r\n        '$data.GeometryMultiPolygon': function (g) { if (g) { return new $data.GeometryMultiPolygon(g); } return g; },\r\n        '$data.GeometryCollection': function (g) { if (g) { return new $data.GeometryCollection(g); } return g; },\r\n        '$data.Guid': function (guid) { return guid ? guid.toString() : guid; }\r\n    },\r\n    toDb: {\r\n        '$data.Enum': $data.Container.proxyConverter,\r\n        '$data.Entity': $data.Container.proxyConverter,\r\n        '$data.Byte': $data.Container.proxyConverter,\r\n        '$data.SByte': $data.Container.proxyConverter,\r\n        '$data.Decimal': $data.Container.proxyConverter,//function (v) { return v ? parseFloat(v) : v },\r\n        '$data.Float': $data.Container.proxyConverter,\r\n        '$data.Int16': $data.Container.proxyConverter,\r\n        '$data.Int64': $data.Container.proxyConverter,//function (v) { return v ? parseInt(v) : v },\r\n        '$data.ObjectID': $data.Container.proxyConverter,\r\n        '$data.Integer': $data.Container.proxyConverter,\r\n        '$data.Int32': $data.Container.proxyConverter,\r\n        '$data.Number': $data.Container.proxyConverter,\r\n        '$data.Date': function (e) { return e ? e.toISOString().replace('Z', '') : e; },\r\n        '$data.Time': $data.Container.proxyConverter,\r\n        '$data.Day': $data.Container.proxyConverter,\r\n        '$data.Duration': $data.Container.proxyConverter,\r\n        '$data.DateTimeOffset': function(v){ return v ? v.toISOString() : v; },\r\n        '$data.String': $data.Container.proxyConverter,\r\n        '$data.Boolean': $data.Container.proxyConverter,\r\n        '$data.Blob': function (v) { return v ? $data.Blob.toBase64(v) : v; },\r\n        '$data.Object': $data.Container.proxyConverter,\r\n        '$data.Array': function(o, def){\r\n            if(o && def && def.elementType){\r\n                var typeName = Container.resolveName(def.elementType);\r\n                var values = [];\r\n                for(var i = 0; i < o.length; i++){\r\n                    values.push($data.oDataConverter['toDb'][typeName](o[i]));\r\n                }\r\n                \r\n                return values;\r\n            }\r\n            return $data.Container.proxyConverter.apply(this, arguments);\r\n        },\r\n        '$data.GeographyPoint': $data.Container.proxyConverter,\r\n        '$data.GeographyLineString': $data.Container.proxyConverter,\r\n        '$data.GeographyPolygon': $data.Container.proxyConverter,\r\n        '$data.GeographyMultiPoint': $data.Container.proxyConverter,\r\n        '$data.GeographyMultiLineString': $data.Container.proxyConverter,\r\n        '$data.GeographyMultiPolygon': $data.Container.proxyConverter,\r\n        '$data.GeographyCollection': $data.Container.proxyConverter,\r\n        '$data.GeometryPoint': $data.Container.proxyConverter,\r\n        '$data.GeometryLineString': $data.Container.proxyConverter,\r\n        '$data.GeometryPolygon': $data.Container.proxyConverter,\r\n        '$data.GeometryMultiPoint': $data.Container.proxyConverter,\r\n        '$data.GeometryMultiLineString': $data.Container.proxyConverter,\r\n        '$data.GeometryMultiPolygon': $data.Container.proxyConverter,\r\n        '$data.GeometryCollection': $data.Container.proxyConverter,\r\n        '$data.Guid': $data.Container.proxyConverter\r\n    },\r\n    escape: {\r\n        '$data.Enum': function (e, enumType) { return  (e !== null && e !== undefined) ? ((enumType ? enumType.fullName : \"\") + \"'\" + e + \"'\") : e },\r\n        '$data.Entity': function (e) { return JSON.stringify(e); },\r\n        '$data.Integer': $data.Container.proxyConverter,\r\n        '$data.Int32': $data.Container.proxyConverter,\r\n        '$data.Number': function (v) { return v && $data.defaults.oDataWebApi ? v + 'd' : v; },\r\n        '$data.Int16': $data.Container.proxyConverter,\r\n        '$data.Byte': $data.Container.proxyConverter,\r\n        '$data.SByte': $data.Container.proxyConverter,\r\n        '$data.Decimal': function (v) { return v && $data.defaults.oDataWebApi ? v + 'm' : v; },\r\n        '$data.Float': function (v) { return v && $data.defaults.oDataWebApi ? v + 'f' : v; },\r\n        '$data.Int64': $data.Container.proxyConverter,\r\n        '$data.Time': $data.Container.proxyConverter,\r\n        '$data.Day': $data.Container.proxyConverter,\r\n        '$data.Duration': function (v) { return v ? \"duration'\" + v + \"'\" : v; },\r\n        '$data.DateTimeOffset': function (d) { return d ? encodeURIComponent(d) : d },\r\n        '$data.Date': function (date) { return date ? \"datetime'\" + date + \"'\" : date; },\r\n        '$data.String': function (text) { return typeof text === 'string' ? \"'\" + text.replace(/'/g, \"''\") + \"'\" : text; },\r\n        '$data.ObjectID': function (text) { return typeof text === 'string' ? \"'\" + text.replace(/'/g, \"''\") + \"'\" : text; },\r\n        '$data.Boolean': function (bool) { return typeof bool === 'boolean' ? bool.toString() : bool; },\r\n        '$data.Blob': function (b) { return b ? \"binary'\" + b + \"'\" : b; },\r\n        '$data.Object': function (o) { return JSON.stringify(o); },\r\n        '$data.Array': function (o, def) {\r\n            if(o && def && def.elementType){\r\n                var typeName = Container.resolveName(def.elementType);\r\n                var values = [];\r\n                for(var i = 0; i < o.length; i++){\r\n                    values.push($data.oDataConverter['escape'][typeName](o[i]));\r\n                }\r\n                \r\n                return \"[\" + values.join(',') + \"]\"\r\n            } \r\n            return JSON.stringify(o); \r\n        },\r\n        '$data.GeographyPoint': function (g) { if (g) { return $data.GeographyBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeographyLineString': function (g) { if (g) { return $data.GeographyBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeographyPolygon': function (g) { if (g) { return $data.GeographyBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeographyMultiPoint': function (g) { if (g) { return $data.GeographyBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeographyMultiLineString': function (g) { if (g) { return $data.GeographyBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeographyMultiPolygon': function (g) { if (g) { return $data.GeographyBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeographyCollection': function (g) { if (g) { return $data.GeographyBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeometryPoint': function (g) { if (g) { return $data.GeometryBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeometryLineString': function (g) { if (g) { return $data.GeometryBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeometryPolygon': function (g) { if (g) { return $data.GeometryBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeometryMultiPoint': function (g) { if (g) { return $data.GeometryBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeometryMultiLineString': function (g) { if (g) { return $data.GeometryBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeometryMultiPolygon': function (g) { if (g) { return $data.GeometryBase.stringifyToUrl(g); } return g; },\r\n        '$data.GeometryCollection': function (g) { if (g) { return $data.GeometryBase.stringifyToUrl(g); } return g; },\r\n        '$data.Guid': function (guid) { return guid ? (\"\" + guid.toString() + \"\") : guid; }\r\n    },\r\n    unescape: {\r\n        '$data.Entity': function (v, c) {\r\n            var config = c || {};\r\n            var value = JSON.parse(v);\r\n            if (value && config.type) {\r\n                var type = Container.resolveType(config.type);\r\n                /*Todo converter*/\r\n                return new type(value, { converters: undefined });\r\n            }\r\n            return value;\r\n        },\r\n        '$data.Number': function (v) { return JSON.parse(v); },\r\n        '$data.Integer': function (v) { return JSON.parse(v); },\r\n        '$data.Int32': function (v) { return JSON.parse(v); },\r\n        '$data.Byte': function (v) { return JSON.parse(v); },\r\n        '$data.SByte': function (v) { return JSON.parse(v); },\r\n        '$data.Decimal': function (v) {\r\n            if (typeof v === 'string' && v.toLowerCase().lastIndexOf('m') === v.length - 1) {\r\n                return v.substr(0, v.length - 1);\r\n            } else {\r\n                return v;\r\n            }\r\n        },\r\n        '$data.Float': function (v) {\r\n            if (typeof v === 'string' && v.toLowerCase().lastIndexOf('f') === v.length - 1) {\r\n                return v.substr(0, v.length - 1);\r\n            } else {\r\n                return v;\r\n            }\r\n        },\r\n        '$data.Int16': function (v) { return JSON.parse(v); },\r\n        '$data.Int64': function (v) {\r\n            return v;\r\n        },\r\n        '$data.Boolean': function (v) { return JSON.parse(v); },\r\n        '$data.Date': function (v) {\r\n            if (typeof v === 'string' && /^datetime'/.test(v)) {\r\n                return v.slice(9, v.length - 1);\r\n            }\r\n            return v;\r\n        },\r\n        '$data.String': function (v) {\r\n            if (typeof v === 'string' && v.indexOf(\"'\") === 0 && v.lastIndexOf(\"'\") === v.length - 1) {\r\n                return v.slice(1, v.length - 1);\r\n            } else {\r\n                return v;\r\n            }\r\n        },\r\n        '$data.ObjectID': function (v) {\r\n            if (typeof v === 'string' && v.indexOf(\"'\") === 0 && v.lastIndexOf(\"'\") === v.length - 1) {\r\n                return v.slice(1, v.length - 1);\r\n            } else {\r\n                return v;\r\n            }\r\n        },\r\n        '$data.Guid': function (v) {\r\n            if (/^\\w{8}-\\w{4}-\\w{4}-\\w{4}-\\w{12}$/.test(v)) {\r\n                var data = v.slice(5, v.length - 1)\r\n                return $data.parseGuid(data).toString();\r\n            }\r\n            return v;\r\n        },\r\n        '$data.Array': function (v, c) {\r\n            var config = c || {};\r\n\r\n            var value = JSON.parse(v) || [];\r\n            if (value && config.elementType) {\r\n                var type = Container.resolveType(config.elementType);\r\n                var typeName = Container.resolveName(type);\r\n                if (type && type.isAssignableTo && type.isAssignableTo($data.Entity)) {\r\n                    typeName = $data.Entity.fullName;\r\n                }\r\n\r\n                if (Array.isArray(value)) {\r\n                    var converter = $data.oDataConverter.unescape[typeName];\r\n                    for (var i = 0; i < value.length; i++) {\r\n                        value[i] = converter ? converter(value[i]) : value[i];\r\n                    }\r\n                }\r\n                return value;\r\n            }\r\n            return value;\r\n        },\r\n        '$data.DateTimeOffset': function (v) {\r\n            if (typeof v === 'string') {\r\n                return $data.Container.convertTo(v, $data.DateTimeOffset);\r\n            }\r\n            return v;\r\n        },\r\n        '$data.Time': function (v) {\r\n            if (typeof v === 'string' && /^time'/.test(v)) {\r\n                return $data.Container.convertTo(v.slice(5, v.length - 1), $data.Time);\r\n            }\r\n            return v;\r\n        },\r\n        '$data.Day': function (v) {\r\n            if (typeof v === 'string' && /^date'/.test(v)) {\r\n                return $data.Container.convertTo(v.slice(5, v.length - 1), $data.Day);\r\n            }\r\n            return v;\r\n        },\r\n        '$data.Duration': function (v) {\r\n            if (typeof v === 'string' && /^duration'/.test(v)) {\r\n                return $data.Container.convertTo(v.slice(9, v.length - 1), $data.Duration);\r\n            }\r\n            return v;\r\n        },\r\n        '$data.Blob': function(v){\r\n            if (typeof v === 'string'){\r\n                if (/^X'/.test(v)){\r\n                    return $data.Blob.createFromHexString(v.slice(2, v.length - 1));\r\n                }else if (/^binary'/.test(v)){\r\n                    return $data.Blob.createFromHexString(v.slice(7, v.length - 1));\r\n                }\r\n            }\r\n            return v;\r\n        },\r\n        '$data.Object': function (v) { return JSON.parse(v); },\r\n        '$data.GeographyPoint': function (v) {\r\n            if (/^geography'POINT\\(/i.test(v)) {\r\n                var data = v.slice(10, v.length - 1);\r\n                return $data.GeographyBase.parseFromString(data);\r\n            }\r\n            return v;\r\n        },\r\n        '$data.GeographyPolygon': function (v) {\r\n            if (/^geography'POLYGON\\(/i.test(v)) {\r\n                var data = v.slice(10, v.length - 1);\r\n                return $data.GeographyBase.parseFromString(data);\r\n            }\r\n            return v;\r\n        },\r\n        '$data.GeometryPoint': function (v) {\r\n            if (/^geometry'POINT\\(/i.test(v)) {\r\n                var data = v.slice(9, v.length - 1);\r\n                return $data.GeometryBase.parseFromString(data);\r\n            }\r\n            return v;\r\n        },\r\n        '$data.GeometryPolygon': function (v) {\r\n            if (/^geometry'POLYGON\\(/i.test(v)) {\r\n                var data = v.slice(9, v.length - 1);\r\n                return $data.GeometryBase.parseFromString(data);\r\n            }\r\n            return v;\r\n        }\r\n    },\r\n    xmlEscape: {\r\n        '$data.Byte': function (v) { return v.toString(); },\r\n        '$data.SByte': function (v) { return v.toString(); },\r\n        '$data.Decimal': function (v) { return v.toString(); },\r\n        '$data.Float': function (v) { return v.toString(); },\r\n        '$data.Int16': function (v) { return v.toString(); },\r\n        '$data.Int64': function (v) { return v.toString(); },\r\n        '$data.Integer': function (v) { return v.toString(); },\r\n        '$data.Int32': function (v) { return v.toString(); },\r\n        '$data.Boolean': function (v) { return v.toString(); },\r\n        '$data.Blob': function (v) { return $data.Blob.toBase64(v); },\r\n        '$data.Date': function (v) { return v.toISOString().replace('Z', ''); },\r\n        '$data.DateTimeOffset': function(v){ return v.toISOString(); },\r\n        '$data.Time': function (v) { return v.toString(); },\r\n        '$data.Day': function (v) { return v.toString(); },\r\n        '$data.Duration': function (v) { return v.toString(); },\r\n        '$data.Number': function (v) { return v.toString(); },\r\n        '$data.String': function (v) { return v.toString(); },\r\n        '$data.ObjectID': function (v) { return v.toString(); },\r\n        '$data.Object': function (v) { return JSON.stringify(v); },\r\n        '$data.Guid': function (v) { return v.toString(); }/*,\r\n        '$data.GeographyPoint': function (v) { return this._buildSpatialPoint(v, 'http://www.opengis.net/def/crs/EPSG/0/4326'); },\r\n        '$data.GeometryPoint': function (v) { return this._buildSpatialPoint(v, 'http://www.opengis.net/def/crs/EPSG/0/0'); },\r\n        '$data.GeographyLineString': function (v) { return this._buildSpatialLineString(v, 'http://www.opengis.net/def/crs/EPSG/0/4326'); },\r\n        '$data.GeometryLineString': function (v) { return this._buildSpatialLineString(v, 'http://www.opengis.net/def/crs/EPSG/0/0'); }*/\r\n    },\r\n    simple: { //$value, $count\r\n        '$data.Byte': function (v) { return v.toString(); },\r\n        '$data.SByte': function (v) { return v.toString(); },\r\n        '$data.Decimal': function (v) { return v.toString(); },\r\n        '$data.Float': function (v) { return v.toString(); },\r\n        '$data.Int16': function (v) { return v.toString(); },\r\n        '$data.Int64': function (v) { return v.toString(); },\r\n        '$data.ObjectID': function (o) { return o.toString(); },\r\n        '$data.Integer': function (o) { return o.toString(); },\r\n        '$data.Int32': function (o) { return o.toString(); },\r\n        '$data.Number': function (o) { return o.toString(); },\r\n        '$data.Date': function (o) { return o instanceof $data.Date ? o.toISOString().replace('Z', '') : o.toString() },\r\n        '$data.DateTimeOffset': function(v){ return v ? v.toISOString() : v; },\r\n        '$data.Time': function (o) { return o.toString(); },\r\n        '$data.Day': function (o) { return o.toString(); },\r\n        '$data.Duration': function (o) { return o.toString(); },\r\n        '$data.String': function (o) { return o.toString(); },\r\n        '$data.Boolean': function (o) { return o.toString(); },\r\n        '$data.Blob': function (o) { return o; },\r\n        '$data.Object': function (o) { return JSON.stringify(o); },\r\n        '$data.Array': function (o) { return JSON.stringify(o); },\r\n        '$data.Guid': function (o) { return o.toString(); },\r\n        '$data.GeographyPoint': function (o) { return JSON.stringify(o); },\r\n        '$data.GeometryPoint': function (o) { return JSON.stringify(o); },\r\n        '$data.GeographyLineString': function (o) { return JSON.stringify(o); },\r\n        '$data.GeographyPolygon': function (o) { return JSON.stringify(o); },\r\n        '$data.GeographyMultiPoint': function (o) { return JSON.stringify(o); },\r\n        '$data.GeographyMultiLineString': function (o) { return JSON.stringify(o); },\r\n        '$data.GeographyMultiPolygon': function (o) { return JSON.stringify(o); },\r\n        '$data.GeographyCollection': function (o) { return JSON.stringify(o); },\r\n        '$data.GeometryLineString': function (o) { return JSON.stringify(o); },\r\n        '$data.GeometryPolygon': function (o) { return JSON.stringify(o); },\r\n        '$data.GeometryMultiPoint': function (o) { return JSON.stringify(o); },\r\n        '$data.GeometryMultiLineString': function (o) { return JSON.stringify(o); },\r\n        '$data.GeometryMultiPolygon': function (o) { return JSON.stringify(o); },\r\n        '$data.GeometryCollection': function (o) { return JSON.stringify(o); }\r\n    }\r\n};\r\n","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\n\r\nexport class ODataIncludeFragment {\r\n    constructor (name) {\r\n        this.name = name;\r\n        this.$expand = [];\r\n        this.$operators = [];\r\n    }\r\n    \r\n    toString(){\r\n        let data = '';\r\n        if(this.$expand.length){\r\n            if(this.name){\r\n                data += this.name + '($expand=';\r\n            }\r\n            for(let i = 0; i < this.$expand.length; i++){\r\n                if(i !== 0) data += ',';\r\n                data += this[this.$expand[i]].toString();\r\n            }\r\n            if(this.name) {\r\n                data += ')';\r\n            }\r\n        }\r\n        \r\n        if(this.name){\r\n            for (let i = 0; i < this.$operators.length; i++) {\r\n                let operator = this.$operators[i];\r\n                let values = this[operator];\r\n                for(let j = 0; j < values.length; j++){\r\n                    if(data) data += ','\r\n                    data += this.name + '(' + operator + '='\r\n                    data += values[j];\r\n                    data += ')';\r\n                }\r\n            }    \r\n        }\r\n        \r\n        if(this.name && !data) {\r\n            data = this.name;\r\n        }\r\n        \r\n        return data;\r\n    }\r\n    \r\n    addInclude(path, map){\r\n        this._createIncludePath(path);\r\n    }\r\n    \r\n    addImplicitMap(path, map){\r\n        var includedFragment = this._createIncludePath(path);\r\n        this._setImplicitMap(includedFragment, map);\r\n    }\r\n    \r\n    _createIncludePath(path) {\r\n        if(!path) return this;\r\n        var inc = path.split('.');\r\n        \r\n        var current = this;\r\n        for(var i = 0; i < inc.length; i++){\r\n            var it = inc[i];\r\n            var included = true;\r\n            if(current.$expand.indexOf(it) < 0){\r\n                included = false;\r\n                current.$expand.push(it);\r\n                current[it] = new ODataIncludeFragment(it);\r\n                current[it].__implicit = true;\r\n            }\r\n            \r\n            current = current[it];\r\n            if(i < inc.length - 1 && current.__implicit){\r\n                this._setImplicitMap(current, inc[i+1]);\r\n            }\r\n        }\r\n        \r\n        return current;\r\n    }\r\n    _setImplicitMap(includeFragment, map){\r\n        if(map){\r\n            if (includeFragment.$operators.indexOf('$select') < 0) {\r\n                if(includeFragment.__implicit) {\r\n                    includeFragment.$operators.push('$select');\r\n                    includeFragment.$select = [map];\r\n                }\r\n            } else if(includeFragment.$expand.indexOf(map) < 0) {\r\n                includeFragment.$select[0] += ',' + map;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n$data.storageProviders.oData.ODataIncludeFragment = ODataIncludeFragment;\r\n\r\n$C('$data.storageProviders.oData.oDataIncludeCompiler', $data.Expressions.EntityExpressionVisitor, null, {\r\n    constructor: function (provider) {\r\n        this.provider = provider;\r\n    },\r\n\r\n    compile: function (expression, context) {\r\n        context.data = context.data || new ODataIncludeFragment();\r\n        context.current = context.data;\r\n        this.Visit(expression, context);\r\n        \r\n    },\r\n    VisitParametricQueryExpression: function (expression, context) {\r\n        this.Visit(expression.expression, context);\r\n    },\r\n    \r\n    VisitEntitySetExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        if (expression.selector instanceof $data.Expressions.AssociationInfoExpression) {\r\n            this.Visit(expression.selector, context);\r\n        }\r\n    },\r\n    \r\n    VisitAssociationInfoExpression: function (expression, context) {\r\n        var propName = expression.associationInfo.FromPropertyName;\r\n        \r\n        this.includePath = this.includePath ? (this.includePath + '.') : \"\";\r\n        this.includePath += propName;\r\n\r\n        var currentPath = this.includePath;\r\n        if (!context.includes.some(function (include) { return include.name == currentPath }, this)) {\r\n            context.includes.push({ name: currentPath, type: expression.associationInfo.ToType });\r\n        }\r\n        \r\n        if(context.current.$expand.indexOf(propName) < 0)\r\n        {\r\n            context.current.$expand.push(propName);\r\n            context.current[propName] = new ODataIncludeFragment(propName);\r\n        }\r\n        context.current = context.current[propName]; \r\n    },\r\n    \r\n    VisitFrameOperationExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        \r\n        var opDef = expression.operation.memberDefinition;\r\n        if(opDef && opDef.includeFrameName){\r\n            var opName = opDef.includeFrameName;\r\n            var paramCounter = 0;\r\n            var params = opDef.parameters || [{ name: \"@expression\" }];\r\n\r\n            var args = params.map(function (item, index) {\r\n                if (item.name === \"@expression\") {\r\n                    return expression.source;\r\n                } else {\r\n                    return expression.parameters[paramCounter++]\r\n                };\r\n            });\r\n            \r\n            if(opDef.includeCompiler){\r\n                for (var i = 0; i < args.length; i++) {\r\n                    var arg = args[i];\r\n                    var compilerType = Container.resolveType(opDef.includeCompiler);\r\n                    var compiler = new compilerType(this.provider);\r\n                    var frameContext = { data: \"\", $expand: context.current };\r\n                                        \r\n                    if (arg && arg.value instanceof $data.Queryable) {\r\n                        var preparator = Container.createQueryExpressionCreator(arg.value.entityContext);\r\n                        var prep_expression = preparator.Visit(arg.value.expression);\r\n                        arg = prep_expression;\r\n                    }\r\n                    \r\n                    var compiled = compiler.compile(arg, frameContext);\r\n                    \r\n                    if(context.current['$operators'].indexOf(opName) < 0){\r\n                        context.current[opName] = [];\r\n                        context.current['$operators'].push(opName);    \r\n                    }\r\n                    context.current[opName].push(frameContext[opName] || frameContext.data);\r\n\r\n                }\r\n            } else if(opDef.implementation) {\r\n                if(context.current['$operators'].indexOf(opName) < 0){\r\n                    context.current[opName] = [];\r\n                    context.current['$operators'].push(opName);    \r\n                }\r\n                context.current[opName].push(opDef.implementation());\r\n            }\r\n        }\r\n    }\r\n});\r\n","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\n\r\n$C('$data.storageProviders.oData.oDataOrderCompiler', $data.storageProviders.oData.oDataWhereCompiler, null, {\r\n    constructor: function (provider) {\r\n        this.provider = provider;\r\n    },\r\n\r\n    compile: function (expression, context) {\r\n        this.Visit(expression, context);\r\n    },\r\n    VisitOrderExpression: function (expression, context) {\r\n        var orderContext = { data: \"\" };\r\n        this.Visit(expression.selector, orderContext);\r\n        if (context['$orderby']) { context['$orderby'] += ','; } else { context['$orderby'] = ''; }\r\n        context['$orderby'] += orderContext.data\r\n                           + (expression.nodeType == $data.Expressions.ExpressionType.OrderByDescending ? \" desc\" : \"\");\r\n    },\r\n    VisitParametricQueryExpression: function (expression, context) {\r\n        this.Visit(expression.expression, context);\r\n    },\r\n    VisitEntityFieldExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        this.Visit(expression.selector, context);\r\n    },\r\n    VisitComplexTypeExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        this.Visit(expression.selector, context);\r\n        context.data += \"/\";\r\n    },\r\n    VisitEntitySetExpression: function (expression, context) {\r\n        if (expression.selector instanceof $data.Expressions.AssociationInfoExpression) {\r\n            this.Visit(expression.source, context);\r\n            this.Visit(expression.selector, context);\r\n        }\r\n    },\r\n    VisitAssociationInfoExpression: function (expression, context) {\r\n        context.data += expression.associationInfo.FromPropertyName + '/';\r\n    },\r\n    VisitEntityExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        this.Visit(expression.selector, context);\r\n    },\r\n    VisitMemberInfoExpression: function (expression, context) {\r\n        context.data += expression.memberName;\r\n    },\r\n    VisitEntityFieldOperationExpression: function (expression, context) {\r\n        Guard.requireType(\"expression.operation\", expression.operation, $data.Expressions.MemberInfoExpression);\r\n\r\n        //TODO refactor!\r\n        var opDef = expression.operation.memberDefinition;\r\n        var opName = opDef.mapTo || opDef.name;\r\n        context.data += opName;\r\n        context.data += \"(\";\r\n        var paramCounter = 0;\r\n        var params = opDef.parameters || [{ name: \"@expression\" }];\r\n\r\n        var args = params.map(function (item, index) {\r\n            if (item.name === \"@expression\") {\r\n                return expression.source;\r\n            } else {\r\n                return expression.parameters[paramCounter++]\r\n            };\r\n        });\r\n\r\n        args.forEach(function (arg, index) {\r\n            if (index > 0) {\r\n                context.data += \",\";\r\n            };\r\n            this.Visit(arg, context);\r\n        }, this);\r\n        context.data += \")\";\r\n    },\r\n    VisitEntityFunctionOperationExpression: function (expression, context) {\r\n        Guard.requireType(\"expression.operation\", expression.operation, $data.Expressions.MemberInfoExpression);\r\n        this.Visit(expression.source, context);\r\n\r\n        //TODO refactor!\r\n        var opDef = expression.operation.memberDefinition;\r\n        var opName = opDef.mapTo || opDef.name;\r\n        context.data += opName;\r\n        context.data += \"(\";\r\n        var paramCounter = 0;\r\n        var params = opDef.method.params || [{ name: \"@expression\" }];\r\n\r\n        var args = params.map(function (item, index) {\r\n            if (item.name === \"@expression\") {\r\n                return expression.source;\r\n            } else {\r\n                return expression.parameters[paramCounter++]\r\n            };\r\n        });\r\n\r\n        var i = 0;\r\n        args.forEach(function (arg, index) {\r\n            if (arg === undefined || (arg instanceof $data.Expressions.ConstantExpression && typeof arg.value === 'undefined'))\r\n                return;\r\n\r\n            if (i > 0) {\r\n                context.data += \",\";\r\n            };\r\n            i++;\r\n            context.data += params[index].name + '=';\r\n            this.Visit(arg, context);\r\n        }, this);\r\n        context.data += \")\";\r\n    },\r\n    VisitContextFunctionOperationExpression: function (expression, context) {\r\n        return this.VisitEntityFunctionOperationExpression(expression, context);\r\n    }\r\n});\r\n","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\n\r\n$C('$data.storageProviders.oData.oDataPagingCompiler', $data.Expressions.EntityExpressionVisitor, null, {\r\n    constructor: function (provider) {\r\n        this.provider = provider;\r\n    },\r\n\r\n    compile: function (expression, context) {\r\n        this.Visit(expression, context);\r\n    },\r\n    VisitPagingExpression: function (expression, context) {\r\n        var pagingContext = { data: \"\" };\r\n        this.Visit(expression.amount, pagingContext);\r\n        switch (expression.nodeType) {\r\n            case $data.Expressions.ExpressionType.Skip: context['$skip'] = pagingContext.data; break;\r\n            case $data.Expressions.ExpressionType.Take: context['$top'] = pagingContext.data; break;\r\n            default: Guard.raise(\"Not supported nodeType\"); break;\r\n        }\r\n    },\r\n    VisitConstantExpression: function (expression, context) {\r\n        var typeName = Container.resolveName(expression.type);\r\n        var converter = this.provider.fieldConverter.escape[typeName];\r\n        context.data += converter ? converter(expression.value) : expression.value;\r\n    }\r\n});\r\n","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\n\r\n$C('$data.storageProviders.oData.oDataProjectionCompiler', $data.Expressions.EntityExpressionVisitor, null, {\r\n    constructor: function (provider) {\r\n        this.provider = provider; \r\n        this.entityContext = provider.context;\r\n        this.hasObjectLiteral = false;\r\n        this.modelBinderMapping = [];\r\n    },\r\n\r\n    compile: function (expression, context) {\r\n        this.Visit(expression, context);\r\n    },\r\n    VisitProjectionExpression: function (expression, context) {\r\n        ///<summary></summary>\r\n        ///<param name=\"expression\" type=\"$data.Expressions.ProjectionExpression\" mayBeNull=\"false\"></param>\r\n        ///<param name=\"context\" mayBeNull=\"false\"></param>\r\n        context.data = \"\";\r\n        this.mapping = \"\";\r\n\r\n        this.Visit(expression.selector, context);\r\n        if (context['$select']) { context['$select'] += ','; } else { context['$select'] = ''; }\r\n        context[\"$select\"] += context.data;\r\n        context.data = \"\";\r\n    },\r\n    VisitParametricQueryExpression: function (expression, context) {\r\n        this.Visit(expression.expression, context);\r\n        var m = this.mapping.split('.');\r\n        \r\n        if (!(expression.expression instanceof $data.Expressions.EntityExpression) && !(expression.expression instanceof $data.Expressions.EntitySetExpression)) {\r\n            m.pop();\r\n        }\r\n        \r\n        if (m.length > 0) {\r\n            if(!context['$expand'] || !(context['$expand'] instanceof $data.storageProviders.oData.ODataIncludeFragment)){\r\n                context['$expand'] = new $data.storageProviders.oData.ODataIncludeFragment();\r\n            }\r\n            context['$expand'].addInclude(m.join('.'))\r\n        }\r\n    },\r\n    VisitObjectLiteralExpression: function (expression, context) {\r\n        ///<summary></summary>\r\n        ///<param name=\"expression\" type=\"$data.Expressions.ObjectLiteralExpression\" mayBeNull=\"false\"></param>\r\n        ///<param name=\"context\" mayBeNull=\"false\"></param>\r\n        \r\n        this.hasObjectLiteral = true;\r\n        expression.members.forEach(function (member, index) {\r\n            this.Visit(member, context);\r\n            if (index < expression.members.length - 1) { context.data += ','; }\r\n            this.mapping = '';\r\n        }, this);\r\n    },\r\n    VisitObjectFieldExpression: function (expression, context) {\r\n        this.Visit(expression.expression, context);\r\n        \r\n        var m = this.mapping.split('.');\r\n        var propertyName = \"\";\r\n        if (!(expression.expression instanceof $data.Expressions.EntityExpression) && !(expression.expression instanceof $data.Expressions.EntitySetExpression)) {\r\n            propertyName = m.pop();\r\n        }\r\n\r\n        if (m.length > 0) {\r\n            if(!context['$expand'] || !(context['$expand'] instanceof $data.storageProviders.oData.ODataIncludeFragment)){\r\n                context['$expand'] = new $data.storageProviders.oData.ODataIncludeFragment();\r\n            }\r\n            \r\n            if(expression.expression instanceof $data.Expressions.EntityFieldExpression && expression.expression.selector instanceof $data.Expressions.MemberInfoExpression){\r\n                var storageModel = this.entityContext._storageModel.getStorageModel(expression.expression.selector.memberDefinition.definedBy)\r\n                if(!storageModel) return;\r\n                \r\n                var isComplexProperty = storageModel && !!storageModel.ComplexTypes[expression.memberName];\r\n                if(isComplexProperty){\r\n                    var complexProperty = m.pop();\r\n                    context['$expand'].addImplicitMap(m.join('.'), complexProperty);\r\n                    return;\r\n                }\r\n            }\r\n            \r\n            \r\n            if (expression.expression instanceof $data.Expressions.ComplexTypeExpression) {\r\n                context['$expand'].addImplicitMap(m.join('.'), propertyName);\r\n            } else {\r\n                context['$expand'].addInclude(m.join('.'))\r\n            }\r\n        }\r\n    },\r\n\r\n    VisitComplexTypeExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        this.Visit(expression.selector, context);\r\n    },\r\n\r\n    VisitEntityFieldExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        this.Visit(expression.selector, context);\r\n    },\r\n    VisitEntityExpression: function (expression, context) {\r\n        ///<summary></summary>\r\n        ///<param name=\"expression\" type=\"$data.Expressions.EntityExpression\" mayBeNull=\"false\"></param>\r\n        ///<param name=\"context\" mayBeNull=\"false\"></param>\r\n        this.Visit(expression.source, context);\r\n    },\r\n    VisitEntitySetExpression: function (expression, context) {\r\n        ///<summary></summary>\r\n        ///<param name=\"expression\" type=\"$data.Expressions.EntitySetExpression\" mayBeNull=\"false\"></param>\r\n        ///<param name=\"context\" mayBeNull=\"false\"></param>\r\n        if (expression.source instanceof $data.Expressions.EntityExpression) {\r\n            this.Visit(expression.source, context);\r\n        }\r\n        if (expression.selector instanceof $data.Expressions.AssociationInfoExpression) {\r\n            this.Visit(expression.selector, context);\r\n        }\r\n    },\r\n    VisitAssociationInfoExpression: function (expression, context) {\r\n        if (this.mapping && this.mapping.length > 0) { this.mapping += '.'; }\r\n        this.mapping += expression.associationInfo.FromPropertyName;\r\n        \r\n        if (context.data && context.data.length > 0 && context.data[context.data.length - 1] != ',') { \r\n            if(!context['$expand'] || !(context['$expand'] instanceof $data.storageProviders.oData.ODataIncludeFragment)){\r\n                context['$expand'] = new $data.storageProviders.oData.ODataIncludeFragment();\r\n            }\r\n            context['$expand'].addInclude(this.mapping)\r\n        } else {\r\n            context.data += expression.associationInfo.FromPropertyName;\r\n        }\r\n\r\n    },\r\n    VisitMemberInfoExpression: function (expression, context) {\r\n        var storageModel = this.entityContext._storageModel.getStorageModel(expression.memberDefinition.definedBy)\r\n        var isComplexProperty = storageModel && !!storageModel.ComplexTypes[expression.memberName];\r\n        var isComplexField = !storageModel;\r\n        \r\n        if (context.data && context.data.length > 0 && context.data[context.data.length - 1] != ',') {\r\n            if(this.mapping){\r\n                if(!context['$expand'] || !(context['$expand'] instanceof $data.storageProviders.oData.ODataIncludeFragment)){\r\n                    context['$expand'] = new $data.storageProviders.oData.ODataIncludeFragment();\r\n                }\r\n                if(isComplexField){\r\n                    var m = this.mapping.split('.');\r\n                    var complexProperty = m.pop();\r\n                    if(this.provider.checkODataMode(\"disableCompltexTypeMapping\")){\r\n                        context['$expand'].addImplicitMap(m.join('.'), complexProperty);\r\n                    } else {\r\n                        context['$expand'].addImplicitMap(m.join('.'), complexProperty + \"/\" + expression.memberName);\r\n                    }\r\n                } else if(!isComplexProperty) {\r\n                    context['$expand'].addImplicitMap(this.mapping, expression.memberName);\r\n                }\r\n            } \r\n        } else {\r\n            //if(context.data[context.data.length - 1] != ',') context.data += '/';\r\n            context.data += expression.memberName;\r\n        }\r\n        \r\n        if (this.mapping && this.mapping.length > 0) { this.mapping += '.'; }\r\n        this.mapping += expression.memberName;        \r\n    },\r\n    VisitConstantExpression: function (expression, context) {\r\n        //Guard.raise(new Exception('Constant value is not supported in Projection.', 'Not supported!'));\r\n        //context.data += expression.value;\r\n\t\tcontext.data = context.data.slice(0, context.data.length - 1);\r\n    }\r\n});\r\n","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\nimport * as odatajs from 'jaydata-odatajs';\r\nimport * as activities from './oDataRequestActivities.js'\r\nimport { strategy as emptySaveStrategy } from './SaveStrategies/empty'\r\nimport { strategy as singleSaveStrategy } from './SaveStrategies/single'\r\nimport { strategy as batchSaveStrategy } from './SaveStrategies/batch'\r\n\r\n\r\nvar OData = $data.__global['OData'];\r\nvar datajs = $data.__global['datajs'];\r\n\r\nvar datajsPatch;\r\ndatajsPatch = function (OData) {\r\n    // just datajs-1.1.0\r\n    if (OData && OData.jsonHandler && 'useJsonLight' in OData.jsonHandler && typeof datajs === 'object' && !datajs.version) {\r\n        $data.Trace.log('!!!!!!! - patch datajs 1.1.0');\r\n        var oldread = OData.defaultHandler.read;\r\n        OData.defaultHandler.read = function (p, context) {\r\n            delete context.contentType;\r\n            delete context.dataServiceVersion;\r\n\r\n            oldread.apply(this, arguments);\r\n        };\r\n        var oldwrite = OData.defaultHandler.write;\r\n        OData.defaultHandler.write = function (p, context) {\r\n            delete context.contentType;\r\n            delete context.dataServiceVersion;\r\n\r\n            oldwrite.apply(this, arguments);\r\n        };\r\n    }\r\n    datajsPatch = function () { };\r\n}\r\n\r\n$data.defaults = $data.defaults || {};\r\n$data.defaults.OData = $data.defaults.OData || {};\r\nif(!(\"withReferenceMethods\" in $data.defaults.OData)){\r\n    $data.defaults.OData.withReferenceMethods = false;\r\n}\r\nif(!(\"disableBatch\" in $data.defaults.OData)){\r\n    $data.defaults.OData.disableBatch = false;\r\n}\r\nif(!(\"eTagAny\" in $data.defaults.OData)){\r\n    $data.defaults.OData.eTagAny = '*';\r\n}\r\nif(!(\"enableDeepSave\" in $data.defaults.OData)){\r\n    $data.defaults.OData.enableDeepSave = false;\r\n}\r\nif(!(\"disableCompltexTypeMapping\" in $data.defaults.OData)){\r\n    $data.defaults.OData.disableCompltexTypeMapping = false;\r\n}\r\n\r\nvar checkODataMode = function(context, functionName){\r\n    if(typeof context.providerConfiguration[functionName] !== 'undefined'){\r\n        return !!context.providerConfiguration[functionName];\r\n    }\r\n    return !!$data.defaults.OData[functionName];\r\n}\r\n\r\n$C('$data.storageProviders.oData.RequestManager', $data.Base, null, {\r\n    constructor: function(){\r\n        this._items = [];\r\n        this._entities = [];\r\n    },\r\n    _items: { type: $data.Array },\r\n    _entities: { type: $data.Array },\r\n    add: function(changedItem, request, countable){\r\n        var item = {\r\n            data: changedItem,\r\n            entity: changedItem.data,\r\n            request: request,\r\n            itemIndex: ++this.maxItemIndex,\r\n            references: []\r\n        };\r\n        \r\n        // request.headers = request.headers || {};\r\n        // request.headers[\"content-Id\"] = item.itemIndex; \r\n        request.add(new activities.SetHeaderProperty(\"content-Id\", item.itemIndex))\r\n        \r\n        if(countable !== false){\r\n            this.length++;\r\n        }\r\n        \r\n        this._entities.push(item.entity)\r\n        this._items.push(item);\r\n        \r\n        return item\r\n    },\r\n    addItemReference: function(entity, reference){\r\n        var item = this.getItem(entity);\r\n        if(item){\r\n            item.references.push(reference);\r\n        } \r\n    },\r\n    getItemIndex: function(entity){\r\n        if(!entity) return -1;\r\n        var idx = this._entities.indexOf(entity);\r\n        if(idx >= 0 && !this._items[idx].removed) {\r\n            return this._items[idx].itemIndex;\r\n        }\r\n        return -1;\r\n    },\r\n    getItem: function(entity, onlyAvailable){\r\n        if(!entity) return null;\r\n        var idx = this._entities.indexOf(entity);\r\n        if(idx >= 0 && (!onlyAvailable || !this._items[idx].removed)) {\r\n            return this._items[idx];\r\n        }\r\n        return null;\r\n    },\r\n    remove: function(entity){\r\n        var idx = this._entities.indexOf(entity);\r\n        if(idx >= 0) {\r\n            var item = this._items[idx];\r\n            if(!item.removed) {\r\n                this._items[idx].removed = true;\r\n                this.length--;\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n    getItems: function(){\r\n        return this._items.filter(function(it){ return !it.removed })\r\n    },\r\n    getByResponse: function(response, i){\r\n        //use response.headers['content-id']\r\n        \r\n        var idx = i;\r\n        \r\n        if(!this._indexCalculated){\r\n            this._indexCalculated = true;\r\n            this._dataForResult = this._items.filter(function(it){\r\n                return !it.removed;\r\n            });\r\n        }\r\n         \r\n        var item = this._dataForResult[idx++];\r\n        return item ? item.entity : null\r\n    },\r\n    setProcessed: function(entity){\r\n        var idx = this._entities.indexOf(entity);\r\n        if(idx >= 0) {\r\n            var item = this._items[idx];\r\n            if(!item.isProcessed){\r\n                this._items[idx].isProcessed = true;\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n    \r\n    maxItemIndex: { value: 0 },\r\n    length: { value: 0 }\r\n});\r\n\r\n\r\n\r\n$C('$data.storageProviders.oData.oDataProvider', $data.StorageProviderBase, null,\r\n{\r\n    constructor: function (cfg, ctx) {\r\n        this.SqlCommands = [];\r\n        this.context = ctx;\r\n        this.providerConfiguration = $data.typeSystem.extend({\r\n            dbCreation: $data.storageProviders.DbCreationType.DropTableIfChanged,\r\n            oDataServiceHost: \"/odata.svc\",\r\n            serviceUrl: \"\",\r\n            maxDataServiceVersion: '4.0',\r\n            dataServiceVersion: undefined,\r\n            user: null,\r\n            password: null,\r\n            withCredentials: false,\r\n            //enableJSONP: undefined,\r\n            //useJsonLight: undefined\r\n            //disableBatch: undefined\r\n            //withReferenceMethods: undefined\r\n            //enableDeepSave: undefined\r\n            UpdateMethod: 'PATCH'\r\n        }, cfg);\r\n\r\n        if (this.providerConfiguration.maxDataServiceVersion === \"4.0\") {\r\n            if (typeof odatajs === 'undefined' || typeof odatajs.oData === 'undefined') {\r\n                Guard.raise(new Exception('odatajs is required', 'Not Found!'));\r\n            } else {\r\n                this.oData = odatajs.oData\r\n            }\r\n        } else {\r\n            if (typeof OData === 'undefined') {\r\n                Guard.raise(new Exception('datajs is required', 'Not Found!'));\r\n            } else {\r\n                this.oData = OData;\r\n                datajsPatch(this.oData);\r\n            }\r\n        }\r\n\r\n        //this.fixkDataServiceVersions(cfg);\r\n\r\n        if (this.context && this.context._buildDbType_generateConvertToFunction && this.buildDbType_generateConvertToFunction) {\r\n            this.context._buildDbType_generateConvertToFunction = this.buildDbType_generateConvertToFunction;\r\n        }\r\n        if (this.context && this.context._buildDbType_modifyInstanceDefinition && this.buildDbType_modifyInstanceDefinition) {\r\n            this.context._buildDbType_modifyInstanceDefinition = this.buildDbType_modifyInstanceDefinition;\r\n        }\r\n    },\r\n    fixkDataServiceVersions: function (cfg) {\r\n        if (this.providerConfiguration.dataServiceVersion > this.providerConfiguration.maxDataServiceVersion) {\r\n            this.providerConfiguration.dataServiceVersion = this.providerConfiguration.maxDataServiceVersion;\r\n        }\r\n\r\n        if (this.providerConfiguration.setDataServiceVersionToMax === true) {\r\n            this.providerConfiguration.dataServiceVersion = this.providerConfiguration.maxDataServiceVersion;\r\n        }\r\n\r\n        if ((cfg && !cfg.UpdateMethod && this.providerConfiguration.dataServiceVersion < '3.0') || !this.providerConfiguration.dataServiceVersion) {\r\n            this.providerConfiguration.UpdateMethod = 'MERGE';\r\n        }\r\n    },\r\n    initializeStore: function (callBack) {\r\n        callBack = $data.PromiseHandlerBase.createCallbackSettings(callBack);\r\n        switch (this.providerConfiguration.dbCreation) {\r\n            case $data.storageProviders.DbCreationType.DropAllExistingTables:\r\n                var that = this;\r\n                if (this.providerConfiguration.serviceUrl) {\r\n\r\n                    var requestData = [{\r\n                        requestUri: that.providerConfiguration.serviceUrl + \"/Delete\",\r\n                        method: 'POST'\r\n                    }, function (d) {\r\n                        //console.log(\"RESET oData database\");\r\n                        callBack.success(that.context);\r\n                    }, function (error) {\r\n                        callBack.success(that.context);\r\n                    }];\r\n\r\n                    this.appendBasicAuth(requestData[0], this.providerConfiguration.user, this.providerConfiguration.password, this.providerConfiguration.withCredentials);\r\n                    //if (this.providerConfiguration.user) {\r\n                    //    requestData[0].user = this.providerConfiguration.user;\r\n                    //    requestData[0].password = this.providerConfiguration.password || \"\";\r\n                    //}\r\n\r\n                    this.context.prepareRequest.call(this, requestData);\r\n                    this.oData.request.apply(this, requestData);\r\n                } else {\r\n                    callBack.success(that.context);\r\n                }\r\n                break;\r\n            default:\r\n                callBack.success(this.context);\r\n                break;\r\n        }\r\n    },\r\n    buildDbType_generateConvertToFunction: function (storageModel, context) {\r\n        return function (logicalEntity, convertedItems) {\r\n            var dbInstance = new storageModel.PhysicalType();\r\n            dbInstance.entityState = logicalEntity.entityState;\r\n\r\n            storageModel.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function (property) {\r\n                dbInstance.initData[property.name] = logicalEntity[property.name];\r\n            }, this);\r\n\r\n            if (storageModel.Associations) {\r\n                storageModel.Associations.forEach(function (association) {\r\n                    if ((association.FromMultiplicity == \"*\" && association.ToMultiplicity == \"0..1\") ||\r\n                        (association.FromMultiplicity == \"0..1\" && association.ToMultiplicity == \"1\") ||\r\n                        (association.FromMultiplicity == '$$unbound')) {\r\n                        var refValue = logicalEntity[association.FromPropertyName];\r\n                        if (/*refValue !== null &&*/ refValue !== undefined) {\r\n                            if (refValue instanceof $data.Array) {\r\n                                dbInstance.initData[association.FromPropertyName] = dbInstance[association.FromPropertyName] || [];\r\n                                refValue.forEach(function (rv) {\r\n                                    var item = convertedItems.getItem(rv, true)\r\n                                    var contentId = item ? item.itemIndex : -1;\r\n                                    if (rv.entityState == $data.EntityState.Modified || contentId < 0) {\r\n                                        var sMod = context._storageModel.getStorageModel(rv.getType())\r\n                                        var tblName = sMod.TableName;\r\n                                        var pk = '(' + context.storageProvider.getEntityKeysValue({ data: rv, entitySet: context.getEntitySetFromElementType(rv.getType()) }) + ')';\r\n                                        dbInstance.initData[association.FromPropertyName].push({ __metadata: { uri: tblName + pk } });\r\n                                    } else {\r\n                                        if (contentId < 0) { Guard.raise(\"Dependency graph error\"); }\r\n                                        //dbInstance.initData[association.FromPropertyName].push({ __metadata: { uri: \"$\" + (contentId) } });\r\n                                        dbInstance.initData[association.FromPropertyName].push({ __convertedRefence: item });\r\n                                    }\r\n                                }, this);\r\n                            } else if (refValue === null) {\r\n                                dbInstance.initData[association.FromPropertyName] = null;\r\n                            } else {\r\n                                var item = convertedItems.getItem(refValue, true);\r\n                                var contentId = item ? item.itemIndex : -1;\r\n                                if (refValue.entityState == $data.EntityState.Modified || contentId < 0) {\r\n                                    var sMod = context._storageModel.getStorageModel(refValue.getType())\r\n                                    var tblName = sMod.TableName;\r\n                                    var pk = '(' + context.storageProvider.getEntityKeysValue({ data: refValue, entitySet: context.getEntitySetFromElementType(refValue.getType()) }) + ')';\r\n                                    dbInstance.initData[association.FromPropertyName] = { __metadata: { uri: tblName + pk } };\r\n                                } else {\r\n                                    if (contentId < 0) { Guard.raise(\"Dependency graph error\"); }\r\n                                    //dbInstance.initData[association.FromPropertyName] = { __metadata: { uri: \"$\" + (contentId) } };\r\n                                    dbInstance.initData[association.FromPropertyName] = { __convertedRefence: item };\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }, this);\r\n            }\r\n            if (storageModel.ComplexTypes) {\r\n                storageModel.ComplexTypes.forEach(function (cmpType) {\r\n                    dbInstance.initData[cmpType.FromPropertyName] = logicalEntity[cmpType.FromPropertyName];\r\n                }, this);\r\n            }\r\n            return dbInstance;\r\n        };\r\n    },\r\n    buildDbType_modifyInstanceDefinition: function () { return; },\r\n    executeQuery: function (query, callBack) {\r\n        callBack = $data.PromiseHandlerBase.createCallbackSettings(callBack);\r\n\r\n        var sql = {};\r\n        try {\r\n            sql = this._compile(query);\r\n        } catch (e) {\r\n            callBack.error(e);\r\n            return;\r\n        }\r\n        var schema = this.context;\r\n\r\n        var that = this;\r\n        var countProperty = \"@odata.count\";\r\n\r\n        var requestData = [\r\n            {\r\n                requestUri: this.providerConfiguration.oDataServiceHost + sql.queryText,\r\n                method: sql.method,\r\n                data: sql.postData,\r\n                headers: {\r\n                }\r\n            },\r\n            function (data, textStatus, jqXHR) {\r\n\r\n                if (!data && textStatus.body && !sql.isBatchExecuteQuery) data = JSON.parse(textStatus.body);\r\n                if (callBack.success) {\r\n                    var processSuccess = function (query, data, sql) {\r\n                        query.rawDataList = typeof data === 'string' ? [{ cnt: Container.convertTo(data, $data.Integer) }] : data;\r\n                        if (sql.withInlineCount && typeof data === 'object' && (typeof data[countProperty] !== 'undefined' || ('d' in data && typeof data.d[countProperty] !== 'undefined'))) {\r\n                            query.__count = new Number(typeof data[countProperty] !== 'undefined' ? data[countProperty] : data.d[countProperty]).valueOf();\r\n                        }\r\n                    }\r\n\r\n                    if (sql.isBatchExecuteQuery) {\r\n                        query.rawDataList = sql.subQueries;\r\n                        for (var i = 0; i < data.__batchResponses.length; i++) {\r\n                            var resp = data.__batchResponses[i];\r\n\r\n                            if (!resp.data) {\r\n                                if (resp.body) {\r\n                                    resp.data = JSON.parse(resp.body);\r\n                                } else {\r\n                                    callBack.error(that.parseError(resp, arguments));\r\n                                    return;\r\n                                }\r\n                            }\r\n\r\n                            processSuccess(sql.subQueries[i], resp.data, sql.subQueries[i]._getComplitedData());\r\n                        }\r\n                    } else {\r\n                        processSuccess(query, data, sql);\r\n                    }\r\n\r\n                    callBack.success(query);\r\n                }\r\n            },\r\n            function (error) {\r\n                callBack.error(that.parseError(error, arguments));\r\n            },\r\n            sql.isBatchExecuteQuery ? this.oData.batch.batchHandler : undefined\r\n        ];\r\n\r\n        if (typeof this.providerConfiguration.enableJSONP !== 'undefined') {\r\n            requestData[0].enableJsonpCallback = this.providerConfiguration.enableJSONP;\r\n        }\r\n        if (typeof this.providerConfiguration.useJsonLight !== 'undefined') {\r\n            requestData[0].useJsonLight = this.providerConfiguration.useJsonLight;\r\n        }\r\n\r\n        this.appendBasicAuth(requestData[0], this.providerConfiguration.user, this.providerConfiguration.password, this.providerConfiguration.withCredentials);\r\n        //if (this.providerConfiguration.user) {\r\n        //    requestData[0].user = this.providerConfiguration.user;\r\n        //    requestData[0].password = this.providerConfiguration.password || \"\";\r\n        //}\r\n\r\n        this.context.prepareRequest.call(this, requestData);\r\n        //$data.ajax(requestData);\r\n        //OData.request(requestData, requestData.success, requestData.error);\r\n        this.oData.request.apply(this, requestData);\r\n    },\r\n    _compile: function (queryable, params) {\r\n        var compiler = new $data.storageProviders.oData.oDataCompiler();\r\n        var compiled = compiler.compile(queryable);\r\n        return compiled;\r\n    },\r\n    saveChanges: function (callBack, changedItems) {\r\n        if (changedItems.length > 0) {\r\n            this.saveInternal(changedItems, callBack);\r\n        }\r\n        else {\r\n            callBack.success(0);\r\n        }\r\n    },\r\n    saveInternal: function (changedItems, callBack) {\r\n        var independentBlocks = this.buildIndependentBlocks(changedItems);\r\n        if(checkODataMode(this, \"enableDeepSave\")){\r\n            this._checkDeepSave(changedItems)\r\n        }\r\n        var convertedItems = this._buildSaveData(independentBlocks, changedItems)\r\n        var actionMode = this.saveStrategySelector(convertedItems);\r\n        if(actionMode){\r\n            actionMode.save(this, convertedItems, callBack);\r\n        } else {\r\n            callBack.error(new Exception('Not Found', 'Save action not found'));\r\n        }\r\n    },\r\n    saveStrategySelector: function(convertedItems){\r\n        for(var i = 0; i < this.saveStrategies.length; i++){\r\n            var saveAction = this.saveStrategies[i];\r\n            if(saveAction.condition(this, convertedItems)){\r\n                return saveAction;\r\n            }\r\n        }\r\n        \r\n        return null;\r\n    },\r\n    saveStrategies: {\r\n        value: [\r\n            batchSaveStrategy,\r\n            singleSaveStrategy,\r\n            emptySaveStrategy\r\n        ]\r\n    },\r\n    \r\n    _discoverSaveOrder: function(changedItems){\r\n        var entityItems = changedItems.map(function(it){ return it.data });\r\n        var entityInfo = changedItems.map(function(it){ return { path: [], visited: false, result: true } });\r\n        var entityQueue = [];\r\n        var discoveredEntities = [];\r\n       \r\n        var process = function(currentEntity){\r\n            var index = entityItems.indexOf(currentEntity);\r\n            var changedItem = changedItems[index];\r\n            var info = entityInfo[index];\r\n            \r\n            if(info.visited) return info.result;\r\n            if(info.visiting) return false;\r\n            \r\n            var references = [];\r\n            if(changedItem.referredBy){\r\n                references = references.concat(changedItem.referredBy);\r\n            }\r\n            if(changedItem.dependentOn){\r\n                references = references.concat(changedItem.dependentOn);\r\n            }\r\n            \r\n            for(var i = 0; i < references.length; i++){\r\n                var ref = references[i];\r\n                if(discoveredEntities.indexOf(ref) < 0){\r\n                    entityQueue.push(ref);\r\n                    discoveredEntities.push(ref);\r\n                    var refIndex = entityItems.indexOf(ref);\r\n                    changedItems[refIndex].deepParent = currentEntity;\r\n                }\r\n            }\r\n        }\r\n        \r\n        \r\n        for(var i = 0; i < changedItems.length; i++){\r\n            var changedItem = changedItems[i];\r\n            if(entityQueue.indexOf(changedItem.data) < 0){\r\n                entityQueue.push(changedItem.data);\r\n                discoveredEntities.push(changedItem.data);\r\n                entityInfo[i].parent = null;\r\n            }\r\n            \r\n            while(entityQueue.length){\r\n                var currentItem = entityQueue.shift();\r\n                process(currentItem);\r\n            }\r\n        }\r\n    },\r\n    \r\n    _checkDeepSave: function(changedItems){\r\n        var entityItems = changedItems.map(function(it){ return it.data });\r\n        var entityInfo = changedItems.map(function(it){ return { path: [], visited: false, result: true } });\r\n       \r\n        var discover = function(changedItem, parent, index){\r\n            var info = entityInfo[index];\r\n            if(info.visited) return info.result;\r\n            if(info.visiting) return false;\r\n            \r\n            var references = [];\r\n            if(changedItem.referredBy){\r\n                references = references.concat(changedItem.referredBy);\r\n            }\r\n            if(changedItem.dependentOn){\r\n                references = references.concat(changedItem.dependentOn);\r\n            }\r\n            \r\n            \r\n            if(references.length === 0){\r\n                info.visited = true;\r\n                info.result = true;\r\n            } else {\r\n                info.visiting = true;\r\n                \r\n                for(var i = 0; i < references.length; i++){\r\n                    var entity = references[i]\r\n                    var idx = entityItems.indexOf(entity);\r\n                    var innerChangeItem = changedItems[idx];\r\n                    if(!innerChangeItem) return false; \r\n                    if(innerChangeItem === parent) continue;\r\n                    \r\n                    var result = discover(innerChangeItem, changedItem, idx);\r\n                    info.result = info.result && changedItem.data.entityState === $data.EntityState.Added && (!changedItem.additionalDependentOn || changedItem.additionalDependentOn.length === 0) && result;\r\n                }\r\n                delete info.visiting;\r\n                info.visited = true; \r\n            }\r\n            \r\n            changedItem.enableDeepSave = info.result;\r\n            return info.result;\r\n        }\r\n        \r\n        \r\n        for(var i = 0; i < changedItems.length; i++){\r\n            var changedItem = changedItems[i];\r\n            discover(changedItem, null, i);\r\n        }\r\n        \r\n        this._discoverSaveOrder(changedItems);\r\n    },\r\n    \r\n    _buildSaveData: function(independentBlocks, changedItems) {\r\n        var convertedItems = new $data.storageProviders.oData.RequestManager();\r\n        for (var index = 0; index < independentBlocks.length; index++) {\r\n            for (var i = 0; i < independentBlocks[index].length; i++) {\r\n                var independentItem = independentBlocks[index][i];\r\n                \r\n                var request = null;\r\n                var item = convertedItems.getItem(independentItem.data)\r\n                if(!item){\r\n                    request = new activities.RequestBuilder(this)\r\n                    request.add(new activities.SetUrl(this.providerConfiguration.oDataServiceHost + '/'))\r\n                    item = convertedItems.add(independentItem, request);\r\n                }\r\n                request = item.request;\r\n                \r\n                var entityState = independentItem.data.entityState;\r\n                if(typeof this._buildRequestObject['EntityState_' + entityState] === 'function'){\r\n                    this._buildRequestObject['EntityState_' + entityState](this, independentItem, convertedItems, request, changedItems)\r\n                } else {\r\n                    Guard.raise(new Exception(\"Not supported Entity state\"));\r\n                }\r\n            }\r\n        }\r\n        \r\n        return convertedItems;\r\n    },\r\n    _buildRequestObject: {\r\n        value: {\r\n            'EntityState_20': function(provider, item, convertedItem, request, changedItems){\r\n                request.add(\r\n                    new activities.SetMethod(\"POST\"), \r\n                    new activities.AppendUrl(item.entitySet.tableName)\r\n                )\r\n                \r\n                provider.save_getInitData(item, convertedItem, undefined, undefined, request, changedItems);\r\n            },\r\n            'EntityState_30': function(provider, item, convertedItem, request, changedItems){\r\n                request.add(\r\n                    new activities.SetMethod(provider.providerConfiguration.UpdateMethod),\r\n                    new activities.AppendUrl(item.entitySet.tableName), \r\n                    new activities.AppendUrl(\"(\" + provider.getEntityKeysValue(item) + \")\")\r\n                )\r\n                \r\n                provider.addETagHeader(item, request)\r\n                \r\n                provider.save_getInitData(item, convertedItem, undefined, undefined, request, changedItems);\r\n            },\r\n            'EntityState_40': function(provider, item, convertedItem, request, changedItems){\r\n                request.add(\r\n                    new activities.SetMethod(\"DELETE\"),\r\n                    new activities.ClearRequestData(),\r\n                    new activities.AppendUrl(item.entitySet.tableName),\r\n                    new activities.AppendUrl(\"(\" + provider.getEntityKeysValue(item) + \")\")\r\n                )\r\n                \r\n                provider.addETagHeader(item, request)\r\n            },\r\n        }\r\n    },\r\n    reload_fromResponse: function (item, data, response) {\r\n        var that = this;\r\n        item.getType().memberDefinitions.getPublicMappedProperties().forEach(function (memDef) {\r\n            var propType = Container.resolveType(memDef.type);\r\n            if (memDef.computed || memDef.key || !memDef.inverseProperty) {\r\n                if (memDef.concurrencyMode === $data.ConcurrencyMode.Fixed) {\r\n                    //unescape?\r\n                    //item[memDef.name] = response.headers.ETag || response.headers.Etag || response.headers.etag;\r\n                    item[memDef.name] = data['@odata.etag'];\r\n\r\n                } else if (memDef.isAssignableTo) {\r\n                    if (data[memDef.name]) {\r\n                        item[memDef.name] = new propType(data[memDef.name], { converters: that.fieldConverter.fromDb });\r\n                    } else {\r\n                        item[memDef.name] = data[memDef.name]\r\n                    }\r\n\r\n                } else if (propType === $data.Array && memDef.elementType) {\r\n                    var aeType = Container.resolveType(memDef.elementType);\r\n                    if (data[memDef.name] && Array.isArray(data[memDef.name])) {\r\n                        var arrayProperty = [];\r\n                        for (var ap = 0; ap < data[memDef.name].length; ap++) {\r\n                            var aitem = data[memDef.name][ap];\r\n                            if (aeType.isAssignableTo && !Guard.isNullOrUndefined(aitem)) {\r\n                                arrayProperty.push(new aeType(aitem, { converters: that.fieldConverter.fromDb }));\r\n                            } else {\r\n                                var etypeName = Container.resolveName(aeType);\r\n                                var econverter = that.fieldConverter.fromDb[etypeName];\r\n\r\n                                arrayProperty.push(econverter ? econverter(aitem) : aitem);\r\n                            }\r\n                        }\r\n                        item[memDef.name] = arrayProperty;\r\n                    } else if (!data[memDef.name]) {\r\n                        item[memDef.name] = data[memDef.name]\r\n                    }\r\n\r\n                } else {\r\n                    var typeName = Container.resolveName(memDef.type);\r\n                    var converter = that.fieldConverter.fromDb[typeName];\r\n\r\n                    item[memDef.name] = converter ? converter(data[memDef.name]) : data[memDef.name];\r\n                }\r\n            }\r\n        }, this);\r\n    },\r\n\r\n    save_getInitData: function (item, convertedItems, isComplex, isDeep, request, changedItems) {\r\n        var self = this;\r\n        if (!isComplex) {\r\n            item.physicalData = this.context._storageModel.getStorageModel(item.data.getType()).PhysicalType.convertTo(item.data, convertedItems);\r\n        } else {\r\n            item.physicalData = item.data;\r\n        }\r\n        var hasSavedProperty = item.data.entityState === $data.EntityState.Added;\r\n        item.physicalData.getType().memberDefinitions.asArray().forEach(function (memdef) {\r\n            hasSavedProperty = self.propertyConversationSelector(item, memdef, convertedItems, request, changedItems, isDeep) || hasSavedProperty;\r\n        }, this);\r\n        \r\n        if(!hasSavedProperty && !isDeep){\r\n            convertedItems.remove(item.data)\r\n        }\r\n    },\r\n    propertyConversationSelector: function(item, memdef, convertedItems, request, changedItems, isDeep) {\r\n        if (memdef.kind == $data.MemberTypes.complexProperty) {\r\n            return this._complexPropertySelector.apply(this, arguments)\r\n        }\r\n        \r\n        if (memdef.kind == $data.MemberTypes.property) {\r\n            return this._propertySelector.apply(this, arguments);\r\n        }\r\n        \r\n        if(memdef.kind == $data.MemberTypes.navProperty){\r\n            return this._navigationPropertySelector.apply(this, arguments);\r\n        }\r\n        \r\n        return false;\r\n    },\r\n    _complexPropertySelector: function(item, memdef, convertedItems, request, changedItems, isDeep){\r\n        return this.propertyConversationStrategies[\"complex\"].apply(this, arguments)\r\n    },\r\n    _propertySelector: function(item, memdef, convertedItems, request, changedItems, isDeep){\r\n        if(typeof memdef.concurrencyMode === 'undefined') {\r\n            switch (true){\r\n                case memdef.notMapped: \r\n                    return false;\r\n                case memdef.key === true:\r\n                    this.propertyConversationStrategies[\"default\"].apply(this, arguments)\r\n                    return false;\r\n                case isDeep:\r\n                case item.data.entityState === $data.EntityState.Added:\r\n                case this._propertyIsChanged(item.data, memdef):\r\n                    return this.propertyConversationStrategies[\"default\"].apply(this, arguments)\r\n                default: return false;\r\n            }\r\n        }\r\n        \r\n        return false;\r\n    },\r\n    _navigationPropertySelector: function(item, memdef, convertedItems, request, changedItems, isDeep){\r\n        if (isDeep || item.data.entityState === $data.EntityState.Added || this._propertyIsChanged(item.data, memdef)) {\r\n            \r\n            var navigationValue = item.data[memdef.name];\r\n            if (checkODataMode(this, 'enableDeepSave') && navigationValue && item.data.entityState === $data.EntityState.Added) {\r\n                var result = null;\r\n                if (Array.isArray(navigationValue)) {\r\n                    navigationValue.forEach((navItem, index) => {\r\n                        this._processDeepSaveItems(item, memdef, convertedItems, request, changedItems, navItem, \"deepSaveArray\", index);\r\n                        //update not supported here\r\n                    })\r\n                    return true; //item.data is new\r\n                } else {\r\n                    result = this._processDeepSaveItems(item, memdef, convertedItems, request, changedItems, navigationValue, \"deepSave\")\r\n                }\r\n                \r\n                if(result !== null){\r\n                    return result;\r\n                }\r\n            }\r\n            \r\n\r\n            return this._simpleNavigationPropertySelector.apply(this, arguments)\r\n        }\r\n        return false;\r\n    },\r\n    _simpleNavigationPropertySelector: function(item, memdef, convertedItems, request, changedItems, isDeep){\r\n        if(checkODataMode(this, 'withReferenceMethods')){\r\n            return this.propertyConversationStrategies[\"withReferenceMethods\"].apply(this, arguments)\r\n        } \r\n        \r\n        return this.propertyConversationStrategies[\"navigation\"].apply(this, arguments)\r\n    },\r\n    \r\n    _processDeepSaveItems: function(item, memdef, convertedItems, request, changedItems, navigationEntity, strategy, index){\r\n        var referencedItems = changedItems.filter(function(it){ return it.data == navigationEntity });\r\n        \r\n        if (referencedItems.length === 1 &&\r\n            referencedItems[0].enableDeepSave &&\r\n            navigationEntity.entityState === $data.EntityState.Added &&\r\n            referencedItems[0].deepParent === item.data) \r\n        {\r\n            var deepItem = convertedItems.getItem(referencedItems[0].data);\r\n            if(!deepItem) {\r\n                var referencedRequest = new activities.RequestBuilder(this)\r\n                referencedRequest.add(new activities.SetUrl(this.providerConfiguration.oDataServiceHost + '/'))\r\n                deepItem = convertedItems.add(referencedItems[0], referencedRequest)\r\n            }\r\n            \r\n            convertedItems.addItemReference(item.data, deepItem);\r\n            if(!deepItem.removed) {\r\n                convertedItems.remove(referencedItems[0].data)\r\n            }\r\n\r\n            return this.propertyConversationStrategies[strategy].call(this, item, memdef, convertedItems, request, changedItems, index)\r\n        }\r\n        \r\n        return null;\r\n    },\r\n    _propertyIsChanged: function(entity, memdef){\r\n        return entity && entity.changedProperties && entity.changedProperties.some(function (def) { return def.name === memdef.name; })\r\n    },\r\n    propertyConversationStrategies: {\r\n        value:{\r\n            \"default\": function (item, memdef, convertedItems, request, changedItems) {\r\n                var typeName = Container.resolveName(memdef.type);\r\n                var converter = this.fieldConverter.toDb[typeName];\r\n                request.add(new activities.SetProperty(memdef.name, converter ? converter(item.physicalData[memdef.name]) : item.physicalData[memdef.name]))\r\n                return true;\r\n            },\r\n            \"withReferenceMethods\": function (item, memdef, convertedItems, request, changedItems) {\r\n                var reqItem = convertedItems.getItem(item.data);\r\n                if(reqItem && reqItem.removed) return false; //deep saved\r\n                \r\n                var additionalRequest = new activities.RequestBuilder(this)\r\n                var value = item.physicalData[memdef.name];\r\n                if(value){\r\n                    additionalRequest.add(new activities.SetMethod('POST'))\r\n                    if (value.__metadata) {\r\n                        additionalRequest.add(new activities.SetProperty('@odata.id', this.providerConfiguration.oDataServiceHost + '/' + value.__metadata.uri))\r\n                    } else if (value.__convertedRefence) {\r\n                        additionalRequest.add(function(req, provider){\r\n                            var targetItem = value.__convertedRefence;\r\n                            req.data = req.data || {};\r\n                            if(targetItem.isProcessed){\r\n                                req.data[\"@odata.id\"] = provider.getEntityUrlReference(targetItem.entity);\r\n                            } else {\r\n                                req.data[\"@odata.id\"] = provider.providerConfiguration.oDataServiceHost + '/$' + targetItem.itemIndex\r\n                            } \r\n                        })\r\n                    }\r\n                } else {\r\n                    if(item.data.entityState === $data.EntityState.Added || value !== null) return\r\n                    \r\n                    additionalRequest.add(\r\n                        new activities.SetUrl(this.providerConfiguration.oDataServiceHost + '/'),\r\n                        new activities.AppendUrl(item.entitySet.tableName),\r\n                        new activities.AppendUrl(\"(\" + this.getEntityKeysValue(item) + \")\"),\r\n                        new activities.SetMethod('DELETE'),\r\n                        new activities.ClearRequestData())\r\n                }\r\n                \r\n                additionalRequest.add(function(req, provider){\r\n                    if(reqItem.isProcessed || item.data.entityState !== $data.EntityState.Added){\r\n                        req.requestUri = provider.providerConfiguration.oDataServiceHost + '/';\r\n                        req.requestUri += item.entitySet.tableName;\r\n                        req.requestUri += \"(\" + provider.getEntityKeysValue(item) + \")\";\r\n                        provider.addETagHeader(item, req)\r\n                    } else {\r\n                        req.requestUri = '$' + reqItem.itemIndex;\r\n                        provider.addETagHeader(item, req, $data.defaults.OData.eTagAny)\r\n                    } \r\n                    \r\n                    req.requestUri += '/' + memdef.name + '/$ref';\r\n                })\r\n                \r\n                var refItem = convertedItems.add(item, additionalRequest, false);\r\n                convertedItems.addItemReference(item.data, refItem);\r\n                return false;\r\n            },\r\n            \"deepSave\": function (item, memdef, convertedItems, request, changedItems) {\r\n                var refItem = convertedItems.getItem(item.data[memdef.name])\r\n                request.add(function(req, provider){\r\n                        req.data[memdef.name] = refItem.request.build().get().data;\r\n                })\r\n                return true;\r\n            },\r\n            \"deepSaveArray\": function (item, memdef, convertedItems, request, changedItems, index) {\r\n                var refItem = convertedItems.getItem(item.data[memdef.name][index])\r\n                request.add(function(req, provider){\r\n                        req.data[memdef.name] = req.data[memdef.name] || [];\r\n                        req.data[memdef.name].push(refItem.request.build().get().data);\r\n                })\r\n                return true;\r\n            },\r\n            \"navigation\": function (item, memdef, convertedItems, request, changedItems) {\r\n                \r\n                request.add(function(req, provider){\r\n                    req.data = req.data || {};\r\n                    \r\n                    if(item.physicalData[memdef.name] && item.physicalData[memdef.name].__metadata) {\r\n                        req.data[memdef.name + \"@odata.bind\"] = item.physicalData[memdef.name].__metadata.uri;\r\n                    } else if (item.physicalData[memdef.name] && item.physicalData[memdef.name].__convertedRefence) {\r\n                        var targetItem = item.physicalData[memdef.name].__convertedRefence;\r\n                        if(targetItem.isProcessed){\r\n                            req.data[memdef.name + \"@odata.bind\"] = provider.getEntityUrlReference(targetItem.entity);\r\n                        } else {\r\n                            req.data[memdef.name + \"@odata.bind\"] = \"$\" + targetItem.itemIndex;\r\n                        } \r\n                    } else if(item.physicalData[memdef.name] === null) {\r\n                        req.data[memdef.name + \"@odata.bind\"] = null;\r\n                    }\r\n                })\r\n                return true;\r\n            },\r\n            \"complex\": function(item, memdef, convertedItems, request, changedItems){\r\n                if (item.physicalData[memdef.name]) {\r\n                    var innerRequest = new activities.RequestBuilder(this);\r\n                    this.save_getInitData({ data: item.physicalData[memdef.name] }, convertedItems, true, true, innerRequest);\r\n                    request.add(function(req){\r\n                        req.data = req.data || {}\r\n                        req.data[memdef.name] = innerRequest.build().get().data;\r\n                    })\r\n                    return true;\r\n                }\r\n                return false;\r\n            }\r\n        }\r\n    },\r\n    \r\n    addETagHeader: function(item, request, value){\r\n        var property = item.data.getType().memberDefinitions.getPublicMappedProperties().filter(function (memDef) { return memDef.concurrencyMode === $data.ConcurrencyMode.Fixed });\r\n        if (property && property[0]) {\r\n            var headerValue = (typeof value !== \"undefined\") ? value : item.data[property[0].name];\r\n            if(typeof headerValue !== \"undefined\"){\r\n                if(request instanceof activities.RequestBuilder){\r\n                    request.add(new activities.SetHeaderProperty('If-Match', headerValue))\r\n                } else {\r\n                    request.headers['If-Match'] = headerValue;\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \r\n    getTraceString: function (queryable) {\r\n        var sqlText = this._compile(queryable);\r\n        return queryable;\r\n    },\r\n    supportedDataTypes: {\r\n        value: [$data.Array, $data.Integer, $data.String, $data.Number, $data.Blob, $data.Boolean, $data.Date, $data.Object, $data.GeographyPoint, $data.Guid,\r\n            $data.GeographyLineString, $data.GeographyPolygon, $data.GeographyMultiPoint, $data.GeographyMultiLineString, $data.GeographyMultiPolygon, $data.GeographyCollection,\r\n            $data.GeometryPoint, $data.GeometryLineString, $data.GeometryPolygon, $data.GeometryMultiPoint, $data.GeometryMultiLineString, $data.GeometryMultiPolygon, $data.GeometryCollection,\r\n            $data.Byte, $data.SByte, $data.Decimal, $data.Float, $data.Int16, $data.Int32, $data.Int64, $data.Time, $data.Day, $data.DateTimeOffset, $data.Duration],\r\n        writable: false\r\n    },\r\n\r\n    supportedBinaryOperators: {\r\n        value: {\r\n            equal: { mapTo: 'eq', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            notEqual: { mapTo: 'ne', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            equalTyped: { mapTo: 'eq', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            notEqualTyped: { mapTo: 'ne', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            greaterThan: { mapTo: 'gt', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            greaterThanOrEqual: { mapTo: 'ge', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n\r\n            lessThan: { mapTo: 'lt', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            lessThenOrEqual: { mapTo: 'le', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            or: { mapTo: 'or', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            and: { mapTo: 'and', dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n\r\n            add: { mapTo: 'add', dataType: \"number\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            divide: { mapTo: 'div', allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            multiply: { mapTo: 'mul', allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            subtract: { mapTo: 'sub', allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n            modulo: { mapTo: 'mod', allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] },\r\n\r\n            \"in\": { mapTo: \"in\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression] }\r\n        }\r\n    },\r\n\r\n    supportedUnaryOperators: {\r\n        value: {\r\n            not: { mapTo: 'not' }\r\n        }\r\n    },\r\n\r\n    supportedFieldOperations: {\r\n        value: {\r\n            /* string functions */\r\n\r\n            contains: {\r\n                mapTo: \"substringof\",\r\n                dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"substring\", dataType: \"string\" }, { name: \"@expression\" }]\r\n            },\r\n\r\n            startsWith: {\r\n                mapTo: \"startswith\",\r\n                dataType: \"string\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"string\" }, { name: \"strFragment\", dataType: \"string\" }]\r\n            },\r\n\r\n            endsWith: {\r\n                mapTo: \"endswith\",\r\n                dataType: \"string\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"string\" }, { name: \"strFragment\", dataType: \"string\" }]\r\n            },\r\n\r\n            length: [{\r\n                allowedType: 'string',\r\n                dataType: \"number\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.ProjectionExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\r\n            },\r\n            {\r\n                allowedType: 'GeographyLineString',\r\n                mapTo: \"geo.length\",\r\n                dataType: \"number\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: ['GeographyLineString'] }],\r\n                fixedDataType: 'decimal'\r\n            },\r\n            {\r\n                allowedType: 'GeometryLineString',\r\n                mapTo: \"geo.length\",\r\n                dataType: \"number\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: 'GeometryLineString' }],\r\n                fixedDataType: 'decimal'\r\n            }],\r\n\r\n            strLength: {\r\n                mapTo: \"length\",\r\n                dataType: \"number\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.ProjectionExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\r\n            },\r\n\r\n            indexOf: {\r\n                dataType: \"number\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                mapTo: \"indexof\",\r\n                baseIndex: 1,\r\n                parameters: [{ name: '@expression', dataType: \"string\" }, { name: 'strFragment', dataType: 'string' }]\r\n            },\r\n\r\n            replace: {\r\n                dataType: \"string\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: '@expression', dataType: \"string\" }, { name: 'strFrom', dataType: 'string' }, { name: 'strTo', dataType: 'string' }]\r\n            },\r\n\r\n            substr: {\r\n                mapTo: \"substring\",\r\n                dataType: \"string\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"string\" }, { name: \"startFrom\", dataType: \"number\" }, { name: \"length\", dataType: \"number\", optional: \"true\" }]\r\n            },\r\n\r\n            toLowerCase: {\r\n                mapTo: \"tolower\",\r\n                dataType: \"string\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\r\n            },\r\n\r\n            toUpperCase: {\r\n                mapTo: \"toupper\",\r\n                dataType: \"string\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\r\n\r\n            },\r\n\r\n            trim: {\r\n                dataType: \"string\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"string\" }]\r\n            },\r\n\r\n\r\n            concat: {\r\n                dataType: \"string\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"string\" }, { name: \"strFragment\", dataType: \"string\" }]\r\n            },\r\n\r\n\r\n            /* data functions */\r\n\r\n            day: {\r\n                allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\r\n            },\r\n            hour: {\r\n                allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\r\n            },\r\n            minute: {\r\n                allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\r\n            },\r\n            month: {\r\n                allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\r\n            },\r\n            second: {\r\n                allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\r\n            },\r\n            year: {\r\n                allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\r\n            },\r\n\r\n            /* number functions */\r\n            round: {\r\n                allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\r\n            },\r\n            floor: {\r\n                allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\r\n            },\r\n            ceiling: {\r\n                allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: \"date\" }]\r\n            },\r\n\r\n\r\n            /* geo functions */\r\n            distance: [{\r\n                allowedType: 'GeographyPoint',\r\n                mapTo: \"geo.distance\",\r\n                dataType: \"number\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: 'GeographyPoint' }, { name: \"to\", dataType: 'GeographyPoint' }],\r\n                fixedDataType: 'decimal'\r\n            }, {\r\n                allowedType: 'GeometryPoint',\r\n                mapTo: \"geo.distance\",\r\n                dataType: \"number\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: 'GeometryPoint' }, { name: \"to\", dataType: 'GeometryPoint' }],\r\n                fixedDataType: 'decimal'\r\n            }],\r\n\r\n            intersects: [{\r\n                allowedType: 'GeographyPoint',\r\n                mapTo: \"geo.intersects\",\r\n                dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: 'GeographyPoint' }, { name: \"in\", dataType: 'GeographyPolygon' }]\r\n\r\n            }, {\r\n                allowedType: 'GeometryPoint',\r\n                mapTo: \"geo.intersects\",\r\n                dataType: \"boolean\", allowedIn: [$data.Expressions.FilterExpression, $data.Expressions.OrderExpression],\r\n                parameters: [{ name: \"@expression\", dataType: 'GeometryPoint' }, { name: \"in\", dataType: 'GeometryPolygon' }]\r\n\r\n            }]\r\n        },\r\n        enumerable: true,\r\n        writable: true\r\n    },\r\n    supportedSetOperations: {\r\n        value: {\r\n            filter: {\r\n                allowedIn: [$data.Expressions.IncludeExpression],\r\n                parameters: [{ name: \"filter\", dataType: \"$data.Queryable\" }],\r\n                frameType: $data.Expressions.FilterExpression,\r\n                includeFrameName: '$filter',\r\n                includeCompiler: '$data.storageProviders.oData.oDataWhereCompiler'\r\n            },\r\n            map: {\r\n                allowedIn: [$data.Expressions.IncludeExpression],\r\n                parameters: [{ name: \"map\", dataType: \"$data.Queryable\" }],\r\n                frameType: $data.Expressions.ProjectionExpression,\r\n                includeFrameName: '$select',\r\n                includeCompiler: '$data.storageProviders.oData.oDataProjectionCompiler'\r\n            },\r\n            length: {},\r\n            forEach: {},\r\n            toArray: {},\r\n            single: {},\r\n            some: {\r\n                invokable: false,\r\n                allowedIn: [$data.Expressions.FilterExpression],\r\n                parameters: [{ name: \"some\", dataType: \"$data.Queryable\" }],\r\n                mapTo: 'any',\r\n                frameType: $data.Expressions.SomeExpression\r\n            },\r\n            every: {\r\n                invokable: false,\r\n                allowedIn: [$data.Expressions.FilterExpression],\r\n                parameters: [{ name: \"every\", dataType: \"$data.Queryable\" }],\r\n                mapTo: 'all',\r\n                frameType: $data.Expressions.EveryExpression\r\n            },\r\n            take: {\r\n                allowedIn: [$data.Expressions.IncludeExpression],\r\n                parameters: [{ name: \"take\", dataType: \"$data.Integer\" }],\r\n                frameType: $data.Expressions.PagingExpression,\r\n                includeFrameName: '$top',\r\n                includeCompiler: '$data.storageProviders.oData.oDataPagingCompiler'\r\n            },\r\n            skip: {\r\n                allowedIn: [$data.Expressions.IncludeExpression],\r\n                parameters: [{ name: \"skip\", dataType: \"$data.Integer\" }],\r\n                frameType: $data.Expressions.PagingExpression,\r\n                includeFrameName: '$skip',\r\n                includeCompiler: '$data.storageProviders.oData.oDataPagingCompiler'\r\n            },\r\n            orderBy: {\r\n                allowedIn: [$data.Expressions.IncludeExpression],\r\n                parameters: [{ name: \"orderBy\", dataType: \"$data.Queryable\" }],\r\n                frameType: $data.Expressions.OrderExpression,\r\n                includeFrameName: '$orderby',\r\n                includeCompiler: '$data.storageProviders.oData.oDataOrderCompiler'\r\n            },\r\n            orderByDescending: {\r\n                allowedIn: [$data.Expressions.IncludeExpression],\r\n                parameters: [{ name: \"orderByDescending\", dataType: \"$data.Queryable\" }],\r\n                frameType: $data.Expressions.OrderExpression,\r\n                frameTypeFactory: function(source, selector){\r\n                    return new $data.Expressions.OrderExpression(source, selector, $data.Expressions.ExpressionType.OrderByDescending)\r\n                },\r\n                includeFrameName: '$orderby',\r\n                includeCompiler: '$data.storageProviders.oData.oDataOrderCompiler'\r\n            },\r\n            first: {},\r\n            include: {},\r\n            batchDelete: {},\r\n            withInlineCount: {\r\n                allowedIn: [$data.Expressions.IncludeExpression],\r\n                parameters: [],\r\n                frameType: $data.Expressions.InlineCountExpression,\r\n                includeFrameName: '$count',\r\n                implementation: function(){ return 'true' }\r\n            },\r\n            find: {}\r\n        },\r\n        enumerable: true,\r\n        writable: true\r\n    },\r\n    supportedContextOperation: {\r\n        value: {\r\n            batchExecuteQuery: true\r\n        },\r\n        enumerable: true,\r\n        writable: true\r\n    },\r\n\r\n    fieldConverter: { value: $data.oDataConverter },\r\n    resolveTypeOperations: function (operation, expression, frameType) {\r\n        var memDef = expression.entityType.getMemberDefinition(operation);\r\n        if (!memDef ||\r\n            !memDef.method ||\r\n            memDef.method.IsSideEffecting !== false ||\r\n            !memDef.method.returnType ||\r\n            !(frameType === $data.Expressions.FilterExpression || frameType === $data.Expressions.OrderExpression))\r\n        {\r\n            Guard.raise(new Exception(\"Entity '\" + expression.entityType.name + \"' Operation '\" + operation + \"' is not supported by the provider\"));\r\n        }\r\n\r\n        return memDef;\r\n    },\r\n    resolveSetOperations: function (operation, expression, frameType) {\r\n        if (expression) {\r\n            var esDef = expression.storageModel.ContextType.getMemberDefinition(expression.storageModel.ItemName);\r\n            if (esDef && esDef.actions && esDef.actions[operation]) {\r\n                var memDef = $data.MemberDefinition.translateDefinition(esDef.actions[operation], operation, this.getType());\r\n                if (!memDef ||\r\n                    !memDef.method ||\r\n                    memDef.method.IsSideEffecting !== false ||\r\n                    !memDef.method.returnType ||\r\n                    !(frameType === $data.Expressions.FilterExpression || frameType === $data.Expressions.OrderExpression)) {\r\n\r\n                    Guard.raise(new Exception(\"Collection '\" + expression.storageModel.ItemName + \"' Operation '\" + operation + \"' is not supported by the provider\"));\r\n                }\r\n\r\n                return memDef;\r\n            }\r\n        }\r\n        return $data.StorageProviderBase.prototype.resolveSetOperations.apply(this, arguments);\r\n\r\n    },\r\n    resolveContextOperations: function (operation, expression, frameType) {\r\n        var memDef = this.context.getType().getMemberDefinition(operation);\r\n        if (!memDef ||\r\n            !memDef.method ||\r\n            memDef.method.IsSideEffecting !== false ||\r\n            !memDef.method.returnType ||\r\n            !(frameType === $data.Expressions.FilterExpression || frameType === $data.Expressions.OrderExpression)) {\r\n            Guard.raise(new Exception(\"Context '\" + expression.instance.getType().name + \"' Operation '\" + operation + \"' is not supported by the provider\"));\r\n        }\r\n        return memDef;\r\n    },\r\n    \r\n    getEntityUrlReference: function(entity){\r\n        var sMod = this.context._storageModel.getStorageModel(entity.getType())\r\n        var tblName = sMod.TableName;\r\n        var pk = '(' + this.getEntityKeysValue({ data: entity, entitySet: this.context.getEntitySetFromElementType(entity.getType()) }) + ')';\r\n        return this.providerConfiguration.oDataServiceHost + '/' + tblName + pk;\r\n    },\r\n\r\n    getEntityKeysValue: function (entity) {\r\n        var result = [];\r\n        var keyValue = undefined;\r\n        var memDefs = entity.data.getType().memberDefinitions.getKeyProperties();\r\n        for (var i = 0, l = memDefs.length; i < l; i++) {\r\n            var field = memDefs[i];\r\n            if (field.key) {\r\n                keyValue = entity.data[field.name];\r\n                var typeName = Container.resolveName(field.type);\r\n\r\n                var converter = this.fieldConverter.toDb[typeName];\r\n                keyValue = converter ? converter(keyValue) : keyValue;\r\n\r\n                converter = this.fieldConverter.escape[typeName];\r\n                keyValue = converter ? converter(keyValue) : keyValue;\r\n\r\n                result.push(field.name + \"=\" + keyValue);\r\n            }\r\n        }\r\n        if (result.length > 1) {\r\n            return result.join(\",\");\r\n        }\r\n        return keyValue;\r\n    },\r\n    getFieldUrl: function (entity, fieldName, entitySet) {\r\n        var keyPart = this.getEntityKeysValue({ data: entity });\r\n        var servicehost = this.providerConfiguration.oDataServiceHost\r\n        if (servicehost.lastIndexOf('/') === servicehost.length)\r\n            servicehost = servicehost.substring(0, servicehost.length - 1);\r\n\r\n        return servicehost + '/' + entitySet.tableName + '(' + keyPart + ')/' + fieldName + '/$value';\r\n    },/*\r\n    getServiceMetadata: function () {\r\n        $data.ajax(this._setAjaxAuthHeader({\r\n            url: this.providerConfiguration.oDataServiceHost + \"/$metadata\",\r\n            dataType: \"xml\",\r\n            success: function (d) {\r\n                console.log(\"OK\");\r\n                console.dir(d);\r\n                console.log(typeof d);\r\n                window[\"s\"] = d;\r\n                window[\"k\"] = this.nsResolver;\r\n                //s.evaluate(\"edmx:Edmx/edmx:DataServices/Schema\", s, $data.storageProviders.oData.oDataProvider.prototype.nsResolver, XPathResult.ANY_TYPE, null).iterateNext()\r\n\r\n            },\r\n            error: function (error) {\r\n                console.log(\"error:\");\r\n                console.dir(error);\r\n            }\r\n        }));\r\n    },\r\n    nsResolver: function (sPrefix) {\r\n        switch (sPrefix) {\r\n            case \"edmx\":\r\n                return \"http://schemas.microsoft.com/ado/2007/06/edmx\";\r\n                break;\r\n            case \"m\":\r\n                return \"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata\";\r\n                break;\r\n            case \"d\":\r\n                return \"http://schemas.microsoft.com/ado/2007/08/dataservices\";\r\n                break;\r\n            default:\r\n                return \"http://schemas.microsoft.com/ado/2008/09/edm\";\r\n                break;\r\n        }\r\n    }\r\n    */\r\n    parseError: function(error, data){\r\n\r\n        var message = (error.response || error || {}).body || '';\r\n        try {\r\n            if(message.indexOf('{') === 0){\r\n                var errorObj = JSON.parse(message);\r\n                errorObj = errorObj['odata.error'] || errorObj.error || errorObj;\r\n                if (errorObj.message) {\r\n                    message = errorObj.message.value || errorObj.message;\r\n                }\r\n            }\r\n        } catch (e) {}\r\n\r\n        return new Exception(message, error.message, data || error);\r\n    },\r\n    appendBasicAuth: function (request, user, password, withCredentials) {\r\n        request.headers = request.headers || {};\r\n        if (!request.headers.Authorization && user && password) {\r\n            request.headers.Authorization = \"Basic \" + this.__encodeBase64(user + \":\" + password);\r\n        }\r\n        if (withCredentials){\r\n            request.withCredentials = withCredentials;\r\n        }\r\n    },\r\n    __encodeBase64: function (val) {\r\n        var b64array = \"ABCDEFGHIJKLMNOP\" +\r\n                           \"QRSTUVWXYZabcdef\" +\r\n                           \"ghijklmnopqrstuv\" +\r\n                           \"wxyz0123456789+/\" +\r\n                           \"=\";\r\n\r\n        var input = val;\r\n        var base64 = \"\";\r\n        var hex = \"\";\r\n        var chr1, chr2, chr3 = \"\";\r\n        var enc1, enc2, enc3, enc4 = \"\";\r\n        var i = 0;\r\n\r\n        do {\r\n            chr1 = input.charCodeAt(i++);\r\n            chr2 = input.charCodeAt(i++);\r\n            chr3 = input.charCodeAt(i++);\r\n\r\n            enc1 = chr1 >> 2;\r\n            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n            enc4 = chr3 & 63;\r\n\r\n            if (isNaN(chr2)) {\r\n                enc3 = enc4 = 64;\r\n            } else if (isNaN(chr3)) {\r\n                enc4 = 64;\r\n            }\r\n\r\n            base64 = base64 +\r\n                        b64array.charAt(enc1) +\r\n                        b64array.charAt(enc2) +\r\n                        b64array.charAt(enc3) +\r\n                        b64array.charAt(enc4);\r\n            chr1 = chr2 = chr3 = \"\";\r\n            enc1 = enc2 = enc3 = enc4 = \"\";\r\n        } while (i < input.length);\r\n\r\n        return base64;\r\n    },\r\n    checkODataMode: function(functionName){\r\n        return checkODataMode(this, functionName)\r\n    }\r\n}, null);\r\n\r\n$data.StorageProviderBase.registerProvider(\"oData\", $data.storageProviders.oData.oDataProvider);\r\n","export class RequestBuilder {\r\n    constructor(context, request){\r\n        this._context = context;\r\n        this._request = request || {};\r\n        this._activities = [];\r\n    }\r\n    get(){\r\n        return this._request; \r\n    }\r\n    add(...activities){\r\n        this._activities.push(...activities);\r\n        return this;\r\n    }\r\n    build(){\r\n        this._request.headers = this._request.headers || {}\r\n        this._request.data = this._request.data || {}\r\n        \r\n        this._activities.forEach((a) =>  a instanceof RequestActivity ? \r\n            a.implementation(this._request, this._context) :\r\n            a(this._request, this._context))\r\n        \r\n        this._activities = [];\r\n        return this;\r\n    }\r\n}\r\n\r\nexport class RequestActivity {\r\n    constructor(){}\r\n    implementation(request, provider){ }\r\n}\r\n\r\nexport class SetRequestActivity extends RequestActivity {\r\n    constructor(key, value){\r\n        super()\r\n        this.key = key;\r\n        this.value = value;\r\n    }\r\n    implementation(request, provider){ }\r\n}\r\n\r\nexport class SetRequestProperty extends SetRequestActivity {\r\n    implementation(request, provider){\r\n        request[this.key] = this.value\r\n    }\r\n}\r\n\r\nexport class SetDataProperty extends SetRequestActivity {\r\n    implementation(request, provider){\r\n        request.data[this.key] = this.value\r\n    }\r\n}\r\n\r\nexport class SetHeaderProperty extends SetRequestActivity {\r\n    implementation(request, provider){\r\n        request.headers[this.key] = this.value\r\n    }\r\n}\r\n\r\nexport class SetUrl extends SetRequestProperty {\r\n    constructor(url){\r\n        super('requestUri', url)\r\n    }\r\n}\r\n\r\nexport class AppendUrl extends SetUrl {\r\n    implementation(request, provider){\r\n        request[this.key] == request[this.key] || \"\"\r\n        request[this.key] += this.value\r\n    }\r\n}\r\n\r\nexport class SetMethod extends SetRequestProperty {\r\n    constructor(method){\r\n        super('method', method)\r\n    }\r\n}\r\n\r\nexport class SetProperty extends SetDataProperty {\r\n}\r\n\r\nexport class SetNavigationProperty extends SetDataProperty {\r\n    implementation(request, provider){\r\n        request.data[this.key] = this.value\r\n    }\r\n}\r\n\r\nexport class ClearRequestData extends RequestActivity {\r\n    implementation(request, provider){\r\n        delete request.data;\r\n    }\r\n}\r\n","import $data, { $C, Guard, Container, Exception, MemberDefinition } from 'jaydata/core';\r\n\r\n$C('$data.storageProviders.oData.oDataWhereCompiler', $data.Expressions.EntityExpressionVisitor, null, {\r\n    constructor: function (provider, lambdaPrefix) {\r\n        this.provider = provider;\r\n        this.lambdaPrefix = lambdaPrefix;\r\n    },\r\n\r\n    compile: function (expression, context) {\r\n        this.Visit(expression, context);\r\n    },\r\n\r\n    VisitParametricQueryExpression: function (expression, context) {\r\n        this.Visit(expression.expression, context);\r\n    },\r\n\r\n    VisitUnaryExpression: function (expression, context) {\r\n        context.data += expression.resolution.mapTo;\r\n        context.data += \"(\";\r\n        this.Visit(expression.operand, context);\r\n        context.data += \")\";\r\n    },\r\n\r\n\r\n    VisitSimpleBinaryExpression: function (expression, context) {\r\n        context.data += \"(\";\r\n        //TODO refactor!!!\r\n        if (expression.nodeType == \"in\") {\r\n            Guard.requireType(\"expression.right\", expression.type, $data.Expressions.ConstantExpression);\r\n            var paramValue = expression.right.value;\r\n            if (!(paramValue instanceof Array)) { Guard.raise(new Exception(\"Right to the 'in' operator must be an array value\")); }\r\n            var result = null;\r\n            var orResolution = { mapTo: \"or\", dataType: \"boolean\", name: \"or\" };\r\n            var eqResolution = { mapTo: \"eq\", dataType: \"boolean\", name: \"equal\" };\r\n\r\n            paramValue.forEach(function (item) {\r\n                var idValue = item;\r\n                var idCheck = Container.createSimpleBinaryExpression(expression.left, idValue,\r\n                    $data.Expressions.ExpressionType.Equal, \"==\", \"boolean\", eqResolution);\r\n                if (result) {\r\n                    result = Container.createSimpleBinaryExpression(result, idCheck,\r\n                    $data.Expressions.ExpressionType.Or, \"||\", \"boolean\", orResolution);\r\n                } else {\r\n                    result = idCheck;\r\n                };\r\n            });\r\n            var temp = context.data;\r\n            context.data = '';\r\n            this.Visit(result, context);\r\n            context.data = temp + context.data.replace(/\\(/g, '').replace(/\\)/g, '');\r\n        } else {\r\n            this.Visit(expression.left, context);\r\n            context.data += \" \";\r\n            context.data += expression.resolution.mapTo;\r\n            context.data += \" \";\r\n            this.Visit(expression.right, context);\r\n        };\r\n        context.data += \")\";\r\n\r\n    },\r\n\r\n    VisitEntityFieldExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        if (expression.source instanceof $data.Expressions.ComplexTypeExpression) {\r\n            context.data += \"/\";\r\n        }\r\n        this.Visit(expression.selector, context);\r\n    },\r\n\r\n    VisitAssociationInfoExpression: function (expression, context) {\r\n        context.data += expression.associationInfo.FromPropertyName;\r\n    },\r\n\r\n    VisitMemberInfoExpression: function (expression, context) {\r\n        context.data += expression.memberName;\r\n    },\r\n\r\n    VisitQueryParameterExpression: function (expression, context) {\r\n        var typeName = Container.resolveName(expression.type);\r\n\r\n        var converter = this.provider.fieldConverter.toDb[typeName];\r\n        var value = converter ? converter(expression.value) : expression.value;\r\n\r\n        converter = this.provider.fieldConverter.escape[typeName];\r\n        context.data += converter ? converter(value) : value;\r\n    },\r\n\r\n    VisitEntityFieldOperationExpression: function (expression, context) {\r\n        Guard.requireType(\"expression.operation\", expression.operation, $data.Expressions.MemberInfoExpression);\r\n\r\n        //TODO refactor!\r\n        var opDef = expression.operation.memberDefinition;\r\n        var opName = opDef.mapTo || opDef.name;\r\n        context.data += opName;\r\n        context.data += \"(\";\r\n        var paramCounter = 0;\r\n        var params = opDef.parameters || [{ name: \"@expression\" }];\r\n\r\n        var args = params.map(function (item, index) {\r\n            if (item.name === \"@expression\") {\r\n                return expression.source;\r\n            } else {\r\n                return expression.parameters[paramCounter++]\r\n            };\r\n        });\r\n\r\n        args.forEach(function (arg, index) {\r\n            if (index > 0) {\r\n                context.data += \",\";\r\n            };\r\n            this.Visit(arg, context);\r\n        }, this);\r\n        context.data += \")\";\r\n    },\r\n    VisitEntityFunctionOperationExpression: function (expression, context) {\r\n        Guard.requireType(\"expression.operation\", expression.operation, $data.Expressions.MemberInfoExpression);\r\n        this.Visit(expression.source, context);\r\n\r\n        //TODO refactor!\r\n        var opDef = expression.operation.memberDefinition;\r\n        var opName = opDef.mapTo || opDef.name;\r\n        context.data += opName;\r\n        context.data += \"(\";\r\n        var paramCounter = 0;\r\n        var params = opDef.method.params || [{ name: \"@expression\" }];\r\n\r\n        var args = params.map(function (item, index) {\r\n            if (item.name === \"@expression\") {\r\n                return expression.source;\r\n            } else {\r\n                return expression.parameters[paramCounter++]\r\n            };\r\n        });\r\n        var i = 0;\r\n        args.forEach(function (arg, index) {\r\n            if (arg === undefined || (arg instanceof $data.Expressions.ConstantExpression && typeof arg.value === 'undefined'))\r\n                return;\r\n\r\n            if (i > 0) {\r\n                context.data += \",\";\r\n            };\r\n            i++;\r\n            context.data += params[index].name + '=';\r\n            this.Visit(arg, context);\r\n        }, this);\r\n        context.data += \")\";\r\n    },\r\n    VisitContextFunctionOperationExpression: function (expression, context) {\r\n        return this.VisitEntityFunctionOperationExpression(expression, context);\r\n    },\r\n\r\n    VisitConstantExpression: function (expression, context) {\r\n        var typeName = Container.resolveName(expression.type);\r\n\r\n        var converter = this.provider.fieldConverter.toDb[typeName];\r\n        var value = converter ? converter(expression.value) : expression.value;\r\n\r\n        converter = this.provider.fieldConverter.escape[typeName];\r\n        context.data += converter ? converter(value) : value;\r\n    },\r\n\r\n    VisitEntityExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n\r\n        if (this.lambdaPrefix && expression.selector.lambda) {\r\n            context.lambda = expression.selector.lambda;\r\n            context.data += (expression.selector.lambda + '/');\r\n        }\r\n\r\n        //if (expression.selector instanceof $data.Expressions.EntityExpression) {\r\n        //    this.Visit(expression.selector, context);\r\n        //}\r\n    },\r\n\r\n    VisitEntitySetExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n        if (expression.selector instanceof $data.Expressions.AssociationInfoExpression) {\r\n            this.Visit(expression.selector, context);\r\n            context.data += \"/\";\r\n        }\r\n    },\r\n\r\n    VisitFrameOperationExpression: function (expression, context) {\r\n        this.Visit(expression.source, context);\r\n\r\n        Guard.requireType(\"expression.operation\", expression.operation, $data.Expressions.MemberInfoExpression);\r\n\r\n        //TODO refactor!\r\n        var opDef = expression.operation.memberDefinition;\r\n        var opName = opDef.mapTo || opDef.name;\r\n        context.data += opName;\r\n        context.data += \"(\";\r\n        var paramCounter = 0;\r\n        var params = opDef.parameters || [{ name: \"@expression\" }];\r\n\r\n        var args = params.map(function (item, index) {\r\n            if (item.name === \"@expression\") {\r\n                return expression.source;\r\n            } else {\r\n                return expression.parameters[paramCounter++]\r\n            };\r\n        });\r\n\r\n        for (var i = 0; i < args.length; i++) {\r\n            var arg = args[i];\r\n            if (arg && arg.value instanceof $data.Queryable) {\r\n                var frameExpression = new opDef.frameType(arg.value.expression);\r\n                var preparator = Container.createQueryExpressionCreator(arg.value.entityContext);\r\n                var prep_expression = preparator.Visit(frameExpression);\r\n\r\n                var compiler = new $data.storageProviders.oData.oDataWhereCompiler(this.provider, true);\r\n                var frameContext = { data: \"\" };\r\n                var compiled = compiler.compile(prep_expression, frameContext);\r\n\r\n                context.data += (frameContext.lambda + ': ' + frameContext.data);\r\n            };\r\n        }\r\n        context.data += \")\";\r\n    }\r\n});\r\n"],"sourceRoot":"/source/"}